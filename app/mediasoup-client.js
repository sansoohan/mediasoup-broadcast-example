/*
 * mediasoup-client v2.4.12
 * mediasoup client side JavaScript SDK
 * https://mediasoup.org
 * Copyright © 2017, Iñaki Baz Castillo <ibc@aliax.net>
 * License: ISC
 */

!function(e){if("object"==typeof exports&&"undefined"!=typeof module)module.exports=e();else if("function"==typeof define&&define.amd)define([],e);else{("undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:this).mediasoupClient=e()}}((function(){return function e(t,r,n){function o(i,s){if(!r[i]){if(!t[i]){var c="function"==typeof require&&require;if(!s&&c)return c(i,!0);if(a)return a(i,!0);var u=new Error("Cannot find module '"+i+"'");throw u.code="MODULE_NOT_FOUND",u}var d=r[i]={exports:{}};t[i][0].call(d.exports,(function(e){return o(t[i][1][e]||e)}),d,d.exports,e,t,r,n)}return r[i].exports}for(var a="function"==typeof require&&require,i=0;i<n.length;i++)o(n[i]);return o}({1:[function(e,t,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0}),r.default=void 0;var n,o=e("events"),a=(n=e("./Logger"))&&n.__esModule?n:{default:n},i=e("./errors");function s(e){return(s="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function c(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}function u(e,t){return!t||"object"!==s(t)&&"function"!=typeof t?function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e):t}function d(e){return(d=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function l(e,t){return(l=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}var p=new a.default("CommandQueue"),f=function(e){function t(){var e;return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t),(e=u(this,d(t).call(this))).setMaxListeners(1/0),e._closed=!1,e._busy=!1,e._queue=[],e}var r,n,o;return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&l(e,t)}(t,e),r=t,(n=[{key:"close",value:function(){this._closed=!0}},{key:"push",value:function(e,t){var r=this,n=Object.assign({method:e},t);return p.debug("push() [method:%s]",e),new Promise((function(e,t){var o=r._queue;n.resolve=e,n.reject=t,o.push(n),r._handlePendingCommands()}))}},{key:"_handlePendingCommands",value:function(){var e=this;if(!this._busy){var t=this._queue,r=t[0];r&&(this._busy=!0,this._handleCommand(r).then((function(){e._busy=!1,t.shift(),e._handlePendingCommands()})))}}},{key:"_handleCommand",value:function(e){var t=this;if(p.debug("_handleCommand() [method:%s]",e.method),this._closed)return e.reject(new i.InvalidStateError("closed")),Promise.resolve();var r={promise:null};return this.emit("exec",e,r),Promise.resolve().then((function(){return r.promise})).then((function(r){p.debug("_handleCommand() | command succeeded [method:%s]",e.method),t._closed?e.reject(new i.InvalidStateError("closed")):e.resolve(r)})).catch((function(t){p.error("_handleCommand() | command failed [method:%s]: %o",e.method,t),e.reject(t)}))}}])&&c(r.prototype,n),o&&c(r,o),t}(o.EventEmitter);r.default=f},{"./Logger":5,"./errors":10,events:35}],2:[function(e,t,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0}),r.default=void 0;var n=i(e("./Logger")),o=i(e("./EnhancedEventEmitter")),a=e("./errors");function i(e){return e&&e.__esModule?e:{default:e}}function s(e){return(s="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function c(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}function u(e,t){return!t||"object"!==s(t)&&"function"!=typeof t?function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e):t}function d(e){return(d=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function l(e,t){return(l=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}var p=new Set(["default","low","medium","high"]),f=1e3,m=new n.default("Consumer"),h=function(e){function t(e,r,n,o,a){var i;return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t),(i=u(this,d(t).call(this,m)))._id=e,i._closed=!1,i._kind=r,i._rtpParameters=n,i._peer=o,i._appData=a,i._supported=!1,i._transport=null,i._track=null,i._locallyPaused=!1,i._remotelyPaused=!1,i._statsEnabled=!1,i._statsInterval=f,i._preferredProfile="default",i._effectiveProfile=null,i}var r,n,o;return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&l(e,t)}(t,e),r=t,(n=[{key:"close",value:function(){m.debug("close()"),this._closed||(this._closed=!0,this._statsEnabled&&(this._statsEnabled=!1,this.transport&&this.transport.disableConsumerStats(this)),this.emit("@close"),this.safeEmit("close","local"),this._destroy())}},{key:"remoteClose",value:function(){m.debug("remoteClose()"),this._closed||(this._closed=!0,this._transport&&this._transport.removeConsumer(this),this._destroy(),this.emit("@close"),this.safeEmit("close","remote"))}},{key:"_destroy",value:function(){this._transport=null;try{this._track.stop()}catch(e){}this._track=null}},{key:"receive",value:function(e){var t=this;return m.debug("receive() [transport:%o]",e),this._closed?Promise.reject(new a.InvalidStateError("Consumer closed")):this._supported?this._transport?Promise.reject(new Error("already handled by a Transport")):"object"!==s(e)?Promise.reject(new TypeError("invalid Transport")):(this._transport=e,e.addConsumer(this).then((function(r){return t._track=r,t.paused&&(r.enabled=!1),e.once("@close",(function(){if(!t._closed&&t._transport===e){t._transport=null;try{t._track.stop()}catch(e){}t._track=null,t.safeEmit("unhandled")}})),t.safeEmit("handled"),t._statsEnabled&&e.enableConsumerStats(t,t._statsInterval),r})).catch((function(e){throw t._transport=null,e}))):Promise.reject(new Error("unsupported codecs"))}},{key:"pause",value:function(e){return m.debug("pause()"),this._closed?(m.error("pause() | Consumer closed"),!1):!!this._locallyPaused||(this._locallyPaused=!0,this._track&&(this._track.enabled=!1),this._transport&&this._transport.pauseConsumer(this,e),this.safeEmit("pause","local",e),this.paused)}},{key:"remotePause",value:function(e){m.debug("remotePause()"),this._closed||this._remotelyPaused||(this._remotelyPaused=!0,this._track&&(this._track.enabled=!1),this.safeEmit("pause","remote",e))}},{key:"resume",value:function(e){return m.debug("resume()"),this._closed?(m.error("resume() | Consumer closed"),!1):!this._locallyPaused||(this._locallyPaused=!1,this._track&&!this._remotelyPaused&&(this._track.enabled=!0),this._transport&&this._transport.resumeConsumer(this,e),this.safeEmit("resume","local",e),!this.paused)}},{key:"remoteResume",value:function(e){m.debug("remoteResume()"),!this._closed&&this._remotelyPaused&&(this._remotelyPaused=!1,this._track&&!this._locallyPaused&&(this._track.enabled=!0),this.safeEmit("resume","remote",e))}},{key:"setPreferredProfile",value:function(e){m.debug("setPreferredProfile() [profile:%s]",e),this._closed?m.error("setPreferredProfile() | Consumer closed"):e!==this._preferredProfile&&(p.has(e)?(this._preferredProfile=e,this._transport&&this._transport.setConsumerPreferredProfile(this,this._preferredProfile)):m.error('setPreferredProfile() | invalid profile "%s"',e))}},{key:"remoteSetPreferredProfile",value:function(e){m.debug("remoteSetPreferredProfile() [profile:%s]",e),this._closed||e===this._preferredProfile||(this._preferredProfile=e)}},{key:"remoteEffectiveProfileChanged",value:function(e){m.debug("remoteEffectiveProfileChanged() [profile:%s]",e),this._closed||e===this._effectiveProfile||(this._effectiveProfile=e,this.safeEmit("effectiveprofilechange",this._effectiveProfile))}},{key:"enableStats",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:f;m.debug("enableStats() [interval:%s]",e),this._closed?m.error("enableStats() | Consumer closed"):this._statsEnabled||(this._statsInterval="number"!=typeof e||e<1e3?f:e,this._statsEnabled=!0,this._transport&&this._transport.enableConsumerStats(this,this._statsInterval))}},{key:"disableStats",value:function(){m.debug("disableStats()"),this._closed?m.error("disableStats() | Consumer closed"):this._statsEnabled&&(this._statsEnabled=!1,this._transport&&this._transport.disableConsumerStats(this))}},{key:"setSupported",value:function(e){this._supported=e}},{key:"remoteStats",value:function(e){this.safeEmit("stats",e)}},{key:"id",get:function(){return this._id}},{key:"closed",get:function(){return this._closed}},{key:"kind",get:function(){return this._kind}},{key:"rtpParameters",get:function(){return this._rtpParameters}},{key:"peer",get:function(){return this._peer}},{key:"appData",get:function(){return this._appData}},{key:"supported",get:function(){return this._supported}},{key:"transport",get:function(){return this._transport}},{key:"track",get:function(){return this._track}},{key:"locallyPaused",get:function(){return this._locallyPaused}},{key:"remotelyPaused",get:function(){return this._remotelyPaused}},{key:"paused",get:function(){return this._locallyPaused||this._remotelyPaused}},{key:"preferredProfile",get:function(){return this._preferredProfile}},{key:"effectiveProfile",get:function(){return this._effectiveProfile}}])&&c(r.prototype,n),o&&c(r,o),t}(o.default);r.default=h},{"./EnhancedEventEmitter":4,"./Logger":5,"./errors":10}],3:[function(e,t,r){(function(t){"use strict";Object.defineProperty(r,"__esModule",{value:!0}),r.default=void 0;var n=v(e("bowser")),o=v(e("./Logger")),a=v(e("./handlers/Chrome70")),i=v(e("./handlers/Chrome69")),s=v(e("./handlers/Chrome67")),c=v(e("./handlers/Chrome55")),u=v(e("./handlers/Safari12")),d=v(e("./handlers/Safari11")),l=v(e("./handlers/Firefox65")),p=v(e("./handlers/Firefox59")),f=v(e("./handlers/Firefox50")),m=v(e("./handlers/Edge11")),h=v(e("./handlers/ReactNative"));function v(e){return e&&e.__esModule?e:{default:e}}function y(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}var _=new o.default("Device"),g=function(){function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e)}var r,o,v;return r=e,v=[{key:"setHandler",value:function(t){var r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};e._detected=!0,e._handlerClass=t,e._flag=r.flag,e._name=r.name,e._version=r.version,e._bowser=r.bowser||{}}},{key:"getFlag",value:function(){return e._detected||e._detect(),e._flag}},{key:"getName",value:function(){return e._detected||e._detect(),e._name}},{key:"getVersion",value:function(){return e._detected||e._detect(),e._version}},{key:"getBowser",value:function(){return e._detected||e._detect(),e._bowser}},{key:"isSupported",value:function(){return e._detected||e._detect(),Boolean(e._handlerClass)}},{key:"_detect",value:function(){if(e._detected=!0,t.navigator&&"ReactNative"===t.navigator.product)e._flag="react-native",e._name="ReactNative",e._version=void 0,e._bowser={},e._handlerClass=h.default;else if(t.navigator&&"string"==typeof t.navigator.userAgent){var r=t.navigator.userAgent,o=n.default.detect(r);if(e._flag=void 0,e._name=o.name||void 0,e._version=o.version||void 0,e._bowser=o,e._handlerClass=null,n.default.check({chrome:"70",chromium:"70"},!0,r))e._flag="chrome",e._handlerClass=a.default;else if(n.default.check({chrome:"69",chromium:"69"},!0,r))e._flag="chrome",e._handlerClass=i.default;else if(n.default.check({chrome:"67",chromium:"67"},!0,r))e._flag="chrome",e._handlerClass=s.default;else if(n.default.check({chrome:"55",chromium:"55"},!0,r))e._flag="chrome",e._handlerClass=c.default;else if(n.default.check({chrome:"49",chromium:"49"},!0,r)&&t.adapter)e._flag="chrome",e._handlerClass=c.default;else if(n.default.check({firefox:"65"},!0,r))e._flag="firefox",e._handlerClass=l.default;else if(n.default.check({firefox:"59"},!0,r))e._flag="firefox",e._handlerClass=p.default;else if(n.default.check({firefox:"50"},!0,r))e._flag="firefox",e._handlerClass=f.default;else if(n.default.check({safari:"12.1"},!0,r)&&"undefined"!=typeof RTCRtpTransceiver&&RTCRtpTransceiver.prototype.hasOwnProperty("currentDirection"))e._flag="safari",e._handlerClass=u.default;else if(n.default.check({safari:"11"},!0,r))e._flag="safari",e._handlerClass=d.default;else if(n.default.check({msedge:"11"},!0,r))e._flag="msedge",e._handlerClass=m.default;else if(n.default.check({opera:"57"},!0,r))e._flag="opera",e._handlerClass=a.default;else if(n.default.check({opera:"44"},!0,r))e._flag="opera",e._handlerClass=c.default;else if(o.chromium||o.blink||o.webkit){_.debug('best effort Chrome based browser detection [name:"%s"]',o.name),e._flag="chrome";var v=r.match(/(?:(?:Chrome|Chromium))[ /](\w+)/i);if(v){var y=Number(v[1]);e._handlerClass=y>=70?a.default:y>=69?i.default:y>=67?s.default:c.default}else e._handlerClass=a.default}e.isSupported()?_.debug('browser supported [flag:%s, name:"%s", version:%s, handler:%s]',e._flag,e._name,e._version,e._handlerClass.tag):_.warn("browser not supported [name:%s, version:%s]",e._name,e._version)}else _.warn("device not supported")}},{key:"Handler",get:function(){return e._detected||e._detect(),e._handlerClass}}],(o=null)&&y(r.prototype,o),v&&y(r,v),e}();r.default=g,g._detected=!1,g._flag=void 0,g._name=void 0,g._version=void 0,g._bowser=void 0,g._handlerClass=null}).call(this,"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{"./Logger":5,"./handlers/Chrome55":11,"./handlers/Chrome67":12,"./handlers/Chrome69":13,"./handlers/Chrome70":14,"./handlers/Edge11":15,"./handlers/Firefox50":16,"./handlers/Firefox59":17,"./handlers/Firefox65":18,"./handlers/ReactNative":19,"./handlers/Safari11":20,"./handlers/Safari12":21,bowser:34}],4:[function(e,t,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0}),r.default=void 0;var n,o=e("events"),a=(n=e("./Logger"))&&n.__esModule?n:{default:n};function i(e){return(i="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function s(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}function c(e,t){return!t||"object"!==i(t)&&"function"!=typeof t?function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e):t}function u(e){return(u=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function d(e,t){return(d=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}var l=function(e){function t(e){var r;return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t),(r=c(this,u(t).call(this))).setMaxListeners(1/0),r._logger=e||new a.default("EnhancedEventEmitter"),r}var r,n,o;return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&d(e,t)}(t,e),r=t,(n=[{key:"safeEmit",value:function(e){try{for(var t=arguments.length,r=new Array(t>1?t-1:0),n=1;n<t;n++)r[n-1]=arguments[n];this.emit.apply(this,[e].concat(r))}catch(t){this._logger.error("safeEmit() | event listener threw an error [event:%s]:%o",e,t)}}},{key:"safeEmitAsPromise",value:function(e){for(var t=this,r=arguments.length,n=new Array(r>1?r-1:0),o=1;o<r;o++)n[o-1]=arguments[o];return new Promise((function(r,o){t.safeEmit.apply(t,[e].concat(n,[function(e){r(e)},function(r){t._logger.error("safeEmitAsPromise() | errback called [event:%s]:%o",e,r),o(r)}]))}))}}])&&s(r.prototype,n),o&&s(r,o),t}(o.EventEmitter);r.default=l},{"./Logger":5,events:35}],5:[function(e,t,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0}),r.default=void 0;var n,o=(n=e("debug"))&&n.__esModule?n:{default:n};function a(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}var i="mediasoup-client",s=function(){function e(t){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),t?(this._debug=(0,o.default)("".concat(i,":").concat(t)),this._warn=(0,o.default)("".concat(i,":WARN:").concat(t)),this._error=(0,o.default)("".concat(i,":ERROR:").concat(t))):(this._debug=(0,o.default)(i),this._warn=(0,o.default)("".concat(i,":WARN")),this._error=(0,o.default)("".concat(i,":ERROR"))),this._debug.log=console.info.bind(console),this._warn.log=console.warn.bind(console),this._error.log=console.error.bind(console)}var t,r,n;return t=e,(r=[{key:"debug",get:function(){return this._debug}},{key:"warn",get:function(){return this._warn}},{key:"error",get:function(){return this._error}}])&&a(t.prototype,r),n&&a(t,n),e}();r.default=s},{debug:36}],6:[function(e,t,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0}),r.default=void 0;var n=a(e("./Logger")),o=a(e("./EnhancedEventEmitter"));function a(e){return e&&e.__esModule?e:{default:e}}function i(e){return(i="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function s(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}function c(e,t){return!t||"object"!==i(t)&&"function"!=typeof t?function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e):t}function u(e){return(u=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function d(e,t){return(d=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}var l=new n.default("Peer"),p=function(e){function t(e,r){var n;return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t),(n=c(this,u(t).call(this,l)))._name=e,n._closed=!1,n._appData=r,n._consumers=new Map,n}var r,n,o;return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&d(e,t)}(t,e),r=t,(n=[{key:"close",value:function(){if(l.debug("close()"),!this._closed){this._closed=!0,this.emit("@close"),this.safeEmit("close","local");var e=!0,t=!1,r=void 0;try{for(var n,o=this._consumers.values()[Symbol.iterator]();!(e=(n=o.next()).done);e=!0)n.value.close()}catch(e){t=!0,r=e}finally{try{e||null==o.return||o.return()}finally{if(t)throw r}}}}},{key:"remoteClose",value:function(e){if(l.debug("remoteClose()"),!this._closed){this._closed=!0,this.emit("@close"),this.safeEmit("close","remote",e);var t=!0,r=!1,n=void 0;try{for(var o,a=this._consumers.values()[Symbol.iterator]();!(t=(o=a.next()).done);t=!0)o.value.remoteClose()}catch(e){r=!0,n=e}finally{try{t||null==a.return||a.return()}finally{if(r)throw n}}}}},{key:"getConsumerById",value:function(e){return this._consumers.get(e)}},{key:"addConsumer",value:function(e){var t=this;if(this._consumers.has(e.id))throw new Error("Consumer already exists [id:".concat(e.id,"]"));this._consumers.set(e.id,e),e.on("@close",(function(){t._consumers.delete(e.id)})),this.safeEmit("newconsumer",e)}},{key:"name",get:function(){return this._name}},{key:"closed",get:function(){return this._closed}},{key:"appData",get:function(){return this._appData}},{key:"consumers",get:function(){return Array.from(this._consumers.values())}}])&&s(r.prototype,n),o&&s(r,o),t}(o.default);r.default=p},{"./EnhancedEventEmitter":4,"./Logger":5}],7:[function(e,t,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0}),r.default=void 0;var n=c(e("./Logger")),o=c(e("./EnhancedEventEmitter")),a=e("./errors"),i=function(e){if(e&&e.__esModule)return e;var t=s();if(t&&t.has(e))return t.get(e);var r={};if(null!=e){var n=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var o in e)if(Object.prototype.hasOwnProperty.call(e,o)){var a=n?Object.getOwnPropertyDescriptor(e,o):null;a&&(a.get||a.set)?Object.defineProperty(r,o,a):r[o]=e[o]}}r.default=e,t&&t.set(e,r);return r}(e("./utils"));function s(){if("function"!=typeof WeakMap)return null;var e=new WeakMap;return s=function(){return e},e}function c(e){return e&&e.__esModule?e:{default:e}}function u(e){return(u="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function d(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}function l(e,t){return!t||"object"!==u(t)&&"function"!=typeof t?function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e):t}function p(e){return(p=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function f(e,t){return(f=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}var m=1e3,h={low:1e5,medium:3e5,high:15e5},v=new n.default("Producer"),y=function(e){function t(e,r,n){var o;!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t),(o=l(this,p(t).call(this,v)))._id=i.randomNumber(),o._closed=!1,o._originalTrack=e;try{o._track=e.clone()}catch(t){o._track=e}return o._appData=n,o._simulcast=!1,"object"===u(r.simulcast)?o._simulcast=Object.assign({},h,r.simulcast):!0===r.simulcast&&(o._simulcast=Object.assign({},h)),o._transport=null,o._rtpParameters=null,o._locallyPaused=!o._track.enabled,o._remotelyPaused=!1,o._statsEnabled=!1,o._statsInterval=m,o._handleTrack(),o}var r,n,o;return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&f(e,t)}(t,e),r=t,(n=[{key:"close",value:function(e){v.debug("close()"),this._closed||(this._closed=!0,this._statsEnabled&&(this._statsEnabled=!1,this.transport&&this.transport.disableProducerStats(this)),this._transport&&this._transport.removeProducer(this,"local",e),this._destroy(),this.emit("@close","local",e),this.safeEmit("close","local",e))}},{key:"remoteClose",value:function(e){v.debug("remoteClose()"),this._closed||(this._closed=!0,this._transport&&this._transport.removeProducer(this,"remote",e),this._destroy(),this.emit("@close","remote",e),this.safeEmit("close","remote",e))}},{key:"_destroy",value:function(){this._transport=!1,this._rtpParameters=null;try{this._track.stop()}catch(e){}}},{key:"send",value:function(e){var t=this;return v.debug("send() [transport:%o]",e),this._closed?Promise.reject(new a.InvalidStateError("Producer closed")):this._transport?Promise.reject(new Error("already handled by a Transport")):"object"!==u(e)?Promise.reject(new TypeError("invalid Transport")):(this._transport=e,e.addProducer(this).then((function(){e.once("@close",(function(){t._closed||t._transport!==e||(t._transport.removeProducer(t,"local"),t._transport=null,t._rtpParameters=null,t.safeEmit("unhandled"))})),t.safeEmit("handled"),t._statsEnabled&&e.enableProducerStats(t,t._statsInterval)})).catch((function(e){throw t._transport=null,e})))}},{key:"pause",value:function(e){return v.debug("pause()"),this._closed?(v.error("pause() | Producer closed"),!1):!!this._locallyPaused||(this._locallyPaused=!0,this._track.enabled=!1,this._transport&&this._transport.pauseProducer(this,e),this.safeEmit("pause","local",e),this.paused)}},{key:"remotePause",value:function(e){v.debug("remotePause()"),this._closed||this._remotelyPaused||(this._remotelyPaused=!0,this._track.enabled=!1,this.safeEmit("pause","remote",e))}},{key:"resume",value:function(e){return v.debug("resume()"),this._closed?(v.error("resume() | Producer closed"),!1):!this._locallyPaused||(this._locallyPaused=!1,this._remotelyPaused||(this._track.enabled=!0),this._transport&&this._transport.resumeProducer(this,e),this.safeEmit("resume","local",e),!this.paused)}},{key:"remoteResume",value:function(e){v.debug("remoteResume()"),!this._closed&&this._remotelyPaused&&(this._remotelyPaused=!1,this._locallyPaused||(this._track.enabled=!0),this.safeEmit("resume","remote",e))}},{key:"replaceTrack",value:function(e){var t,r=this;if(v.debug("replaceTrack() [track:%o]",e),this._closed)return Promise.reject(new a.InvalidStateError("Producer closed"));if(!e)return Promise.reject(new TypeError("no track given"));if("ended"===e.readyState)return Promise.reject(new Error('track.readyState is "ended"'));try{t=e.clone()}catch(r){t=e}return Promise.resolve().then((function(){if(r._transport)return r._transport.replaceProducerTrack(r,t)})).then((function(){try{r._track.onended=null,r._track.stop()}catch(e){}return r.paused?t.enabled=!1:t.enabled=!0,r._originalTrack=e,r._track=t,r._handleTrack(),r._track}))}},{key:"setRtpParameters",value:function(e){this._rtpParameters=e}},{key:"enableStats",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:m;v.debug("enableStats() [interval:%s]",e),this._closed?v.error("enableStats() | Producer closed"):this._statsEnabled||(this._statsInterval="number"!=typeof e||e<1e3?m:e,this._statsEnabled=!0,this._transport&&this._transport.enableProducerStats(this,this._statsInterval))}},{key:"disableStats",value:function(){v.debug("disableStats()"),this._closed?v.error("disableStats() | Producer closed"):this._statsEnabled&&(this._statsEnabled=!1,this._transport&&this._transport.disableProducerStats(this))}},{key:"remoteStats",value:function(e){this.safeEmit("stats",e)}},{key:"_handleTrack",value:function(){var e=this;this._track.onended=function(){e._closed||(v.warn('track "ended" event'),e.safeEmit("trackended"))}}},{key:"id",get:function(){return this._id}},{key:"closed",get:function(){return this._closed}},{key:"kind",get:function(){return this._track.kind}},{key:"track",get:function(){return this._track}},{key:"originalTrack",get:function(){return this._originalTrack}},{key:"simulcast",get:function(){return this._simulcast}},{key:"appData",get:function(){return this._appData}},{key:"transport",get:function(){return this._transport}},{key:"rtpParameters",get:function(){return this._rtpParameters}},{key:"locallyPaused",get:function(){return this._locallyPaused}},{key:"remotelyPaused",get:function(){return this._remotelyPaused}},{key:"paused",get:function(){return this._locallyPaused||this._remotelyPaused}}])&&d(r.prototype,n),o&&d(r,o),t}(o.default);r.default=y},{"./EnhancedEventEmitter":4,"./Logger":5,"./errors":10,"./utils":33}],8:[function(e,t,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0}),r.default=void 0;var n=f(e("./Logger")),o=f(e("./EnhancedEventEmitter")),a=e("./errors"),i=function(e){if(e&&e.__esModule)return e;var t=p();if(t&&t.has(e))return t.get(e);var r={};if(null!=e){var n=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var o in e)if(Object.prototype.hasOwnProperty.call(e,o)){var a=n?Object.getOwnPropertyDescriptor(e,o):null;a&&(a.get||a.set)?Object.defineProperty(r,o,a):r[o]=e[o]}}r.default=e,t&&t.set(e,r);return r}(e("./ortc")),s=f(e("./Device")),c=f(e("./Transport")),u=f(e("./Producer")),d=f(e("./Peer")),l=f(e("./Consumer"));function p(){if("function"!=typeof WeakMap)return null;var e=new WeakMap;return p=function(){return e},e}function f(e){return e&&e.__esModule?e:{default:e}}function m(e){return(m="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function h(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}function v(e,t){return!t||"object"!==m(t)&&"function"!=typeof t?function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e):t}function y(e){return(y=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function _(e,t){return(_=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}var g=new n.default("Room"),b={new:"new",joining:"joining",joined:"joined",closed:"closed"},P=function(e){function t(e){var r;if(function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t),r=v(this,y(t).call(this,g)),g.debug("constructor() [options:%o]",e),!s.default.isSupported())throw new Error("current browser/device not supported");return e=e||{},r._settings={roomSettings:e.roomSettings,requestTimeout:e.requestTimeout||3e4,transportOptions:e.transportOptions||{},turnServers:e.turnServers||[],iceTransportPolicy:e.iceTransportPolicy||"all",rtcAudioJitterBufferMaxPackets:e.rtcAudioJitterBufferMaxPackets,rtcAudioJitterBufferMinDelayMs:e.rtcAudioJitterBufferMinDelayMs,spy:Boolean(e.spy)},r._state=b.new,r._peerName=null,r._transports=new Map,r._producers=new Map,r._peers=new Map,r._extendedRtpCapabilities=null,r._canSendByKind={audio:!1,video:!1},r}var r,n,o;return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&_(e,t)}(t,e),r=t,(n=[{key:"getTransportById",value:function(e){return this._transports.get(e)}},{key:"getProducerById",value:function(e){return this._producers.get(e)}},{key:"getPeerByName",value:function(e){return this._peers.get(e)}},{key:"join",value:function(e,t){var r,n=this;return g.debug('join() [peerName:"%s"]',e),"string"!=typeof e?Promise.reject(new TypeError("invalid peerName")):this._state!==b.new&&this._state!==b.closed?Promise.reject(new a.InvalidStateError('invalid state "'.concat(this._state,'"'))):(this._peerName=e,this._state=b.joining,Promise.resolve().then((function(){return n._settings.roomSettings?void(r=n._settings.roomSettings):n._sendRequest("queryRoom",{target:"room"}).then((function(e){r=e,g.debug("join() | got Room settings:%o",r)}))})).then((function(){return s.default.Handler.getNativeRtpCapabilities()})).then((function(e){g.debug("join() | native RTP capabilities:%o",e),n._extendedRtpCapabilities=i.getExtendedRtpCapabilities(e,r.rtpCapabilities),g.debug("join() | extended RTP capabilities:%o",n._extendedRtpCapabilities);var o=i.getUnsupportedCodecs(r.rtpCapabilities,r.mandatoryCodecPayloadTypes,n._extendedRtpCapabilities);if(o.length>0)throw g.error("%s mandatory room codecs not supported:%o",o.length,o),new a.UnsupportedError("mandatory room codecs not supported",o);n._canSendByKind.audio=i.canSend("audio",n._extendedRtpCapabilities),n._canSendByKind.video=i.canSend("video",n._extendedRtpCapabilities);var s=i.getRtpCapabilities(n._extendedRtpCapabilities);g.debug("join() | effective local RTP capabilities for receiving:%o",s);var c={target:"room",peerName:n._peerName,rtpCapabilities:s,spy:n._settings.spy,appData:t};return n._sendRequest("join",c).then((function(e){return e.peers}))})).then((function(e){var t=!0,r=!1,o=void 0;try{for(var a,i=(e||[])[Symbol.iterator]();!(t=(a=i.next()).done);t=!0){var s=a.value;try{n._handlePeerData(s)}catch(e){g.error("join() | error handling Peer:%o",e)}}}catch(e){r=!0,o=e}finally{try{t||null==i.return||i.return()}finally{if(r)throw o}}return n._state=b.joined,g.debug("join() | joined the Room"),n.peers})).catch((function(e){throw n._state=b.new,e})))}},{key:"leave",value:function(e){if(g.debug("leave()"),!this.closed){this._sendNotification("leave",{appData:e}),this._state=b.closed,this.safeEmit("close","local",e);var t=!0,r=!1,n=void 0;try{for(var o,a=this._transports.values()[Symbol.iterator]();!(t=(o=a.next()).done);t=!0)o.value.close()}catch(e){r=!0,n=e}finally{try{t||null==a.return||a.return()}finally{if(r)throw n}}var i=!0,s=!1,c=void 0;try{for(var u,d=this._producers.values()[Symbol.iterator]();!(i=(u=d.next()).done);i=!0)u.value.close()}catch(e){s=!0,c=e}finally{try{i||null==d.return||d.return()}finally{if(s)throw c}}var l=!0,p=!1,f=void 0;try{for(var m,h=this._peers.values()[Symbol.iterator]();!(l=(m=h.next()).done);l=!0)m.value.close()}catch(e){p=!0,f=e}finally{try{l||null==h.return||h.return()}finally{if(p)throw f}}}}},{key:"remoteClose",value:function(e){if(g.debug("remoteClose()"),!this.closed){this._state=b.closed,this.safeEmit("close","remote",e);var t=!0,r=!1,n=void 0;try{for(var o,a=this._transports.values()[Symbol.iterator]();!(t=(o=a.next()).done);t=!0)o.value.remoteClose(null,{destroy:!0})}catch(e){r=!0,n=e}finally{try{t||null==a.return||a.return()}finally{if(r)throw n}}var i=!0,s=!1,c=void 0;try{for(var u,d=this._producers.values()[Symbol.iterator]();!(i=(u=d.next()).done);i=!0)u.value.remoteClose()}catch(e){s=!0,c=e}finally{try{i||null==d.return||d.return()}finally{if(s)throw c}}var l=!0,p=!1,f=void 0;try{for(var m,h=this._peers.values()[Symbol.iterator]();!(l=(m=h.next()).done);l=!0)m.value.remoteClose()}catch(e){p=!0,f=e}finally{try{l||null==h.return||h.return()}finally{if(p)throw f}}}}},{key:"canSend",value:function(e){if("audio"!==e&&"video"!==e)throw new TypeError('invalid kind "'.concat(e,'"'));return!(!this.joined||this._settings.spy)&&this._canSendByKind[e]}},{key:"createTransport",value:function(e,t){var r=this;if(g.debug("createTransport() [direction:%s]",e),!this.joined)throw new a.InvalidStateError('invalid state "'.concat(this._state,'"'));if("send"!==e&&"recv"!==e)throw new TypeError('invalid direction "'.concat(e,'"'));if("send"===e&&this._settings.spy)throw new TypeError("a spy peer cannot send media to the room");var n=new c.default(e,this._extendedRtpCapabilities,this._settings,t);return this._transports.set(n.id,n),n.on("@request",(function(e,t,n,o){r._sendRequest(e,t).then(n).catch(o)})),n.on("@notify",(function(e,t){r._sendNotification(e,t)})),n.on("@close",(function(){r._transports.delete(n.id)})),n}},{key:"createProducer",value:function(e,t,r){var n=this;if(g.debug("createProducer() [track:%o, options:%o]",e,t),!this.joined)throw new a.InvalidStateError('invalid state "'.concat(this._state,'"'));if(this._settings.spy)throw new Error("a spy peer cannot send media to the room");if(!e)throw new TypeError("no track given");if(!this._canSendByKind[e.kind])throw new Error("cannot send ".concat(e.kind));if("ended"===e.readyState)throw new Error('track.readyState is "ended"');t=t||{};var o=new u.default(e,t,r);return this._producers.set(o.id,o),o.on("@close",(function(){n._producers.delete(o.id)})),o}},{key:"restartIce",value:function(){if(this.joined){var e=!0,t=!1,r=void 0;try{for(var n,o=this._transports.values()[Symbol.iterator]();!(e=(n=o.next()).done);e=!0)n.value.restartIce()}catch(e){t=!0,r=e}finally{try{e||null==o.return||o.return()}finally{if(t)throw r}}}else g.warn('restartIce() | invalid state "'.concat(this._state,'"'))}},{key:"receiveNotification",value:function(e){var t=this;if(this.closed)return Promise.reject(new a.InvalidStateError("Room closed"));if("object"!==m(e))return Promise.reject(new TypeError("wrong notification Object"));if(!0!==e.notification)return Promise.reject(new TypeError("not a notification"));if("string"!=typeof e.method)return Promise.reject(new TypeError("wrong/missing notification method"));var r=e.method;return g.debug("receiveNotification() [method:%s, notification:%o]",r,e),Promise.resolve().then((function(){switch(r){case"closed":var n=e.appData;t.remoteClose(n);break;case"transportClosed":var o=e.id,a=e.appData,i=t._transports.get(o);if(!i)throw new Error('Transport not found [id:"'.concat(o,'"]'));i.remoteClose(a,{destroy:!1});break;case"transportStats":var s=e.id,c=e.stats,u=t._transports.get(s);if(!u)throw new Error("Transport not found [id:".concat(s,"]"));u.remoteStats(c);break;case"newPeer":var d=e.name;if(t._peers.has(d))throw new Error('Peer already exists [name:"'.concat(d,'"]'));var l=e;t._handlePeerData(l);break;case"peerClosed":var p=e.name,f=e.appData,m=t._peers.get(p);if(!m)throw new Error('no Peer found [name:"'.concat(p,'"]'));m.remoteClose(f);break;case"producerPaused":var h=e.id,v=e.appData,y=t._producers.get(h);if(!y)throw new Error("Producer not found [id:".concat(h,"]"));y.remotePause(v);break;case"producerResumed":var _=e.id,g=e.appData,b=t._producers.get(_);if(!b)throw new Error("Producer not found [id:".concat(_,"]"));b.remoteResume(g);break;case"producerClosed":var P=e.id,w=e.appData,k=t._producers.get(P);if(!k)throw new Error("Producer not found [id:".concat(P,"]"));k.remoteClose(w);break;case"producerStats":var S=e.id,R=e.stats,T=t._producers.get(S);if(!T)throw new Error("Producer not found [id:".concat(S,"]"));T.remoteStats(R);break;case"newConsumer":var C=e.peerName,O=t._peers.get(C);if(!O)throw new Error('no Peer found [name:"'.concat(C,'"]'));var E=e;t._handleConsumerData(E,O);break;case"consumerClosed":var x=e.id,D=e.peerName,j=e.appData,I=t._peers.get(D);if(!I)throw new Error('no Peer found [name:"'.concat(D,'"]'));var L=I.getConsumerById(x);if(!L)throw new Error("Consumer not found [id:".concat(x,"]"));L.remoteClose(j);break;case"consumerPaused":var M=e.id,A=e.peerName,F=e.appData,B=t._peers.get(A);if(!B)throw new Error('no Peer found [name:"'.concat(A,'"]'));var U=B.getConsumerById(M);if(!U)throw new Error("Consumer not found [id:".concat(M,"]"));U.remotePause(F);break;case"consumerResumed":var N=e.id,G=e.peerName,W=e.appData,z=t._peers.get(G);if(!z)throw new Error('no Peer found [name:"'.concat(G,'"]'));var q=z.getConsumerById(N);if(!q)throw new Error("Consumer not found [id:".concat(N,"]"));q.remoteResume(W);break;case"consumerPreferredProfileSet":var K=e.id,V=e.peerName,J=e.profile,Q=t._peers.get(V);if(!Q)throw new Error('no Peer found [name:"'.concat(V,'"]'));var $=Q.getConsumerById(K);if(!$)throw new Error("Consumer not found [id:".concat(K,"]"));$.remoteSetPreferredProfile(J);break;case"consumerEffectiveProfileChanged":var H=e.id,Z=e.peerName,X=e.profile,Y=t._peers.get(Z);if(!Y)throw new Error('no Peer found [name:"'.concat(Z,'"]'));var ee=Y.getConsumerById(H);if(!ee)throw new Error("Consumer not found [id:".concat(H,"]"));ee.remoteEffectiveProfileChanged(X);break;case"consumerStats":var te=e.id,re=e.peerName,ne=e.stats,oe=t._peers.get(re);if(!oe)throw new Error('no Peer found [name:"'.concat(re,'"]'));var ae=oe.getConsumerById(te);if(!ae)throw new Error("Consumer not found [id:".concat(te,"]"));ae.remoteStats(ne);break;default:throw new Error('unknown notification method "'.concat(r,'"'))}})).catch((function(t){g.error("receiveNotification() failed [notification:%o]: %s",e,t)}))}},{key:"_sendRequest",value:function(e,t){var r=this,n=Object.assign({method:e,target:"peer"},t);return this.closed?(g.error("_sendRequest() | Room closed [method:%s, request:%o]",e,n),Promise.reject(new a.InvalidStateError("Room closed"))):(g.debug("_sendRequest() [method:%s, request:%o]",e,n),new Promise((function(t,o){var i=!1,s=setTimeout((function(){g.error("request failed [method:%s]: timeout",e),i=!0,o(new a.TimeoutError("timeout"))}),r._settings.requestTimeout);r.safeEmit("request",n,(function(n){if(!i){if(i=!0,clearTimeout(s),r.closed)return g.error("request failed [method:%s]: Room closed",e),void o(new Error("Room closed"));g.debug("request succeeded [method:%s, response:%o]",e,n),t(n)}}),(function(t){if(!i){if(i=!0,clearTimeout(s),r.closed)return g.error("request failed [method:%s]: Room closed",e),void o(new Error("Room closed"));t instanceof Error||(t=new Error(String(t))),g.error("request failed [method:%s]:%o",e,t),o(t)}}))})))}},{key:"_sendNotification",value:function(e,t){if(!this.closed){var r=Object.assign({method:e,target:"peer",notification:!0},t);g.debug("_sendNotification() [method:%s, notification:%o]",e,r),this.safeEmit("notify",r)}}},{key:"_handlePeerData",value:function(e){var t=this,r=e.name,n=e.consumers,o=e.appData,a=new d.default(r,o);this._peers.set(a.name,a),a.on("@close",(function(){t._peers.delete(a.name)}));var i=!0,s=!1,c=void 0;try{for(var u,l=n[Symbol.iterator]();!(i=(u=l.next()).done);i=!0){var p=u.value;try{this._handleConsumerData(p,a)}catch(e){g.error("error handling existing Consumer in Peer:%o",e)}}}catch(e){s=!0,c=e}finally{try{i||null==l.return||l.return()}finally{if(s)throw c}}this.joined&&this.safeEmit("newpeer",a)}},{key:"_handleConsumerData",value:function(e,t){var r=e.id,n=e.kind,o=e.rtpParameters,a=e.paused,s=e.appData,c=new l.default(r,n,o,t,s);i.canReceive(c.rtpParameters,this._extendedRtpCapabilities)&&c.setSupported(!0),a&&c.remotePause(),t.addConsumer(c)}},{key:"joined",get:function(){return this._state===b.joined}},{key:"closed",get:function(){return this._state===b.closed}},{key:"peerName",get:function(){return this._peerName}},{key:"transports",get:function(){return Array.from(this._transports.values())}},{key:"producers",get:function(){return Array.from(this._producers.values())}},{key:"peers",get:function(){return Array.from(this._peers.values())}}])&&h(r.prototype,n),o&&h(r,o),t}(o.default);r.default=P},{"./Consumer":2,"./Device":3,"./EnhancedEventEmitter":4,"./Logger":5,"./Peer":6,"./Producer":7,"./Transport":9,"./errors":10,"./ortc":32}],9:[function(e,t,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0}),r.default=void 0;var n=d(e("./Logger")),o=d(e("./EnhancedEventEmitter")),a=e("./errors"),i=function(e){if(e&&e.__esModule)return e;var t=u();if(t&&t.has(e))return t.get(e);var r={};if(null!=e){var n=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var o in e)if(Object.prototype.hasOwnProperty.call(e,o)){var a=n?Object.getOwnPropertyDescriptor(e,o):null;a&&(a.get||a.set)?Object.defineProperty(r,o,a):r[o]=e[o]}}r.default=e,t&&t.set(e,r);return r}(e("./utils")),s=d(e("./Device")),c=d(e("./CommandQueue"));function u(){if("function"!=typeof WeakMap)return null;var e=new WeakMap;return u=function(){return e},e}function d(e){return e&&e.__esModule?e:{default:e}}function l(e){return(l="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function p(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}function f(e){return(f=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function m(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function h(e,t){return(h=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}var v=new n.default("Transport"),y=function(e){function t(e,r,n,o){var a;return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t),a=function(e,t){return!t||"object"!==l(t)&&"function"!=typeof t?m(e):t}(this,f(t).call(this,v)),v.debug("constructor() [direction:%s, extendedRtpCapabilities:%o]",e,r),a._id=i.randomNumber(),a._closed=!1,a._direction=e,a._settings=n,a._appData=o,a._statsEnabled=!1,a._commandQueue=new c.default,a._handler=new s.default.Handler(e,r,n),a._connectionState="new",a._commandQueue.on("exec",a._execCommand.bind(m(a))),a._handleHandler(),a}var r,n,o;return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&h(e,t)}(t,e),r=t,(n=[{key:"close",value:function(e){v.debug("close()"),this._closed||(this._closed=!0,this._statsEnabled&&(this._statsEnabled=!1,this.disableStats()),this.safeEmit("@notify","closeTransport",{id:this._id,appData:e}),this.emit("@close"),this.safeEmit("close","local",e),this._destroy())}},{key:"remoteClose",value:function(e,t){var r=t.destroy;v.debug("remoteClose() [destroy:%s]",r),this._closed||(r?(this._closed=!0,this.emit("@close"),this.safeEmit("close","remote",e),this._destroy()):this._handler.remoteClosed())}},{key:"_destroy",value:function(){this._commandQueue.close(),this._handler.close()}},{key:"restartIce",value:function(){var e=this;v.debug("restartIce()"),this._closed||"new"!==this._connectionState&&Promise.resolve().then((function(){var t={id:e._id};return e.safeEmitAsPromise("@request","restartTransport",t)})).then((function(t){var r=t.iceParameters;return e._commandQueue.push("restartIce",{remoteIceParameters:r})})).catch((function(e){v.error("restartIce() | failed: %o",e)}))}},{key:"enableStats",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1e3;v.debug("enableStats() [interval:%s]",e),("number"!=typeof e||e<1e3)&&(e=1e3),this._statsEnabled=!0;var t={id:this._id,interval:e};this.safeEmit("@notify","enableTransportStats",t)}},{key:"disableStats",value:function(){v.debug("disableStats()"),this._statsEnabled=!1;var e={id:this._id};this.safeEmit("@notify","disableTransportStats",e)}},{key:"_handleHandler",value:function(){var e=this,t=this._handler;t.on("@connectionstatechange",(function(t){e._connectionState!==t&&(v.debug("Transport connection state changed to %s",t),e._connectionState=t,e._closed||e.safeEmit("connectionstatechange",t))})),t.on("@needcreatetransport",(function(t,r,n){var o={id:e._id,direction:e._direction,options:e._settings.transportOptions,appData:e._appData};t&&(t.dtlsParameters?o.dtlsParameters=t.dtlsParameters:t.plainRtpParameters&&(o.plainRtpParameters=t.plainRtpParameters)),e.safeEmit("@request","createTransport",o,r,n)})),t.on("@needupdatetransport",(function(t){var r={id:e._id};t&&(t.dtlsParameters?r.dtlsParameters=t.dtlsParameters:t.plainRtpParameters&&(r.plainRtpParameters=t.plainRtpParameters)),e.safeEmit("@notify","updateTransport",r)})),t.on("@needupdateproducer",(function(t,r){var n={id:t.id,rtpParameters:r};t.setRtpParameters(r),e.safeEmit("@notify","updateProducer",n)}))}},{key:"addProducer",value:function(e){return v.debug("addProducer() [producer:%o]",e),this._closed?Promise.reject(new a.InvalidStateError("Transport closed")):"send"!==this._direction?Promise.reject(new Error("not a sending Transport")):this._commandQueue.push("addProducer",{producer:e})}},{key:"removeProducer",value:function(e,t,r){v.debug("removeProducer() [producer:%o]",e),this._closed||this._commandQueue.push("removeProducer",{producer:e}).catch((function(){})),"local"===t&&this.safeEmit("@notify","closeProducer",{id:e.id,appData:r})}},{key:"pauseProducer",value:function(e,t){v.debug("pauseProducer() [producer:%o]",e);var r={id:e.id,appData:t};this.safeEmit("@notify","pauseProducer",r)}},{key:"resumeProducer",value:function(e,t){v.debug("resumeProducer() [producer:%o]",e);var r={id:e.id,appData:t};this.safeEmit("@notify","resumeProducer",r)}},{key:"replaceProducerTrack",value:function(e,t){return v.debug("replaceProducerTrack() [producer:%o]",e),this._commandQueue.push("replaceProducerTrack",{producer:e,track:t})}},{key:"enableProducerStats",value:function(e,t){v.debug("enableProducerStats() [producer:%o]",e);var r={id:e.id,interval:t};this.safeEmit("@notify","enableProducerStats",r)}},{key:"disableProducerStats",value:function(e){v.debug("disableProducerStats() [producer:%o]",e);var t={id:e.id};this.safeEmit("@notify","disableProducerStats",t)}},{key:"addConsumer",value:function(e){return v.debug("addConsumer() [consumer:%o]",e),this._closed?Promise.reject(new a.InvalidStateError("Transport closed")):"recv"!==this._direction?Promise.reject(new Error("not a receiving Transport")):this._commandQueue.push("addConsumer",{consumer:e})}},{key:"removeConsumer",value:function(e){v.debug("removeConsumer() [consumer:%o]",e),this._commandQueue.push("removeConsumer",{consumer:e}).catch((function(){}))}},{key:"pauseConsumer",value:function(e,t){v.debug("pauseConsumer() [consumer:%o]",e);var r={id:e.id,appData:t};this.safeEmit("@notify","pauseConsumer",r)}},{key:"resumeConsumer",value:function(e,t){v.debug("resumeConsumer() [consumer:%o]",e);var r={id:e.id,appData:t};this.safeEmit("@notify","resumeConsumer",r)}},{key:"setConsumerPreferredProfile",value:function(e,t){v.debug("setConsumerPreferredProfile() [consumer:%o]",e);var r={id:e.id,profile:t};this.safeEmit("@notify","setConsumerPreferredProfile",r)}},{key:"enableConsumerStats",value:function(e,t){v.debug("enableConsumerStats() [consumer:%o]",e);var r={id:e.id,interval:t};this.safeEmit("@notify","enableConsumerStats",r)}},{key:"disableConsumerStats",value:function(e){v.debug("disableConsumerStats() [consumer:%o]",e);var t={id:e.id};this.safeEmit("@notify","disableConsumerStats",t)}},{key:"remoteStats",value:function(e){this.safeEmit("stats",e)}},{key:"_execCommand",value:function(e,t){var r;try{switch(e.method){case"addProducer":var n=e.producer;r=this._execAddProducer(n);break;case"removeProducer":var o=e.producer;r=this._execRemoveProducer(o);break;case"replaceProducerTrack":var a=e.producer,i=e.track;r=this._execReplaceProducerTrack(a,i);break;case"addConsumer":var s=e.consumer;r=this._execAddConsumer(s);break;case"removeConsumer":var c=e.consumer;r=this._execRemoveConsumer(c);break;case"restartIce":var u=e.remoteIceParameters;r=this._execRestartIce(u);break;default:r=Promise.reject(new Error('unknown command method "'.concat(e.method,'"')))}}catch(e){r=Promise.reject(e)}t.promise=r}},{key:"_execAddProducer",value:function(e){var t,r=this;return v.debug("_execAddProducer()"),Promise.resolve().then((function(){return r._handler.addProducer(e)})).then((function(n){t=n;var o={id:e.id,kind:e.kind,transportId:r._id,rtpParameters:n,paused:e.locallyPaused,appData:e.appData};return r.safeEmitAsPromise("@request","createProducer",o)})).then((function(){e.setRtpParameters(t)}))}},{key:"_execRemoveProducer",value:function(e){return v.debug("_execRemoveProducer()"),this._handler.removeProducer(e)}},{key:"_execReplaceProducerTrack",value:function(e,t){return v.debug("_execReplaceProducerTrack()"),this._handler.replaceProducerTrack(e,t)}},{key:"_execAddConsumer",value:function(e){var t,r=this;return v.debug("_execAddConsumer()"),Promise.resolve().then((function(){return r._handler.addConsumer(e)})).then((function(n){t=n;var o={id:e.id,transportId:r.id,paused:e.locallyPaused,preferredProfile:e.preferredProfile};return r.safeEmitAsPromise("@request","enableConsumer",o)})).then((function(r){var n=r.paused,o=r.preferredProfile,a=r.effectiveProfile;return n&&e.remotePause(),o&&e.remoteSetPreferredProfile(o),a&&e.remoteEffectiveProfileChanged(a),t}))}},{key:"_execRemoveConsumer",value:function(e){return v.debug("_execRemoveConsumer()"),this._handler.removeConsumer(e)}},{key:"_execRestartIce",value:function(e){return v.debug("_execRestartIce()"),this._handler.restartIce(e)}},{key:"id",get:function(){return this._id}},{key:"closed",get:function(){return this._closed}},{key:"direction",get:function(){return this._direction}},{key:"appData",get:function(){return this._appData}},{key:"connectionState",get:function(){return this._connectionState}},{key:"handler",get:function(){return this._handler}}])&&p(r.prototype,n),o&&p(r,o),t}(o.default);r.default=y},{"./CommandQueue":1,"./Device":3,"./EnhancedEventEmitter":4,"./Logger":5,"./errors":10,"./utils":33}],10:[function(e,t,r){"use strict";function n(e){return(n="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function o(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function a(e,t){return!t||"object"!==n(t)&&"function"!=typeof t?i(e):t}function i(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function s(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&d(e,t)}function c(e){var t="function"==typeof Map?new Map:void 0;return(c=function(e){if(null===e||(r=e,-1===Function.toString.call(r).indexOf("[native code]")))return e;var r;if("function"!=typeof e)throw new TypeError("Super expression must either be null or a function");if(void 0!==t){if(t.has(e))return t.get(e);t.set(e,n)}function n(){return u(e,arguments,l(this).constructor)}return n.prototype=Object.create(e.prototype,{constructor:{value:n,enumerable:!1,writable:!0,configurable:!0}}),d(n,e)})(e)}function u(e,t,r){return(u=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],(function(){}))),!0}catch(e){return!1}}()?Reflect.construct:function(e,t,r){var n=[null];n.push.apply(n,t);var o=new(Function.bind.apply(e,n));return r&&d(o,r.prototype),o}).apply(null,arguments)}function d(e,t){return(d=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function l(e){return(l=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}Object.defineProperty(r,"__esModule",{value:!0}),r.UnsupportedError=r.TimeoutError=r.InvalidStateError=void 0;var p=function(e){function t(e){var r;return o(this,t),(r=a(this,l(t).call(this,e))).name="InvalidStateError",Error.hasOwnProperty("captureStackTrace")?Error.captureStackTrace(i(r),t):r.stack=new Error(e).stack,r}return s(t,e),t}(c(Error));r.InvalidStateError=p;var f=function(e){function t(e){var r;return o(this,t),(r=a(this,l(t).call(this,e))).name="TimeoutError",Error.hasOwnProperty("captureStackTrace")?Error.captureStackTrace(i(r),t):r.stack=new Error(e).stack,r}return s(t,e),t}(c(Error));r.TimeoutError=f;var m=function(e){function t(e,r){var n;return o(this,t),(n=a(this,l(t).call(this,e))).name="UnsupportedError",Error.hasOwnProperty("captureStackTrace")?Error.captureStackTrace(i(n),t):n.stack=new Error(e).stack,n.data=r,n}return s(t,e),t}(c(Error));r.UnsupportedError=m},{}],11:[function(e,t,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0}),r.default=void 0;var n=f(e("sdp-transform")),o=f(e("../Logger")),a=f(e("../EnhancedEventEmitter")),i=p(e("../utils")),s=p(e("../ortc")),c=p(e("./sdp/commonUtils")),u=p(e("./sdp/planBUtils")),d=f(e("./sdp/RemotePlanBSdp"));function l(){if("function"!=typeof WeakMap)return null;var e=new WeakMap;return l=function(){return e},e}function p(e){if(e&&e.__esModule)return e;var t=l();if(t&&t.has(e))return t.get(e);var r={};if(null!=e){var n=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var o in e)if(Object.prototype.hasOwnProperty.call(e,o)){var a=n?Object.getOwnPropertyDescriptor(e,o):null;a&&(a.get||a.set)?Object.defineProperty(r,o,a):r[o]=e[o]}}return r.default=e,t&&t.set(e,r),r}function f(e){return e&&e.__esModule?e:{default:e}}function m(e){return(m="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function h(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function v(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}function y(e,t,r){return t&&v(e.prototype,t),r&&v(e,r),e}function _(e,t){return!t||"object"!==m(t)&&"function"!=typeof t?function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e):t}function g(e){return(g=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function b(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&P(e,t)}function P(e,t){return(P=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}var w=new o.default("Chrome55"),k=function(e){function t(e,r,n){var o;return h(this,t),(o=_(this,g(t).call(this,w)))._pc=new RTCPeerConnection({iceServers:n.turnServers||[],iceTransportPolicy:n.iceTransportPolicy,bundlePolicy:"max-bundle",rtcpMuxPolicy:"require"}),o._rtpParametersByKind=r,o._remoteSdp=new d.default(e,r),o._pc.addEventListener("iceconnectionstatechange",(function(){switch(o._pc.iceConnectionState){case"checking":o.emit("@connectionstatechange","connecting");break;case"connected":case"completed":o.emit("@connectionstatechange","connected");break;case"failed":o.emit("@connectionstatechange","failed");break;case"disconnected":o.emit("@connectionstatechange","disconnected");break;case"closed":o.emit("@connectionstatechange","closed")}})),o}return b(t,e),y(t,[{key:"close",value:function(){w.debug("close()");try{this._pc.close()}catch(e){}}},{key:"remoteClosed",value:function(){w.debug("remoteClosed()"),this._transportReady=!1,this._transportUpdated&&(this._transportUpdated=!1)}}]),t}(a.default),S=function(e){function t(e,r){var n;return h(this,t),(n=_(this,g(t).call(this,"send",e,r)))._transportReady=!1,n._stream=new MediaStream,n}return b(t,e),y(t,[{key:"addProducer",value:function(e){var t,r=this,o=e.track;return w.debug("addProducer() [id:%s, kind:%s, trackId:%s]",e.id,e.kind,o.id),this._stream.getTrackById(o.id)?Promise.reject(new Error("track already added")):Promise.resolve().then((function(){return r._stream.addTrack(o),r._pc.addStream(r._stream),r._pc.createOffer()})).then((function(t){if(e.simulcast){w.debug("addProducer() | enabling simulcast");var a=n.default.parse(t.sdp);u.addSimulcastForTrack(a,o),t={type:"offer",sdp:n.default.write(a)}}return w.debug("addProducer() | calling pc.setLocalDescription() [offer:%o]",t),r._pc.setLocalDescription(t)})).then((function(){if(!r._transportReady)return r._setupTransport()})).then((function(){t=n.default.parse(r._pc.localDescription.sdp);var e={type:"answer",sdp:r._remoteSdp.createAnswerSdp(t)};return w.debug("addProducer() | calling pc.setRemoteDescription() [answer:%o]",e),r._pc.setRemoteDescription(e)})).then((function(){var n=i.clone(r._rtpParametersByKind[e.kind]);return u.fillRtpParametersForTrack(n,t,o),n})).catch((function(e){throw r._stream.removeTrack(o),r._pc.addStream(r._stream),e}))}},{key:"removeProducer",value:function(e){var t=this,r=e.track;return w.debug("removeProducer() [id:%s, kind:%s, trackId:%s]",e.id,e.kind,r.id),Promise.resolve().then((function(){return t._stream.removeTrack(r),t._pc.addStream(t._stream),t._pc.createOffer()})).then((function(e){return w.debug("removeProducer() | calling pc.setLocalDescription() [offer:%o]",e),t._pc.setLocalDescription(e)})).catch((function(e){if(0!==t._stream.getTracks().length)throw e;w.warn("removeProducer() | ignoring expected error due no sending tracks: %s",e.toString())})).then((function(){if("stable"!==t._pc.signalingState){var e=n.default.parse(t._pc.localDescription.sdp),r={type:"answer",sdp:t._remoteSdp.createAnswerSdp(e)};return w.debug("removeProducer() | calling pc.setRemoteDescription() [answer:%o]",r),t._pc.setRemoteDescription(r)}}))}},{key:"replaceProducerTrack",value:function(e,t){var r=this;w.debug("replaceProducerTrack() [id:%s, kind:%s, trackId:%s]",e.id,e.kind,t.id);var o,a=e.track;return Promise.resolve().then((function(){return r._stream.removeTrack(a),r._stream.addTrack(t),r._pc.addStream(r._stream),r._pc.createOffer()})).then((function(o){if(e.simulcast){w.debug("addProducer() | enabling simulcast");var a=n.default.parse(o.sdp);u.addSimulcastForTrack(a,t),o={type:"offer",sdp:n.default.write(a)}}return w.debug("replaceProducerTrack() | calling pc.setLocalDescription() [offer:%o]",o),r._pc.setLocalDescription(o)})).then((function(){o=n.default.parse(r._pc.localDescription.sdp);var e={type:"answer",sdp:r._remoteSdp.createAnswerSdp(o)};return w.debug("replaceProducerTrack() | calling pc.setRemoteDescription() [answer:%o]",e),r._pc.setRemoteDescription(e)})).then((function(){var n=i.clone(r._rtpParametersByKind[e.kind]);u.fillRtpParametersForTrack(n,o,t),r.safeEmit("@needupdateproducer",e,n)})).catch((function(e){throw r._stream.removeTrack(t),r._stream.addTrack(a),r._pc.addStream(r._stream),e}))}},{key:"restartIce",value:function(e){var t=this;return w.debug("restartIce()"),this._remoteSdp.updateTransportRemoteIceParameters(e),Promise.resolve().then((function(){return t._pc.createOffer({iceRestart:!0})})).then((function(e){return w.debug("restartIce() | calling pc.setLocalDescription() [offer:%o]",e),t._pc.setLocalDescription(e)})).then((function(){var e=n.default.parse(t._pc.localDescription.sdp),r={type:"answer",sdp:t._remoteSdp.createAnswerSdp(e)};return w.debug("restartIce() | calling pc.setRemoteDescription() [answer:%o]",r),t._pc.setRemoteDescription(r)}))}},{key:"_setupTransport",value:function(){var e=this;return w.debug("_setupTransport()"),Promise.resolve().then((function(){var t={},r=e._pc.localDescription.sdp,o=n.default.parse(r),a=c.extractDtlsParameters(o);return a.role="server",t.dtlsParameters=a,e._remoteSdp.setTransportLocalParameters(t),e.safeEmitAsPromise("@needcreatetransport",t)})).then((function(t){e._remoteSdp.setTransportRemoteParameters(t),e._transportReady=!0}))}}]),t}(k),R=function(e){function t(e,r){var n;return h(this,t),(n=_(this,g(t).call(this,"recv",e,r)))._transportCreated=!1,n._transportUpdated=!1,n._kinds=new Set,n._consumerInfos=new Map,n}return b(t,e),y(t,[{key:"addConsumer",value:function(e){var t=this;if(w.debug("addConsumer() [id:%s, kind:%s]",e.id,e.kind),this._consumerInfos.has(e.id))return Promise.reject(new Error("Consumer already added"));var r=e.rtpParameters.encodings[0],n=e.rtpParameters.rtcp.cname,o={kind:e.kind,streamId:"recv-stream-".concat(e.id),trackId:"consumer-".concat(e.kind,"-").concat(e.id),ssrc:r.ssrc,cname:n};return r.rtx&&r.rtx.ssrc&&(o.rtxSsrc=r.rtx.ssrc),this._consumerInfos.set(e.id,o),this._kinds.add(e.kind),Promise.resolve().then((function(){if(!t._transportCreated)return t._setupTransport()})).then((function(){var e={type:"offer",sdp:t._remoteSdp.createOfferSdp(Array.from(t._kinds),Array.from(t._consumerInfos.values()))};return w.debug("addConsumer() | calling pc.setRemoteDescription() [offer:%o]",e),t._pc.setRemoteDescription(e)})).then((function(){return t._pc.createAnswer()})).then((function(e){return w.debug("addConsumer() | calling pc.setLocalDescription() [answer:%o]",e),t._pc.setLocalDescription(e)})).then((function(){if(!t._transportUpdated)return t._updateTransport()})).then((function(){var e=t._pc.getRemoteStreams().find((function(e){return e.id===o.streamId})).getTrackById(o.trackId);if(!e)throw new Error("remote track not found");return e}))}},{key:"removeConsumer",value:function(e){var t=this;return w.debug("removeConsumer() [id:%s, kind:%s]",e.id,e.kind),this._consumerInfos.has(e.id)?(this._consumerInfos.delete(e.id),Promise.resolve().then((function(){var e={type:"offer",sdp:t._remoteSdp.createOfferSdp(Array.from(t._kinds),Array.from(t._consumerInfos.values()))};return w.debug("removeConsumer() | calling pc.setRemoteDescription() [offer:%o]",e),t._pc.setRemoteDescription(e)})).then((function(){return t._pc.createAnswer()})).then((function(e){return w.debug("removeConsumer() | calling pc.setLocalDescription() [answer:%o]",e),t._pc.setLocalDescription(e)}))):Promise.reject(new Error("Consumer not found"))}},{key:"restartIce",value:function(e){var t=this;return w.debug("restartIce()"),this._remoteSdp.updateTransportRemoteIceParameters(e),Promise.resolve().then((function(){var e={type:"offer",sdp:t._remoteSdp.createOfferSdp(Array.from(t._kinds),Array.from(t._consumerInfos.values()))};return w.debug("restartIce() | calling pc.setRemoteDescription() [offer:%o]",e),t._pc.setRemoteDescription(e)})).then((function(){return t._pc.createAnswer()})).then((function(e){return w.debug("restartIce() | calling pc.setLocalDescription() [answer:%o]",e),t._pc.setLocalDescription(e)}))}},{key:"_setupTransport",value:function(){var e=this;return w.debug("_setupTransport()"),Promise.resolve().then((function(){return e.safeEmitAsPromise("@needcreatetransport",null)})).then((function(t){e._remoteSdp.setTransportRemoteParameters(t),e._transportCreated=!0}))}},{key:"_updateTransport",value:function(){w.debug("_updateTransport()");var e=this._pc.localDescription.sdp,t=n.default.parse(e),r={dtlsParameters:c.extractDtlsParameters(t)};this.safeEmit("@needupdatetransport",r),this._transportUpdated=!0}}]),t}(k),T=function(){function e(t,r,n){var o;switch(h(this,e),w.debug("constructor() [direction:%s, extendedRtpCapabilities:%o]",t,r),t){case"send":return o={audio:s.getSendingRtpParameters("audio",r),video:s.getSendingRtpParameters("video",r)},new S(o,n);case"recv":return o={audio:s.getReceivingFullRtpParameters("audio",r),video:s.getReceivingFullRtpParameters("video",r)},new R(o,n)}}return y(e,null,[{key:"getNativeRtpCapabilities",value:function(){w.debug("getNativeRtpCapabilities()");var e=new RTCPeerConnection({iceServers:[],iceTransportPolicy:"all",bundlePolicy:"max-bundle",rtcpMuxPolicy:"require"});return e.createOffer({offerToReceiveAudio:!0,offerToReceiveVideo:!0}).then((function(t){try{e.close()}catch(e){}var r=n.default.parse(t.sdp);return c.extractRtpCapabilities(r)})).catch((function(t){try{e.close()}catch(e){}throw t}))}},{key:"tag",get:function(){return"Chrome55"}}]),e}();r.default=T},{"../EnhancedEventEmitter":4,"../Logger":5,"../ortc":32,"../utils":33,"./sdp/RemotePlanBSdp":24,"./sdp/commonUtils":26,"./sdp/planBUtils":28,"sdp-transform":42}],12:[function(e,t,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0}),r.default=void 0;var n=f(e("sdp-transform")),o=f(e("../Logger")),a=f(e("../EnhancedEventEmitter")),i=p(e("../utils")),s=p(e("../ortc")),c=p(e("./sdp/commonUtils")),u=p(e("./sdp/planBUtils")),d=f(e("./sdp/RemotePlanBSdp"));function l(){if("function"!=typeof WeakMap)return null;var e=new WeakMap;return l=function(){return e},e}function p(e){if(e&&e.__esModule)return e;var t=l();if(t&&t.has(e))return t.get(e);var r={};if(null!=e){var n=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var o in e)if(Object.prototype.hasOwnProperty.call(e,o)){var a=n?Object.getOwnPropertyDescriptor(e,o):null;a&&(a.get||a.set)?Object.defineProperty(r,o,a):r[o]=e[o]}}return r.default=e,t&&t.set(e,r),r}function f(e){return e&&e.__esModule?e:{default:e}}function m(e){return(m="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function h(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function v(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}function y(e,t,r){return t&&v(e.prototype,t),r&&v(e,r),e}function _(e,t){return!t||"object"!==m(t)&&"function"!=typeof t?function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e):t}function g(e){return(g=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function b(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&P(e,t)}function P(e,t){return(P=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}var w=new o.default("Chrome67"),k=function(e){function t(e,r,n){var o;return h(this,t),(o=_(this,g(t).call(this,w)))._pc=new RTCPeerConnection({iceServers:n.turnServers||[],iceTransportPolicy:n.iceTransportPolicy,bundlePolicy:"max-bundle",rtcpMuxPolicy:"require",sdpSemantics:"plan-b"}),o._rtpParametersByKind=r,o._remoteSdp=new d.default(e,r),o._pc.addEventListener("iceconnectionstatechange",(function(){switch(o._pc.iceConnectionState){case"checking":o.emit("@connectionstatechange","connecting");break;case"connected":case"completed":o.emit("@connectionstatechange","connected");break;case"failed":o.emit("@connectionstatechange","failed");break;case"disconnected":o.emit("@connectionstatechange","disconnected");break;case"closed":o.emit("@connectionstatechange","closed")}})),o}return b(t,e),y(t,[{key:"close",value:function(){w.debug("close()");try{this._pc.close()}catch(e){}}},{key:"remoteClosed",value:function(){w.debug("remoteClosed()"),this._transportReady=!1,this._transportUpdated&&(this._transportUpdated=!1)}}]),t}(a.default),S=function(e){function t(e,r){var n;return h(this,t),(n=_(this,g(t).call(this,"send",e,r)))._transportReady=!1,n._stream=new MediaStream,n}return b(t,e),y(t,[{key:"addProducer",value:function(e){var t,r=this,o=e.track;return w.debug("addProducer() [id:%s, kind:%s, trackId:%s]",e.id,e.kind,o.id),this._stream.getTrackById(o.id)?Promise.reject(new Error("track already added")):Promise.resolve().then((function(){return r._stream.addTrack(o),r._pc.addStream(r._stream),r._pc.createOffer()})).then((function(t){if(e.simulcast){w.debug("addProducer() | enabling simulcast");var a=n.default.parse(t.sdp);u.addSimulcastForTrack(a,o),t={type:"offer",sdp:n.default.write(a)}}return w.debug("addProducer() | calling pc.setLocalDescription() [offer:%o]",t),r._pc.setLocalDescription(t)})).then((function(){if(!r._transportReady)return r._setupTransport()})).then((function(){t=n.default.parse(r._pc.localDescription.sdp);var e={type:"answer",sdp:r._remoteSdp.createAnswerSdp(t)};return w.debug("addProducer() | calling pc.setRemoteDescription() [answer:%o]",e),r._pc.setRemoteDescription(e)})).then((function(){var n=i.clone(r._rtpParametersByKind[e.kind]);return u.fillRtpParametersForTrack(n,t,o),n})).catch((function(e){throw r._stream.removeTrack(o),r._pc.addStream(r._stream),e}))}},{key:"removeProducer",value:function(e){var t=this,r=e.track;return w.debug("removeProducer() [id:%s, kind:%s, trackId:%s]",e.id,e.kind,r.id),Promise.resolve().then((function(){return t._stream.removeTrack(r),t._pc.addStream(t._stream),t._pc.createOffer()})).then((function(e){return w.debug("removeProducer() | calling pc.setLocalDescription() [offer:%o]",e),t._pc.setLocalDescription(e)})).catch((function(e){if(0!==t._stream.getTracks().length)throw e;w.warn("removeProducer() | ignoring expected error due no sending tracks: %s",e.toString())})).then((function(){if("stable"!==t._pc.signalingState){var e=n.default.parse(t._pc.localDescription.sdp),r={type:"answer",sdp:t._remoteSdp.createAnswerSdp(e)};return w.debug("removeProducer() | calling pc.setRemoteDescription() [answer:%o]",r),t._pc.setRemoteDescription(r)}}))}},{key:"replaceProducerTrack",value:function(e,t){var r=this;w.debug("replaceProducerTrack() [id:%s, kind:%s, trackId:%s]",e.id,e.kind,t.id);var n=e.track;return Promise.resolve().then((function(){var e=r._pc.getSenders().find((function(e){return e.track===n}));if(!e)throw new Error("local track not found");return e.replaceTrack(t)})).then((function(){r._stream.removeTrack(n),r._stream.addTrack(t)}))}},{key:"restartIce",value:function(e){var t=this;return w.debug("restartIce()"),this._remoteSdp.updateTransportRemoteIceParameters(e),Promise.resolve().then((function(){return t._pc.createOffer({iceRestart:!0})})).then((function(e){return w.debug("restartIce() | calling pc.setLocalDescription() [offer:%o]",e),t._pc.setLocalDescription(e)})).then((function(){var e=n.default.parse(t._pc.localDescription.sdp),r={type:"answer",sdp:t._remoteSdp.createAnswerSdp(e)};return w.debug("restartIce() | calling pc.setRemoteDescription() [answer:%o]",r),t._pc.setRemoteDescription(r)}))}},{key:"_setupTransport",value:function(){var e=this;return w.debug("_setupTransport()"),Promise.resolve().then((function(){var t={},r=e._pc.localDescription.sdp,o=n.default.parse(r),a=c.extractDtlsParameters(o);return a.role="server",t.dtlsParameters=a,e._remoteSdp.setTransportLocalParameters(t),e.safeEmitAsPromise("@needcreatetransport",t)})).then((function(t){e._remoteSdp.setTransportRemoteParameters(t),e._transportReady=!0}))}}]),t}(k),R=function(e){function t(e,r){var n;return h(this,t),(n=_(this,g(t).call(this,"recv",e,r)))._transportCreated=!1,n._transportUpdated=!1,n._kinds=new Set,n._consumerInfos=new Map,n}return b(t,e),y(t,[{key:"addConsumer",value:function(e){var t=this;if(w.debug("addConsumer() [id:%s, kind:%s]",e.id,e.kind),this._consumerInfos.has(e.id))return Promise.reject(new Error("Consumer already added"));var r=e.rtpParameters.encodings[0],n=e.rtpParameters.rtcp.cname,o={kind:e.kind,streamId:"recv-stream-".concat(e.id),trackId:"consumer-".concat(e.kind,"-").concat(e.id),ssrc:r.ssrc,cname:n};return r.rtx&&r.rtx.ssrc&&(o.rtxSsrc=r.rtx.ssrc),this._consumerInfos.set(e.id,o),this._kinds.add(e.kind),Promise.resolve().then((function(){if(!t._transportCreated)return t._setupTransport()})).then((function(){var e={type:"offer",sdp:t._remoteSdp.createOfferSdp(Array.from(t._kinds),Array.from(t._consumerInfos.values()))};return w.debug("addConsumer() | calling pc.setRemoteDescription() [offer:%o]",e),t._pc.setRemoteDescription(e)})).then((function(){return t._pc.createAnswer()})).then((function(e){return w.debug("addConsumer() | calling pc.setLocalDescription() [answer:%o]",e),t._pc.setLocalDescription(e)})).then((function(){if(!t._transportUpdated)return t._updateTransport()})).then((function(){var e=t._pc.getRemoteStreams().find((function(e){return e.id===o.streamId})).getTrackById(o.trackId);if(!e)throw new Error("remote track not found");return e}))}},{key:"removeConsumer",value:function(e){var t=this;return w.debug("removeConsumer() [id:%s, kind:%s]",e.id,e.kind),this._consumerInfos.has(e.id)?(this._consumerInfos.delete(e.id),Promise.resolve().then((function(){var e={type:"offer",sdp:t._remoteSdp.createOfferSdp(Array.from(t._kinds),Array.from(t._consumerInfos.values()))};return w.debug("removeConsumer() | calling pc.setRemoteDescription() [offer:%o]",e),t._pc.setRemoteDescription(e)})).then((function(){return t._pc.createAnswer()})).then((function(e){return w.debug("removeConsumer() | calling pc.setLocalDescription() [answer:%o]",e),t._pc.setLocalDescription(e)}))):Promise.reject(new Error("Consumer not found"))}},{key:"restartIce",value:function(e){var t=this;return w.debug("restartIce()"),this._remoteSdp.updateTransportRemoteIceParameters(e),Promise.resolve().then((function(){var e={type:"offer",sdp:t._remoteSdp.createOfferSdp(Array.from(t._kinds),Array.from(t._consumerInfos.values()))};return w.debug("restartIce() | calling pc.setRemoteDescription() [offer:%o]",e),t._pc.setRemoteDescription(e)})).then((function(){return t._pc.createAnswer()})).then((function(e){return w.debug("restartIce() | calling pc.setLocalDescription() [answer:%o]",e),t._pc.setLocalDescription(e)}))}},{key:"_setupTransport",value:function(){var e=this;return w.debug("_setupTransport()"),Promise.resolve().then((function(){return e.safeEmitAsPromise("@needcreatetransport",null)})).then((function(t){e._remoteSdp.setTransportRemoteParameters(t),e._transportCreated=!0}))}},{key:"_updateTransport",value:function(){w.debug("_updateTransport()");var e=this._pc.localDescription.sdp,t=n.default.parse(e),r={dtlsParameters:c.extractDtlsParameters(t)};this.safeEmit("@needupdatetransport",r),this._transportUpdated=!0}}]),t}(k),T=function(){function e(t,r,n){var o;switch(h(this,e),w.debug("constructor() [direction:%s, extendedRtpCapabilities:%o]",t,r),t){case"send":return o={audio:s.getSendingRtpParameters("audio",r),video:s.getSendingRtpParameters("video",r)},new S(o,n);case"recv":return o={audio:s.getReceivingFullRtpParameters("audio",r),video:s.getReceivingFullRtpParameters("video",r)},new R(o,n)}}return y(e,null,[{key:"getNativeRtpCapabilities",value:function(){w.debug("getNativeRtpCapabilities()");var e=new RTCPeerConnection({iceServers:[],iceTransportPolicy:"all",bundlePolicy:"max-bundle",rtcpMuxPolicy:"require",sdpSemantics:"plan-b"});return e.createOffer({offerToReceiveAudio:!0,offerToReceiveVideo:!0}).then((function(t){try{e.close()}catch(e){}var r=n.default.parse(t.sdp);return c.extractRtpCapabilities(r)})).catch((function(t){try{e.close()}catch(e){}throw t}))}},{key:"tag",get:function(){return"Chrome67"}}]),e}();r.default=T},{"../EnhancedEventEmitter":4,"../Logger":5,"../ortc":32,"../utils":33,"./sdp/RemotePlanBSdp":24,"./sdp/commonUtils":26,"./sdp/planBUtils":28,"sdp-transform":42}],13:[function(e,t,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0}),r.default=void 0;var n=f(e("sdp-transform")),o=f(e("../Logger")),a=f(e("../EnhancedEventEmitter")),i=p(e("../utils")),s=p(e("../ortc")),c=p(e("./sdp/commonUtils")),u=p(e("./sdp/planBUtils")),d=f(e("./sdp/RemotePlanBSdp"));function l(){if("function"!=typeof WeakMap)return null;var e=new WeakMap;return l=function(){return e},e}function p(e){if(e&&e.__esModule)return e;var t=l();if(t&&t.has(e))return t.get(e);var r={};if(null!=e){var n=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var o in e)if(Object.prototype.hasOwnProperty.call(e,o)){var a=n?Object.getOwnPropertyDescriptor(e,o):null;a&&(a.get||a.set)?Object.defineProperty(r,o,a):r[o]=e[o]}}return r.default=e,t&&t.set(e,r),r}function f(e){return e&&e.__esModule?e:{default:e}}function m(e){return(m="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function h(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function v(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}function y(e,t,r){return t&&v(e.prototype,t),r&&v(e,r),e}function _(e,t){return!t||"object"!==m(t)&&"function"!=typeof t?function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e):t}function g(e){return(g=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function b(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&P(e,t)}function P(e,t){return(P=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}var w=new o.default("Chrome69"),k=function(e){function t(e,r,n){var o;return h(this,t),(o=_(this,g(t).call(this,w)))._pc=new RTCPeerConnection({iceServers:n.turnServers||[],iceTransportPolicy:n.iceTransportPolicy,bundlePolicy:"max-bundle",rtcpMuxPolicy:"require",sdpSemantics:"plan-b",rtcAudioJitterBufferMaxPackets:n.rtcAudioJitterBufferMaxPackets,rtcAudioJitterBufferMinDelayMs:n.rtcAudioJitterBufferMinDelayMs}),o._rtpParametersByKind=r,o._remoteSdp=new d.default(e,r),o._pc.addEventListener("iceconnectionstatechange",(function(){switch(o._pc.iceConnectionState){case"checking":o.emit("@connectionstatechange","connecting");break;case"connected":case"completed":o.emit("@connectionstatechange","connected");break;case"failed":o.emit("@connectionstatechange","failed");break;case"disconnected":o.emit("@connectionstatechange","disconnected");break;case"closed":o.emit("@connectionstatechange","closed")}})),o}return b(t,e),y(t,[{key:"close",value:function(){w.debug("close()");try{this._pc.close()}catch(e){}}},{key:"remoteClosed",value:function(){w.debug("remoteClosed()"),this._transportReady=!1,this._transportUpdated&&(this._transportUpdated=!1)}}]),t}(a.default),S=function(e){function t(e,r){var n;return h(this,t),(n=_(this,g(t).call(this,"send",e,r)))._transportReady=!1,n._stream=new MediaStream,n}return b(t,e),y(t,[{key:"addProducer",value:function(e){var t,r,o=this,a=e.track;return w.debug("addProducer() [id:%s, kind:%s, trackId:%s]",e.id,e.kind,a.id),this._stream.getTrackById(a.id)?Promise.reject(new Error("track already added")):Promise.resolve().then((function(){return o._stream.addTrack(a),t=o._pc.addTrack(a,o._stream),o._pc.createOffer()})).then((function(t){if(e.simulcast){w.debug("addProducer() | enabling simulcast");var r=n.default.parse(t.sdp);u.addSimulcastForTrack(r,a),t={type:"offer",sdp:n.default.write(r)}}return w.debug("addProducer() | calling pc.setLocalDescription() [offer:%o]",t),o._pc.setLocalDescription(t)})).then((function(){if(!o._transportReady)return o._setupTransport()})).then((function(){r=n.default.parse(o._pc.localDescription.sdp);var e={type:"answer",sdp:o._remoteSdp.createAnswerSdp(r)};return w.debug("addProducer() | calling pc.setRemoteDescription() [answer:%o]",e),o._pc.setRemoteDescription(e)})).then((function(){var t=i.clone(o._rtpParametersByKind[e.kind]);return u.fillRtpParametersForTrack(t,r,a),t})).catch((function(e){try{o._pc.removeTrack(t)}catch(e){}throw o._stream.removeTrack(a),e}))}},{key:"removeProducer",value:function(e){var t=this,r=e.track;return w.debug("removeProducer() [id:%s, kind:%s, trackId:%s]",e.id,e.kind,r.id),Promise.resolve().then((function(){var e=t._pc.getSenders().find((function(e){return e.track===r}));if(!e)throw new Error("RTCRtpSender not found");return t._pc.removeTrack(e),t._stream.removeTrack(r),t._pc.createOffer()})).then((function(e){return w.debug("removeProducer() | calling pc.setLocalDescription() [offer:%o]",e),t._pc.setLocalDescription(e)})).catch((function(e){if(0!==t._stream.getTracks().length)throw e;w.warn("removeProducer() | ignoring expected error due no sending tracks: %s",e.toString())})).then((function(){if("stable"!==t._pc.signalingState){var e=n.default.parse(t._pc.localDescription.sdp),r={type:"answer",sdp:t._remoteSdp.createAnswerSdp(e)};return w.debug("removeProducer() | calling pc.setRemoteDescription() [answer:%o]",r),t._pc.setRemoteDescription(r)}}))}},{key:"replaceProducerTrack",value:function(e,t){var r=this;w.debug("replaceProducerTrack() [id:%s, kind:%s, trackId:%s]",e.id,e.kind,t.id);var n=e.track;return Promise.resolve().then((function(){var e=r._pc.getSenders().find((function(e){return e.track===n}));if(!e)throw new Error("local track not found");return e.replaceTrack(t)})).then((function(){r._stream.removeTrack(n),r._stream.addTrack(t)}))}},{key:"restartIce",value:function(e){var t=this;return w.debug("restartIce()"),this._remoteSdp.updateTransportRemoteIceParameters(e),Promise.resolve().then((function(){return t._pc.createOffer({iceRestart:!0})})).then((function(e){return w.debug("restartIce() | calling pc.setLocalDescription() [offer:%o]",e),t._pc.setLocalDescription(e)})).then((function(){var e=n.default.parse(t._pc.localDescription.sdp),r={type:"answer",sdp:t._remoteSdp.createAnswerSdp(e)};return w.debug("restartIce() | calling pc.setRemoteDescription() [answer:%o]",r),t._pc.setRemoteDescription(r)}))}},{key:"_setupTransport",value:function(){var e=this;return w.debug("_setupTransport()"),Promise.resolve().then((function(){var t={},r=e._pc.localDescription.sdp,o=n.default.parse(r),a=c.extractDtlsParameters(o);return a.role="server",t.dtlsParameters=a,e._remoteSdp.setTransportLocalParameters(t),e.safeEmitAsPromise("@needcreatetransport",t)})).then((function(t){e._remoteSdp.setTransportRemoteParameters(t),e._transportReady=!0}))}}]),t}(k),R=function(e){function t(e,r){var n;return h(this,t),(n=_(this,g(t).call(this,"recv",e,r)))._transportCreated=!1,n._transportUpdated=!1,n._kinds=new Set,n._consumerInfos=new Map,n}return b(t,e),y(t,[{key:"addConsumer",value:function(e){var t=this;if(w.debug("addConsumer() [id:%s, kind:%s]",e.id,e.kind),this._consumerInfos.has(e.id))return Promise.reject(new Error("Consumer already added"));var r=e.rtpParameters.encodings[0],n=e.rtpParameters.rtcp.cname,o={kind:e.kind,streamId:"recv-stream-".concat(e.id),trackId:"consumer-".concat(e.kind,"-").concat(e.id),ssrc:r.ssrc,cname:n};return r.rtx&&r.rtx.ssrc&&(o.rtxSsrc=r.rtx.ssrc),this._consumerInfos.set(e.id,o),this._kinds.add(e.kind),Promise.resolve().then((function(){if(!t._transportCreated)return t._setupTransport()})).then((function(){var e={type:"offer",sdp:t._remoteSdp.createOfferSdp(Array.from(t._kinds),Array.from(t._consumerInfos.values()))};return w.debug("addConsumer() | calling pc.setRemoteDescription() [offer:%o]",e),t._pc.setRemoteDescription(e)})).then((function(){return t._pc.createAnswer()})).then((function(e){return w.debug("addConsumer() | calling pc.setLocalDescription() [answer:%o]",e),t._pc.setLocalDescription(e)})).then((function(){if(!t._transportUpdated)return t._updateTransport()})).then((function(){var e=t._pc.getReceivers().find((function(e){var t=e.track;return!!t&&t.id===o.trackId}));if(!e)throw new Error("remote track not found");return e.track}))}},{key:"removeConsumer",value:function(e){var t=this;return w.debug("removeConsumer() [id:%s, kind:%s]",e.id,e.kind),this._consumerInfos.has(e.id)?(this._consumerInfos.delete(e.id),Promise.resolve().then((function(){var e={type:"offer",sdp:t._remoteSdp.createOfferSdp(Array.from(t._kinds),Array.from(t._consumerInfos.values()))};return w.debug("removeConsumer() | calling pc.setRemoteDescription() [offer:%o]",e),t._pc.setRemoteDescription(e)})).then((function(){return t._pc.createAnswer()})).then((function(e){return w.debug("removeConsumer() | calling pc.setLocalDescription() [answer:%o]",e),t._pc.setLocalDescription(e)}))):Promise.reject(new Error("Consumer not found"))}},{key:"restartIce",value:function(e){var t=this;return w.debug("restartIce()"),this._remoteSdp.updateTransportRemoteIceParameters(e),Promise.resolve().then((function(){var e={type:"offer",sdp:t._remoteSdp.createOfferSdp(Array.from(t._kinds),Array.from(t._consumerInfos.values()))};return w.debug("restartIce() | calling pc.setRemoteDescription() [offer:%o]",e),t._pc.setRemoteDescription(e)})).then((function(){return t._pc.createAnswer()})).then((function(e){return w.debug("restartIce() | calling pc.setLocalDescription() [answer:%o]",e),t._pc.setLocalDescription(e)}))}},{key:"_setupTransport",value:function(){var e=this;return w.debug("_setupTransport()"),Promise.resolve().then((function(){return e.safeEmitAsPromise("@needcreatetransport",null)})).then((function(t){e._remoteSdp.setTransportRemoteParameters(t),e._transportCreated=!0}))}},{key:"_updateTransport",value:function(){w.debug("_updateTransport()");var e=this._pc.localDescription.sdp,t=n.default.parse(e),r={dtlsParameters:c.extractDtlsParameters(t)};this.safeEmit("@needupdatetransport",r),this._transportUpdated=!0}}]),t}(k),T=function(){function e(t,r,n){var o;switch(h(this,e),w.debug("constructor() [direction:%s, extendedRtpCapabilities:%o]",t,r),t){case"send":return o={audio:s.getSendingRtpParameters("audio",r),video:s.getSendingRtpParameters("video",r)},new S(o,n);case"recv":return o={audio:s.getReceivingFullRtpParameters("audio",r),video:s.getReceivingFullRtpParameters("video",r)},new R(o,n)}}return y(e,null,[{key:"getNativeRtpCapabilities",value:function(){w.debug("getNativeRtpCapabilities()");var e=new RTCPeerConnection({iceServers:[],iceTransportPolicy:"all",bundlePolicy:"max-bundle",rtcpMuxPolicy:"require",sdpSemantics:"plan-b"});return e.createOffer({offerToReceiveAudio:!0,offerToReceiveVideo:!0}).then((function(t){try{e.close()}catch(e){}var r=n.default.parse(t.sdp);return c.extractRtpCapabilities(r)})).catch((function(t){try{e.close()}catch(e){}throw t}))}},{key:"tag",get:function(){return"Chrome69"}}]),e}();r.default=T},{"../EnhancedEventEmitter":4,"../Logger":5,"../ortc":32,"../utils":33,"./sdp/RemotePlanBSdp":24,"./sdp/commonUtils":26,"./sdp/planBUtils":28,"sdp-transform":42}],14:[function(e,t,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0}),r.default=void 0;var n=f(e("sdp-transform")),o=f(e("../Logger")),a=f(e("../EnhancedEventEmitter")),i=p(e("../utils")),s=p(e("../ortc")),c=p(e("./sdp/commonUtils")),u=p(e("./sdp/unifiedPlanUtils")),d=f(e("./sdp/RemoteUnifiedPlanSdp"));function l(){if("function"!=typeof WeakMap)return null;var e=new WeakMap;return l=function(){return e},e}function p(e){if(e&&e.__esModule)return e;var t=l();if(t&&t.has(e))return t.get(e);var r={};if(null!=e){var n=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var o in e)if(Object.prototype.hasOwnProperty.call(e,o)){var a=n?Object.getOwnPropertyDescriptor(e,o):null;a&&(a.get||a.set)?Object.defineProperty(r,o,a):r[o]=e[o]}}return r.default=e,t&&t.set(e,r),r}function f(e){return e&&e.__esModule?e:{default:e}}function m(e){return(m="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function h(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function v(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}function y(e,t,r){return t&&v(e.prototype,t),r&&v(e,r),e}function _(e,t){return!t||"object"!==m(t)&&"function"!=typeof t?function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e):t}function g(e){return(g=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function b(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&P(e,t)}function P(e,t){return(P=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}var w=new o.default("Chrome70"),k=function(e){function t(e,r,n){var o;return h(this,t),(o=_(this,g(t).call(this,w)))._pc=new RTCPeerConnection({iceServers:n.turnServers||[],iceTransportPolicy:n.iceTransportPolicy,bundlePolicy:"max-bundle",rtcpMuxPolicy:"require",sdpSemantics:"unified-plan",rtcAudioJitterBufferMaxPackets:n.rtcAudioJitterBufferMaxPackets,rtcAudioJitterBufferMinDelayMs:n.rtcAudioJitterBufferMinDelayMs}),o._rtpParametersByKind=r,o._remoteSdp=new d.default(e,r),o._pc.addEventListener("iceconnectionstatechange",(function(){switch(o._pc.iceConnectionState){case"checking":o.emit("@connectionstatechange","connecting");break;case"connected":case"completed":o.emit("@connectionstatechange","connected");break;case"failed":o.emit("@connectionstatechange","failed");break;case"disconnected":o.emit("@connectionstatechange","disconnected");break;case"closed":o.emit("@connectionstatechange","closed")}})),o}return b(t,e),y(t,[{key:"close",value:function(){w.debug("close()");try{this._pc.close()}catch(e){}}},{key:"remoteClosed",value:function(){w.debug("remoteClosed()"),this._transportReady=!1,this._transportUpdated&&(this._transportUpdated=!1)}}]),t}(a.default),S=function(e){function t(e,r){var n;return h(this,t),(n=_(this,g(t).call(this,"send",e,r)))._transportReady=!1,n._trackIds=new Set,n}return b(t,e),y(t,[{key:"addProducer",value:function(e){var t,r,o=this,a=e.track;return w.debug("addProducer() [id:%s, kind:%s, trackId:%s]",e.id,e.kind,a.id),this._trackIds.has(a.id)?Promise.reject(new Error("track already added")):(this._trackIds.add(a.id),Promise.resolve().then((function(){if(t=o._pc.getTransceivers().find((function(e){return e.receiver.track.kind===a.kind&&"inactive"===e.direction})))return w.debug("addProducer() | reusing an inactive transceiver"),t.direction="sendonly",t.sender.replaceTrack(a);t=o._pc.addTransceiver(a,{direction:"sendonly"})})).then((function(){return o._pc.createOffer()})).then((function(r){if(e.simulcast){w.debug("addProducer() | enabling simulcast");var i=n.default.parse(r.sdp);u.addPlanBSimulcast(i,a,{mid:t.mid}),r={type:"offer",sdp:n.default.write(i)}}return w.debug("addProducer() | calling pc.setLocalDescription() [offer:%o]",r),o._pc.setLocalDescription(r)})).then((function(){if(!o._transportReady)return o._setupTransport()})).then((function(){r=n.default.parse(o._pc.localDescription.sdp);var e={type:"answer",sdp:o._remoteSdp.createAnswerSdp(r)};return w.debug("addProducer() | calling pc.setRemoteDescription() [answer:%o]",e),o._pc.setRemoteDescription(e)})).then((function(){var n=i.clone(o._rtpParametersByKind[e.kind]);return u.fillRtpParametersForTrack(n,r,a,{mid:t.mid,planBSimulcast:!0}),n})).catch((function(e){try{t.direction="inactive"}catch(e){}throw o._trackIds.delete(a.id),e})))}},{key:"removeProducer",value:function(e){var t=this,r=e.track;return this._trackIds.has(r.id)?(w.debug("removeProducer() [id:%s, kind:%s, trackId:%s]",e.id,e.kind,r.id),Promise.resolve().then((function(){var e=t._pc.getSenders().find((function(e){return e.track===r}));if(!e)throw new Error("local track not found");return t._pc.removeTrack(e),t._trackIds.delete(r.id),t._pc.createOffer()})).then((function(e){return w.debug("removeProducer() | calling pc.setLocalDescription() [offer:%o]",e),t._pc.setLocalDescription(e)})).then((function(){var e=n.default.parse(t._pc.localDescription.sdp),r={type:"answer",sdp:t._remoteSdp.createAnswerSdp(e)};return w.debug("removeProducer() | calling pc.setRemoteDescription() [answer:%o]",r),t._pc.setRemoteDescription(r)}))):Promise.reject(new Error("track not found"))}},{key:"replaceProducerTrack",value:function(e,t){var r=this;w.debug("replaceProducerTrack() [id:%s, kind:%s, trackId:%s]",e.id,e.kind,t.id);var n=e.track;return Promise.resolve().then((function(){var e=r._pc.getSenders().find((function(e){return e.track===n}));if(!e)throw new Error("local track not found");return e.replaceTrack(t)})).then((function(){r._trackIds.delete(n.id),r._trackIds.add(t.id)}))}},{key:"restartIce",value:function(e){var t=this;return w.debug("restartIce()"),this._remoteSdp.updateTransportRemoteIceParameters(e),Promise.resolve().then((function(){return t._pc.createOffer({iceRestart:!0})})).then((function(e){return w.debug("restartIce() | calling pc.setLocalDescription() [offer:%o]",e),t._pc.setLocalDescription(e)})).then((function(){var e=n.default.parse(t._pc.localDescription.sdp),r={type:"answer",sdp:t._remoteSdp.createAnswerSdp(e)};return w.debug("restartIce() | calling pc.setRemoteDescription() [answer:%o]",r),t._pc.setRemoteDescription(r)}))}},{key:"_setupTransport",value:function(){var e=this;return w.debug("_setupTransport()"),Promise.resolve().then((function(){var t={},r=e._pc.localDescription.sdp,o=n.default.parse(r),a=c.extractDtlsParameters(o);return a.role="server",t.dtlsParameters=a,e._remoteSdp.setTransportLocalParameters(t),e.safeEmitAsPromise("@needcreatetransport",t)})).then((function(t){e._remoteSdp.setTransportRemoteParameters(t),e._transportReady=!0}))}}]),t}(k),R=function(e){function t(e,r){var n;return h(this,t),(n=_(this,g(t).call(this,"recv",e,r)))._transportCreated=!1,n._transportUpdated=!1,n._consumerInfos=new Map,n}return b(t,e),y(t,[{key:"addConsumer",value:function(e){var t=this;if(w.debug("addConsumer() [id:%s, kind:%s]",e.id,e.kind),this._consumerInfos.has(e.id))return Promise.reject(new Error("Consumer already added"));var r=e.rtpParameters.encodings[0],n=e.rtpParameters.rtcp.cname,o={mid:"".concat(e.kind[0]).concat(e.id),kind:e.kind,closed:e.closed,streamId:"recv-stream-".concat(e.id),trackId:"consumer-".concat(e.kind,"-").concat(e.id),ssrc:r.ssrc,cname:n};return r.rtx&&r.rtx.ssrc&&(o.rtxSsrc=r.rtx.ssrc),this._consumerInfos.set(e.id,o),Promise.resolve().then((function(){if(!t._transportCreated)return t._setupTransport()})).then((function(){var e={type:"offer",sdp:t._remoteSdp.createOfferSdp(Array.from(t._consumerInfos.values()))};return w.debug("addConsumer() | calling pc.setRemoteDescription() [offer:%o]",e),t._pc.setRemoteDescription(e)})).then((function(){return t._pc.createAnswer()})).then((function(e){return w.debug("addConsumer() | calling pc.setLocalDescription() [answer:%o]",e),t._pc.setLocalDescription(e)})).then((function(){if(!t._transportUpdated)return t._updateTransport()})).then((function(){var e=t._pc.getTransceivers().find((function(e){return e.mid===o.mid}));if(!e)throw new Error("remote track not found");return e.receiver.track}))}},{key:"removeConsumer",value:function(e){var t=this;w.debug("removeConsumer() [id:%s, kind:%s]",e.id,e.kind);var r=this._consumerInfos.get(e.id);return r?(r.closed=!0,Promise.resolve().then((function(){var e={type:"offer",sdp:t._remoteSdp.createOfferSdp(Array.from(t._consumerInfos.values()))};return w.debug("removeConsumer() | calling pc.setRemoteDescription() [offer:%o]",e),t._pc.setRemoteDescription(e)})).then((function(){return t._pc.createAnswer()})).then((function(e){return w.debug("removeConsumer() | calling pc.setLocalDescription() [answer:%o]",e),t._pc.setLocalDescription(e)}))):Promise.reject(new Error("Consumer not found"))}},{key:"restartIce",value:function(e){var t=this;return w.debug("restartIce()"),this._remoteSdp.updateTransportRemoteIceParameters(e),Promise.resolve().then((function(){var e={type:"offer",sdp:t._remoteSdp.createOfferSdp(Array.from(t._consumerInfos.values()))};return w.debug("restartIce() | calling pc.setRemoteDescription() [offer:%o]",e),t._pc.setRemoteDescription(e)})).then((function(){return t._pc.createAnswer()})).then((function(e){return w.debug("restartIce() | calling pc.setLocalDescription() [answer:%o]",e),t._pc.setLocalDescription(e)}))}},{key:"_setupTransport",value:function(){var e=this;return w.debug("_setupTransport()"),Promise.resolve().then((function(){return e.safeEmitAsPromise("@needcreatetransport",null)})).then((function(t){e._remoteSdp.setTransportRemoteParameters(t),e._transportCreated=!0}))}},{key:"_updateTransport",value:function(){w.debug("_updateTransport()");var e=this._pc.localDescription.sdp,t=n.default.parse(e),r={dtlsParameters:c.extractDtlsParameters(t)};this.safeEmit("@needupdatetransport",r),this._transportUpdated=!0}}]),t}(k),T=function(){function e(t,r,n){var o;switch(h(this,e),w.debug("constructor() [direction:%s, extendedRtpCapabilities:%o]",t,r),t){case"send":return o={audio:s.getSendingRtpParameters("audio",r),video:s.getSendingRtpParameters("video",r)},new S(o,n);case"recv":return o={audio:s.getReceivingFullRtpParameters("audio",r),video:s.getReceivingFullRtpParameters("video",r)},new R(o,n)}}return y(e,null,[{key:"getNativeRtpCapabilities",value:function(){w.debug("getNativeRtpCapabilities()");var e=new RTCPeerConnection({iceServers:[],iceTransportPolicy:"all",bundlePolicy:"max-bundle",rtcpMuxPolicy:"require",sdpSemantics:"unified-plan"});return e.addTransceiver("audio"),e.addTransceiver("video"),e.createOffer().then((function(t){try{e.close()}catch(e){}var r=n.default.parse(t.sdp);return c.extractRtpCapabilities(r)})).catch((function(t){try{e.close()}catch(e){}throw t}))}},{key:"tag",get:function(){return"Chrome70"}}]),e}();r.default=T},{"../EnhancedEventEmitter":4,"../Logger":5,"../ortc":32,"../utils":33,"./sdp/RemoteUnifiedPlanSdp":25,"./sdp/commonUtils":26,"./sdp/unifiedPlanUtils":29,"sdp-transform":42}],15:[function(e,t,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0}),r.default=void 0;var n=d(e("../Logger")),o=d(e("../EnhancedEventEmitter")),a=u(e("../utils")),i=u(e("../ortc")),s=u(e("./ortc/edgeUtils"));function c(){if("function"!=typeof WeakMap)return null;var e=new WeakMap;return c=function(){return e},e}function u(e){if(e&&e.__esModule)return e;var t=c();if(t&&t.has(e))return t.get(e);var r={};if(null!=e){var n=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var o in e)if(Object.prototype.hasOwnProperty.call(e,o)){var a=n?Object.getOwnPropertyDescriptor(e,o):null;a&&(a.get||a.set)?Object.defineProperty(r,o,a):r[o]=e[o]}}return r.default=e,t&&t.set(e,r),r}function d(e){return e&&e.__esModule?e:{default:e}}function l(e){return(l="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function p(e,t){return!t||"object"!==l(t)&&"function"!=typeof t?function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e):t}function f(e){return(f=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function m(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}function h(e,t,r){return t&&m(e.prototype,t),r&&m(e,r),e}function v(e,t){return(v=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}var y="CNAME-EDGE-".concat(a.randomNumber()),_=new n.default("Edge11"),g=function(e){function t(e,r,n){var o;return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t),o=p(this,f(t).call(this,_)),_.debug("constructor() [direction:%s, extendedRtpCapabilities:%o]",e,r),o._rtpParametersByKind={audio:i.getSendingRtpParameters("audio",r),video:i.getSendingRtpParameters("video",r)},o._transportReady=!1,o._iceGatherer=null,o._iceTransport=null,o._dtlsTransport=null,o._rtpSenders=new Map,o._rtpReceivers=new Map,o._transportRemoteParameters=null,o._setIceGatherer(n),o._setIceTransport(),o._setDtlsTransport(),o}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&v(e,t)}(t,e),h(t,null,[{key:"getNativeRtpCapabilities",value:function(){return _.debug("getNativeRtpCapabilities()"),Promise.resolve(s.getCapabilities())}},{key:"tag",get:function(){return"Edge11"}}]),h(t,[{key:"close",value:function(){_.debug("close()");try{this._iceGatherer.close()}catch(e){}try{this._iceTransport.stop()}catch(e){}try{this._dtlsTransport.stop()}catch(e){}var e=!0,t=!1,r=void 0;try{for(var n,o=this._rtpSenders.values()[Symbol.iterator]();!(e=(n=o.next()).done);e=!0){var a=n.value;try{a.stop()}catch(e){}}}catch(e){t=!0,r=e}finally{try{e||null==o.return||o.return()}finally{if(t)throw r}}var i=!0,s=!1,c=void 0;try{for(var u,d=this._rtpReceivers.values()[Symbol.iterator]();!(i=(u=d.next()).done);i=!0){var l=u.value;try{l.stop()}catch(e){}}}catch(e){s=!0,c=e}finally{try{i||null==d.return||d.return()}finally{if(s)throw c}}}},{key:"remoteClosed",value:function(){_.debug("remoteClosed()"),this._transportReady=!1}},{key:"addProducer",value:function(e){var t=this,r=e.track;return _.debug("addProducer() [id:%s, kind:%s, trackId:%s]",e.id,e.kind,r.id),this._rtpSenders.has(e.id)?Promise.reject(new Error("Producer already added")):Promise.resolve().then((function(){if(!t._transportReady)return t._setupTransport()})).then((function(){_.debug("addProducer() | calling new RTCRtpSender()");var n=new RTCRtpSender(r,t._dtlsTransport),o=a.clone(t._rtpParametersByKind[e.kind]),i={ssrc:a.randomNumber()};o.codecs.some((function(e){return"rtx"===e.name}))&&(i.rtx={ssrc:a.randomNumber()}),o.encodings.push(i),o.rtcp={cname:y,reducedSize:!0,mux:!0};var c=s.mangleRtpParameters(o);return _.debug("addProducer() | calling rtpSender.send() [params:%o]",c),n.send(c),t._rtpSenders.set(e.id,n),o}))}},{key:"removeProducer",value:function(e){var t=this,r=e.track;return _.debug("removeProducer() [id:%s, kind:%s, trackId:%s]",e.id,e.kind,r.id),Promise.resolve().then((function(){var r=t._rtpSenders.get(e.id);if(!r)throw new Error("RTCRtpSender not found");t._rtpSenders.delete(e.id);try{_.debug("removeProducer() | calling rtpSender.stop()"),r.stop()}catch(e){_.warn("rtpSender.stop() failed:%o",e)}}))}},{key:"replaceProducerTrack",value:function(e,t){var r=this;return _.debug("replaceProducerTrack() [id:%s, kind:%s, trackId:%s]",e.id,e.kind,t.id),Promise.resolve().then((function(){var n=r._rtpSenders.get(e.id);if(!n)throw new Error("RTCRtpSender not found");n.setTrack(t)}))}},{key:"addConsumer",value:function(e){var t=this;return _.debug("addConsumer() [id:%s, kind:%s]",e.id,e.kind),this._rtpReceivers.has(e.id)?Promise.reject(new Error("Consumer already added")):Promise.resolve().then((function(){if(!t._transportReady)return t._setupTransport()})).then((function(){_.debug("addConsumer() | calling new RTCRtpReceiver()");var r=new RTCRtpReceiver(t._dtlsTransport,e.kind);r.addEventListener("error",(function(e){_.error('iceGatherer "error" event [event:%o]',e)}));var n=s.mangleRtpParameters(e.rtpParameters);return n.headerExtensions=n.headerExtensions.filter((function(e){return"urn:ietf:params:rtp-hdrext:sdes:mid"!==e.uri})),_.debug("addConsumer() | calling rtpReceiver.receive() [params:%o]",n),r.receive(n),t._rtpReceivers.set(e.id,r),r.track}))}},{key:"removeConsumer",value:function(e){var t=this;return _.debug("removeConsumer() [id:%s, kind:%s]",e.id,e.kind),Promise.resolve().then((function(){var r=t._rtpReceivers.get(e.id);if(!r)throw new Error("RTCRtpReceiver not found");t._rtpReceivers.delete(e.id);try{_.debug("removeConsumer() | calling rtpReceiver.stop()"),r.stop()}catch(e){_.warn("rtpReceiver.stop() failed:%o",e)}}))}},{key:"restartIce",value:function(e){var t=this;_.debug("restartIce()"),Promise.resolve().then((function(){t._transportRemoteParameters.iceParameters=e;var r=t._transportRemoteParameters.iceCandidates;_.debug("restartIce() | calling iceTransport.start()"),t._iceTransport.start(t._iceGatherer,e,"controlling");var n=!0,o=!1,a=void 0;try{for(var i,s=r[Symbol.iterator]();!(n=(i=s.next()).done);n=!0){var c=i.value;t._iceTransport.addRemoteCandidate(c)}}catch(e){o=!0,a=e}finally{try{n||null==s.return||s.return()}finally{if(o)throw a}}t._iceTransport.addRemoteCandidate({})}))}},{key:"_setIceGatherer",value:function(e){var t=new RTCIceGatherer({iceServers:e.turnServers||[],gatherPolicy:e.iceTransportPolicy});t.addEventListener("error",(function(e){_.error('iceGatherer "error" event [event:%o]',e)}));try{t.gather()}catch(e){_.debug("iceGatherer.gather() failed: %s",e.toString())}this._iceGatherer=t}},{key:"_setIceTransport",value:function(){var e=this,t=new RTCIceTransport(this._iceGatherer);t.addEventListener("statechange",(function(){switch(t.state){case"checking":e.emit("@connectionstatechange","connecting");break;case"connected":case"completed":e.emit("@connectionstatechange","connected");break;case"failed":e.emit("@connectionstatechange","failed");break;case"disconnected":e.emit("@connectionstatechange","disconnected");break;case"closed":e.emit("@connectionstatechange","closed")}})),t.addEventListener("icestatechange",(function(){switch(t.state){case"checking":e.emit("@connectionstatechange","connecting");break;case"connected":case"completed":e.emit("@connectionstatechange","connected");break;case"failed":e.emit("@connectionstatechange","failed");break;case"disconnected":e.emit("@connectionstatechange","disconnected");break;case"closed":e.emit("@connectionstatechange","closed")}})),t.addEventListener("candidatepairchange",(function(e){_.debug('iceTransport "candidatepairchange" event [pair:%o]',e.pair)})),this._iceTransport=t}},{key:"_setDtlsTransport",value:function(){var e=this,t=new RTCDtlsTransport(this._iceTransport);t.addEventListener("statechange",(function(){_.debug('dtlsTransport "statechange" event [state:%s]',t.state)})),t.addEventListener("dtlsstatechange",(function(){_.debug('dtlsTransport "dtlsstatechange" event [state:%s]',t.state),"closed"===t.state&&e.emit("@connectionstatechange","closed")})),t.addEventListener("error",(function(e){_.error('dtlsTransport "error" event [event:%o]',e)})),this._dtlsTransport=t}},{key:"_setupTransport",value:function(){var e=this;return _.debug("_setupTransport()"),Promise.resolve().then((function(){var t={},r=e._dtlsTransport.getLocalParameters();return r.role="server",t.dtlsParameters=r,e.safeEmitAsPromise("@needcreatetransport",t)})).then((function(t){e._transportRemoteParameters=t;var r=t.iceParameters,n=t.iceCandidates,o=t.dtlsParameters;e._iceTransport.start(e._iceGatherer,r,"controlling");var a=!0,i=!1,s=void 0;try{for(var c,u=n[Symbol.iterator]();!(a=(c=u.next()).done);a=!0){var d=c.value;e._iceTransport.addRemoteCandidate(d)}}catch(e){i=!0,s=e}finally{try{a||null==u.return||u.return()}finally{if(i)throw s}}e._iceTransport.addRemoteCandidate({}),o.fingerprints=o.fingerprints.filter((function(e){return"sha-256"===e.algorithm||"sha-384"===e.algorithm||"sha-512"===e.algorithm})),e._dtlsTransport.start(o),e._transportReady=!0}))}}]),t}(o.default);r.default=g},{"../EnhancedEventEmitter":4,"../Logger":5,"../ortc":32,"../utils":33,"./ortc/edgeUtils":22}],16:[function(e,t,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0}),r.default=void 0;var n=f(e("sdp-transform")),o=f(e("../Logger")),a=f(e("../EnhancedEventEmitter")),i=p(e("../utils")),s=p(e("../ortc")),c=p(e("./sdp/commonUtils")),u=p(e("./sdp/unifiedPlanUtils")),d=f(e("./sdp/RemoteUnifiedPlanSdp"));function l(){if("function"!=typeof WeakMap)return null;var e=new WeakMap;return l=function(){return e},e}function p(e){if(e&&e.__esModule)return e;var t=l();if(t&&t.has(e))return t.get(e);var r={};if(null!=e){var n=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var o in e)if(Object.prototype.hasOwnProperty.call(e,o)){var a=n?Object.getOwnPropertyDescriptor(e,o):null;a&&(a.get||a.set)?Object.defineProperty(r,o,a):r[o]=e[o]}}return r.default=e,t&&t.set(e,r),r}function f(e){return e&&e.__esModule?e:{default:e}}function m(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),r.push.apply(r,n)}return r}function h(e,t,r){return t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function v(e){return(v="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function y(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function _(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}function g(e,t,r){return t&&_(e.prototype,t),r&&_(e,r),e}function b(e,t){return!t||"object"!==v(t)&&"function"!=typeof t?function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e):t}function P(e){return(P=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function w(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&k(e,t)}function k(e,t){return(k=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}var S=new o.default("Firefox50"),R=function(e){function t(e,r,n){var o;return y(this,t),(o=b(this,P(t).call(this,S)))._pc=new RTCPeerConnection({iceServers:n.turnServers||[],iceTransportPolicy:n.iceTransportPolicy,bundlePolicy:"max-bundle",rtcpMuxPolicy:"require"}),o._rtpParametersByKind=r,o._remoteSdp=new d.default(e,r),o._pc.addEventListener("iceconnectionstatechange",(function(){switch(o._pc.iceConnectionState){case"checking":o.emit("@connectionstatechange","connecting");break;case"connected":case"completed":o.emit("@connectionstatechange","connected");break;case"failed":o.emit("@connectionstatechange","failed");break;case"disconnected":o.emit("@connectionstatechange","disconnected");break;case"closed":o.emit("@connectionstatechange","closed")}})),o}return w(t,e),g(t,[{key:"close",value:function(){S.debug("close()");try{this._pc.close()}catch(e){}}},{key:"remoteClosed",value:function(){S.debug("remoteClosed()"),this._transportReady=!1,this._transportUpdated&&(this._transportUpdated=!1)}}]),t}(a.default),T=function(e){function t(e,r){var n;return y(this,t),(n=b(this,P(t).call(this,"send",e,r)))._transportReady=!1,n._stream=new MediaStream,n._nextRid=1,n}return w(t,e),g(t,[{key:"addProducer",value:function(e){var t,r,o=this,a=e.track;return S.debug("addProducer() [id:%s, kind:%s, trackId:%s]",e.id,e.kind,a.id),this._stream.getTrackById(a.id)?Promise.reject(new Error("track already added")):Promise.resolve().then((function(){o._stream.addTrack(a),t=o._pc.addTrack(a,o._stream)})).then((function(){var r=[];e.simulcast&&(S.debug("addProducer() | enabling simulcast"),e.simulcast.high&&r.push({rid:"high".concat(o._nextRid),active:!0,priority:"low",maxBitrate:e.simulcast.high}),e.simulcast.medium&&r.push({rid:"medium".concat(o._nextRid),active:!0,priority:"medium",maxBitrate:e.simulcast.medium}),e.simulcast.low&&r.push({rid:"low".concat(o._nextRid),active:!0,priority:"high",maxBitrate:e.simulcast.low}),o._nextRid++);var n=t.getParameters();return t.setParameters(function(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?m(r,!0).forEach((function(t){h(e,t,r[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):m(r).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))}))}return e}({},n,{encodings:r}))})).then((function(){return o._pc.createOffer()})).then((function(e){return S.debug("addProducer() | calling pc.setLocalDescription() [offer:%o]",e),o._pc.setLocalDescription(e)})).then((function(){if(!o._transportReady)return o._setupTransport()})).then((function(){r=n.default.parse(o._pc.localDescription.sdp);var e={type:"answer",sdp:o._remoteSdp.createAnswerSdp(r)};return S.debug("addProducer() | calling pc.setRemoteDescription() [answer:%o]",e),o._pc.setRemoteDescription(e)})).then((function(){var t=i.clone(o._rtpParametersByKind[e.kind]);return u.fillRtpParametersForTrack(t,r,a),t})).catch((function(e){try{o._pc.removeTrack(t)}catch(e){}throw o._stream.removeTrack(a),e}))}},{key:"removeProducer",value:function(e){var t=this,r=e.track;return S.debug("removeProducer() [id:%s, kind:%s, trackId:%s]",e.id,e.kind,r.id),Promise.resolve().then((function(){var e=t._pc.getSenders().find((function(e){return e.track===r}));if(!e)throw new Error("RTCRtpSender not found");return t._pc.removeTrack(e),t._stream.removeTrack(r),t._pc.createOffer()})).then((function(e){return S.debug("removeProducer() | calling pc.setLocalDescription() [offer:%o]",e),t._pc.setLocalDescription(e)})).then((function(){var e=n.default.parse(t._pc.localDescription.sdp),r={type:"answer",sdp:t._remoteSdp.createAnswerSdp(e)};return S.debug("removeProducer() | calling pc.setRemoteDescription() [answer:%o]",r),t._pc.setRemoteDescription(r)}))}},{key:"replaceProducerTrack",value:function(e,t){var r=this;S.debug("replaceProducerTrack() [id:%s, kind:%s, trackId:%s]",e.id,e.kind,t.id);var n=e.track;return Promise.resolve().then((function(){var e=r._pc.getSenders().find((function(e){return e.track===n}));if(!e)throw new Error("local track not found");return e.replaceTrack(t)})).then((function(){r._stream.removeTrack(n),r._stream.addTrack(t)}))}},{key:"restartIce",value:function(e){var t=this;return S.debug("restartIce()"),this._remoteSdp.updateTransportRemoteIceParameters(e),Promise.resolve().then((function(){return t._pc.createOffer({iceRestart:!0})})).then((function(e){return S.debug("restartIce() | calling pc.setLocalDescription() [offer:%o]",e),t._pc.setLocalDescription(e)})).then((function(){var e=n.default.parse(t._pc.localDescription.sdp),r={type:"answer",sdp:t._remoteSdp.createAnswerSdp(e)};return S.debug("restartIce() | calling pc.setRemoteDescription() [answer:%o]",r),t._pc.setRemoteDescription(r)}))}},{key:"_setupTransport",value:function(){var e=this;return S.debug("_setupTransport()"),Promise.resolve().then((function(){var t={},r=e._pc.localDescription.sdp,o=n.default.parse(r),a=c.extractDtlsParameters(o);return a.role="server",t.dtlsParameters=a,e._remoteSdp.setTransportLocalParameters(t),e.safeEmitAsPromise("@needcreatetransport",t)})).then((function(t){e._remoteSdp.setTransportRemoteParameters(t),e._transportReady=!0}))}}]),t}(R),C=function(e){function t(e,r){var n;y(this,t),(n=b(this,P(t).call(this,"recv",e,r)))._transportCreated=!1,n._transportUpdated=!1,n._consumerInfos=new Map;return n._consumerInfos.set(555,{mid:"fake-dc",kind:"application",closed:!1,cname:null}),n}return w(t,e),g(t,[{key:"addConsumer",value:function(e){var t=this;if(S.debug("addConsumer() [id:%s, kind:%s]",e.id,e.kind),this._consumerInfos.has(e.id))return Promise.reject(new Error("Consumer already added"));var r=e.rtpParameters.encodings[0],n=e.rtpParameters.rtcp.cname,o={mid:"".concat(e.kind[0]).concat(e.id),kind:e.kind,closed:e.closed,streamId:"recv-stream-".concat(e.id),trackId:"consumer-".concat(e.kind,"-").concat(e.id),ssrc:r.ssrc,cname:n};return r.rtx&&r.rtx.ssrc&&(o.rtxSsrc=r.rtx.ssrc),this._consumerInfos.set(e.id,o),Promise.resolve().then((function(){if(!t._transportCreated)return t._setupTransport()})).then((function(){var e={type:"offer",sdp:t._remoteSdp.createOfferSdp(Array.from(t._consumerInfos.values()))};return S.debug("addConsumer() | calling pc.setRemoteDescription() [offer:%o]",e),t._pc.setRemoteDescription(e)})).then((function(){return t._pc.createAnswer()})).then((function(e){return S.debug("addConsumer() | calling pc.setLocalDescription() [answer:%o]",e),t._pc.setLocalDescription(e)})).then((function(){if(!t._transportUpdated)return t._updateTransport()})).then((function(){var e=t._pc.getReceivers().find((function(e){var t=e.track;return!!t&&t.id===o.trackId}));if(!e)throw new Error("remote track not found");return e.track}))}},{key:"removeConsumer",value:function(e){var t=this;S.debug("removeConsumer() [id:%s, kind:%s]",e.id,e.kind);var r=this._consumerInfos.get(e.id);return r?(r.closed=!0,Promise.resolve().then((function(){var e={type:"offer",sdp:t._remoteSdp.createOfferSdp(Array.from(t._consumerInfos.values()))};return S.debug("removeConsumer() | calling pc.setRemoteDescription() [offer:%o]",e),t._pc.setRemoteDescription(e)})).then((function(){return t._pc.createAnswer()})).then((function(e){return S.debug("removeConsumer() | calling pc.setLocalDescription() [answer:%o]",e),t._pc.setLocalDescription(e)}))):Promise.reject(new Error("Consumer not found"))}},{key:"restartIce",value:function(e){var t=this;return S.debug("restartIce()"),this._remoteSdp.updateTransportRemoteIceParameters(e),Promise.resolve().then((function(){var e={type:"offer",sdp:t._remoteSdp.createOfferSdp(Array.from(t._consumerInfos.values()))};return S.debug("restartIce() | calling pc.setRemoteDescription() [offer:%o]",e),t._pc.setRemoteDescription(e)})).then((function(){return t._pc.createAnswer()})).then((function(e){return S.debug("restartIce() | calling pc.setLocalDescription() [answer:%o]",e),t._pc.setLocalDescription(e)}))}},{key:"_setupTransport",value:function(){var e=this;return S.debug("_setupTransport()"),Promise.resolve().then((function(){return e.safeEmitAsPromise("@needcreatetransport",null)})).then((function(t){e._remoteSdp.setTransportRemoteParameters(t),e._transportCreated=!0}))}},{key:"_updateTransport",value:function(){S.debug("_updateTransport()");var e=this._pc.localDescription.sdp,t=n.default.parse(e),r={dtlsParameters:c.extractDtlsParameters(t)};this.safeEmit("@needupdatetransport",r),this._transportUpdated=!0}}]),t}(R),O=function(){function e(t,r,n){var o;switch(y(this,e),S.debug("constructor() [direction:%s, extendedRtpCapabilities:%o]",t,r),t){case"send":return o={audio:s.getSendingRtpParameters("audio",r),video:s.getSendingRtpParameters("video",r)},new T(o,n);case"recv":return o={audio:s.getReceivingFullRtpParameters("audio",r),video:s.getReceivingFullRtpParameters("video",r)},new C(o,n)}}return g(e,null,[{key:"getNativeRtpCapabilities",value:function(){S.debug("getNativeRtpCapabilities()");var e=new RTCPeerConnection({iceServers:[],iceTransportPolicy:"all",bundlePolicy:"max-bundle",rtcpMuxPolicy:"require"}),t=document.createElement("canvas");t.getContext("2d");var r=t.captureStream(),o=r.getVideoTracks()[0];return e.addTrack(o,r).setParameters({encodings:[{rid:"RID1",maxBitrate:4e4},{rid:"RID2",maxBitrate:1e4}]}),e.createOffer({offerToReceiveAudio:!0,offerToReceiveVideo:!0}).then((function(r){try{t.remove()}catch(e){}try{o.stop()}catch(e){}try{e.close()}catch(e){}var a=n.default.parse(r.sdp);return c.extractRtpCapabilities(a)})).catch((function(r){try{t.remove()}catch(e){}try{o.stop()}catch(e){}try{e.close()}catch(e){}throw r}))}},{key:"tag",get:function(){return"Firefox50"}}]),e}();r.default=O},{"../EnhancedEventEmitter":4,"../Logger":5,"../ortc":32,"../utils":33,"./sdp/RemoteUnifiedPlanSdp":25,"./sdp/commonUtils":26,"./sdp/unifiedPlanUtils":29,"sdp-transform":42}],17:[function(e,t,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0}),r.default=void 0;var n=f(e("sdp-transform")),o=f(e("../Logger")),a=f(e("../EnhancedEventEmitter")),i=p(e("../utils")),s=p(e("../ortc")),c=p(e("./sdp/commonUtils")),u=p(e("./sdp/unifiedPlanUtils")),d=f(e("./sdp/RemoteUnifiedPlanSdp"));function l(){if("function"!=typeof WeakMap)return null;var e=new WeakMap;return l=function(){return e},e}function p(e){if(e&&e.__esModule)return e;var t=l();if(t&&t.has(e))return t.get(e);var r={};if(null!=e){var n=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var o in e)if(Object.prototype.hasOwnProperty.call(e,o)){var a=n?Object.getOwnPropertyDescriptor(e,o):null;a&&(a.get||a.set)?Object.defineProperty(r,o,a):r[o]=e[o]}}return r.default=e,t&&t.set(e,r),r}function f(e){return e&&e.__esModule?e:{default:e}}function m(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),r.push.apply(r,n)}return r}function h(e,t,r){return t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function v(e){return(v="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function y(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function _(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}function g(e,t,r){return t&&_(e.prototype,t),r&&_(e,r),e}function b(e,t){return!t||"object"!==v(t)&&"function"!=typeof t?function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e):t}function P(e){return(P=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function w(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&k(e,t)}function k(e,t){return(k=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}var S=new o.default("Firefox59"),R=function(e){function t(e,r,n){var o;return y(this,t),(o=b(this,P(t).call(this,S)))._pc=new RTCPeerConnection({iceServers:n.turnServers||[],iceTransportPolicy:n.iceTransportPolicy,bundlePolicy:"max-bundle",rtcpMuxPolicy:"require"}),o._rtpParametersByKind=r,o._remoteSdp=new d.default(e,r),o._pc.addEventListener("iceconnectionstatechange",(function(){switch(o._pc.iceConnectionState){case"checking":o.emit("@connectionstatechange","connecting");break;case"connected":case"completed":o.emit("@connectionstatechange","connected");break;case"failed":o.emit("@connectionstatechange","failed");break;case"disconnected":o.emit("@connectionstatechange","disconnected");break;case"closed":o.emit("@connectionstatechange","closed")}})),o}return w(t,e),g(t,[{key:"close",value:function(){S.debug("close()");try{this._pc.close()}catch(e){}}},{key:"remoteClosed",value:function(){S.debug("remoteClosed()"),this._transportReady=!1,this._transportUpdated&&(this._transportUpdated=!1)}}]),t}(a.default),T=function(e){function t(e,r){var n;return y(this,t),(n=b(this,P(t).call(this,"send",e,r)))._transportReady=!1,n._stream=new MediaStream,n._nextRid=1,n}return w(t,e),g(t,[{key:"addProducer",value:function(e){var t,r,o=this,a=e.track;return S.debug("addProducer() [id:%s, kind:%s, trackId:%s]",e.id,e.kind,a.id),this._stream.getTrackById(a.id)?Promise.reject(new Error("track already added")):Promise.resolve().then((function(){o._stream.addTrack(a),t=o._pc.addTrack(a,o._stream)})).then((function(){var r=[];e.simulcast&&(S.debug("addProducer() | enabling simulcast"),e.simulcast.high&&r.push({rid:"high".concat(o._nextRid),active:!0,priority:"low",maxBitrate:e.simulcast.high}),e.simulcast.medium&&r.push({rid:"medium".concat(o._nextRid),active:!0,priority:"medium",maxBitrate:e.simulcast.medium}),e.simulcast.low&&r.push({rid:"low".concat(o._nextRid),active:!0,priority:"high",maxBitrate:e.simulcast.low}),o._nextRid++);var n=t.getParameters();return t.setParameters(function(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?m(r,!0).forEach((function(t){h(e,t,r[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):m(r).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))}))}return e}({},n,{encodings:r}))})).then((function(){return o._pc.createOffer()})).then((function(e){return S.debug("addProducer() | calling pc.setLocalDescription() [offer:%o]",e),o._pc.setLocalDescription(e)})).then((function(){if(!o._transportReady)return o._setupTransport()})).then((function(){r=n.default.parse(o._pc.localDescription.sdp);var e={type:"answer",sdp:o._remoteSdp.createAnswerSdp(r)};return S.debug("addProducer() | calling pc.setRemoteDescription() [answer:%o]",e),o._pc.setRemoteDescription(e)})).then((function(){var t=i.clone(o._rtpParametersByKind[e.kind]);return u.fillRtpParametersForTrack(t,r,a),t})).catch((function(e){try{o._pc.removeTrack(t)}catch(e){}throw o._stream.removeTrack(a),e}))}},{key:"removeProducer",value:function(e){var t=this,r=e.track;return S.debug("removeProducer() [id:%s, kind:%s, trackId:%s]",e.id,e.kind,r.id),Promise.resolve().then((function(){var e=t._pc.getSenders().find((function(e){return e.track===r}));if(!e)throw new Error("RTCRtpSender not found");return t._pc.removeTrack(e),t._stream.removeTrack(r),t._pc.createOffer()})).then((function(e){return S.debug("removeProducer() | calling pc.setLocalDescription() [offer:%o]",e),t._pc.setLocalDescription(e)})).then((function(){var e=n.default.parse(t._pc.localDescription.sdp),r={type:"answer",sdp:t._remoteSdp.createAnswerSdp(e)};return S.debug("removeProducer() | calling pc.setRemoteDescription() [answer:%o]",r),t._pc.setRemoteDescription(r)}))}},{key:"replaceProducerTrack",value:function(e,t){var r=this;S.debug("replaceProducerTrack() [id:%s, kind:%s, trackId:%s]",e.id,e.kind,t.id);var n=e.track;return Promise.resolve().then((function(){var e=r._pc.getSenders().find((function(e){return e.track===n}));if(!e)throw new Error("local track not found");return e.replaceTrack(t)})).then((function(){r._stream.removeTrack(n),r._stream.addTrack(t)}))}},{key:"restartIce",value:function(e){var t=this;return S.debug("restartIce()"),this._remoteSdp.updateTransportRemoteIceParameters(e),Promise.resolve().then((function(){return t._pc.createOffer({iceRestart:!0})})).then((function(e){return S.debug("restartIce() | calling pc.setLocalDescription() [offer:%o]",e),t._pc.setLocalDescription(e)})).then((function(){var e=n.default.parse(t._pc.localDescription.sdp),r={type:"answer",sdp:t._remoteSdp.createAnswerSdp(e)};return S.debug("restartIce() | calling pc.setRemoteDescription() [answer:%o]",r),t._pc.setRemoteDescription(r)}))}},{key:"_setupTransport",value:function(){var e=this;return S.debug("_setupTransport()"),Promise.resolve().then((function(){var t={},r=e._pc.localDescription.sdp,o=n.default.parse(r),a=c.extractDtlsParameters(o);return a.role="server",t.dtlsParameters=a,e._remoteSdp.setTransportLocalParameters(t),e.safeEmitAsPromise("@needcreatetransport",t)})).then((function(t){e._remoteSdp.setTransportRemoteParameters(t),e._transportReady=!0}))}}]),t}(R),C=function(e){function t(e,r){var n;return y(this,t),(n=b(this,P(t).call(this,"recv",e,r)))._transportCreated=!1,n._transportUpdated=!1,n._consumerInfos=new Map,n}return w(t,e),g(t,[{key:"addConsumer",value:function(e){var t=this;if(S.debug("addConsumer() [id:%s, kind:%s]",e.id,e.kind),this._consumerInfos.has(e.id))return Promise.reject(new Error("Consumer already added"));var r=e.rtpParameters.encodings[0],n=e.rtpParameters.rtcp.cname,o={mid:"".concat(e.kind[0]).concat(e.id),kind:e.kind,closed:e.closed,streamId:"recv-stream-".concat(e.id),trackId:"consumer-".concat(e.kind,"-").concat(e.id),ssrc:r.ssrc,cname:n};return r.rtx&&r.rtx.ssrc&&(o.rtxSsrc=r.rtx.ssrc),this._consumerInfos.set(e.id,o),Promise.resolve().then((function(){if(!t._transportCreated)return t._setupTransport()})).then((function(){var e={type:"offer",sdp:t._remoteSdp.createOfferSdp(Array.from(t._consumerInfos.values()))};return S.debug("addConsumer() | calling pc.setRemoteDescription() [offer:%o]",e),t._pc.setRemoteDescription(e)})).then((function(){return t._pc.createAnswer()})).then((function(e){return S.debug("addConsumer() | calling pc.setLocalDescription() [answer:%o]",e),t._pc.setLocalDescription(e)})).then((function(){if(!t._transportUpdated)return t._updateTransport()})).then((function(){var e=t._pc.getTransceivers().find((function(e){var t=e.receiver;return!!t&&(!!t.track&&e.mid===o.mid)}));if(!e)throw new Error("remote track not found");return e.receiver.track}))}},{key:"removeConsumer",value:function(e){var t=this;S.debug("removeConsumer() [id:%s, kind:%s]",e.id,e.kind);var r=this._consumerInfos.get(e.id);return r?(r.closed=!0,Promise.resolve().then((function(){var e={type:"offer",sdp:t._remoteSdp.createOfferSdp(Array.from(t._consumerInfos.values()))};return S.debug("removeConsumer() | calling pc.setRemoteDescription() [offer:%o]",e),t._pc.setRemoteDescription(e)})).then((function(){return t._pc.createAnswer()})).then((function(e){return S.debug("removeConsumer() | calling pc.setLocalDescription() [answer:%o]",e),t._pc.setLocalDescription(e)}))):Promise.reject(new Error("Consumer not found"))}},{key:"restartIce",value:function(e){var t=this;return S.debug("restartIce()"),this._remoteSdp.updateTransportRemoteIceParameters(e),Promise.resolve().then((function(){var e={type:"offer",sdp:t._remoteSdp.createOfferSdp(Array.from(t._consumerInfos.values()))};return S.debug("restartIce() | calling pc.setRemoteDescription() [offer:%o]",e),t._pc.setRemoteDescription(e)})).then((function(){return t._pc.createAnswer()})).then((function(e){return S.debug("restartIce() | calling pc.setLocalDescription() [answer:%o]",e),t._pc.setLocalDescription(e)}))}},{key:"_setupTransport",value:function(){var e=this;return S.debug("_setupTransport()"),Promise.resolve().then((function(){return e.safeEmitAsPromise("@needcreatetransport",null)})).then((function(t){e._remoteSdp.setTransportRemoteParameters(t),e._transportCreated=!0}))}},{key:"_updateTransport",value:function(){S.debug("_updateTransport()");var e=this._pc.localDescription.sdp,t=n.default.parse(e),r={dtlsParameters:c.extractDtlsParameters(t)};this.safeEmit("@needupdatetransport",r),this._transportUpdated=!0}}]),t}(R),O=function(){function e(t,r,n){var o;switch(y(this,e),S.debug("constructor() [direction:%s, extendedRtpCapabilities:%o]",t,r),t){case"send":return o={audio:s.getSendingRtpParameters("audio",r),video:s.getSendingRtpParameters("video",r)},new T(o,n);case"recv":return o={audio:s.getReceivingFullRtpParameters("audio",r),video:s.getReceivingFullRtpParameters("video",r)},new C(o,n)}}return g(e,null,[{key:"getNativeRtpCapabilities",value:function(){S.debug("getNativeRtpCapabilities()");var e=new RTCPeerConnection({iceServers:[],iceTransportPolicy:"all",bundlePolicy:"max-bundle",rtcpMuxPolicy:"require"}),t=document.createElement("canvas");t.getContext("2d");var r=t.captureStream(),o=r.getVideoTracks()[0];return e.addTrack(o,r).setParameters({encodings:[{rid:"RID1",maxBitrate:4e4},{rid:"RID2",maxBitrate:1e4}]}),e.createOffer({offerToReceiveAudio:!0,offerToReceiveVideo:!0}).then((function(r){try{t.remove()}catch(e){}try{o.stop()}catch(e){}try{e.close()}catch(e){}var a=n.default.parse(r.sdp);return c.extractRtpCapabilities(a)})).catch((function(r){try{t.remove()}catch(e){}try{o.stop()}catch(e){}try{e.close()}catch(e){}throw r}))}},{key:"tag",get:function(){return"Firefox59"}}]),e}();r.default=O},{"../EnhancedEventEmitter":4,"../Logger":5,"../ortc":32,"../utils":33,"./sdp/RemoteUnifiedPlanSdp":25,"./sdp/commonUtils":26,"./sdp/unifiedPlanUtils":29,"sdp-transform":42}],18:[function(e,t,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0}),r.default=void 0;var n=f(e("sdp-transform")),o=f(e("../Logger")),a=f(e("../EnhancedEventEmitter")),i=p(e("../utils")),s=p(e("../ortc")),c=p(e("./sdp/commonUtils")),u=p(e("./sdp/unifiedPlanUtils")),d=f(e("./sdp/RemoteUnifiedPlanSdp"));function l(){if("function"!=typeof WeakMap)return null;var e=new WeakMap;return l=function(){return e},e}function p(e){if(e&&e.__esModule)return e;var t=l();if(t&&t.has(e))return t.get(e);var r={};if(null!=e){var n=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var o in e)if(Object.prototype.hasOwnProperty.call(e,o)){var a=n?Object.getOwnPropertyDescriptor(e,o):null;a&&(a.get||a.set)?Object.defineProperty(r,o,a):r[o]=e[o]}}return r.default=e,t&&t.set(e,r),r}function f(e){return e&&e.__esModule?e:{default:e}}function m(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),r.push.apply(r,n)}return r}function h(e,t,r){return t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function v(e){return(v="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function y(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function _(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}function g(e,t,r){return t&&_(e.prototype,t),r&&_(e,r),e}function b(e,t){return!t||"object"!==v(t)&&"function"!=typeof t?function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e):t}function P(e){return(P=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function w(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&k(e,t)}function k(e,t){return(k=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}var S=new o.default("Firefox65"),R=function(e){function t(e,r,n){var o;return y(this,t),(o=b(this,P(t).call(this,S)))._pc=new RTCPeerConnection({iceServers:n.turnServers||[],iceTransportPolicy:n.iceTransportPolicy,bundlePolicy:"max-bundle",rtcpMuxPolicy:"require",rtcAudioJitterBufferMaxPackets:n.rtcAudioJitterBufferMaxPackets,rtcAudioJitterBufferMinDelayMs:n.rtcAudioJitterBufferMinDelayMs}),o._rtpParametersByKind=r,o._remoteSdp=new d.default(e,r),o._pc.addEventListener("iceconnectionstatechange",(function(){switch(o._pc.iceConnectionState){case"checking":o.emit("@connectionstatechange","connecting");break;case"connected":case"completed":o.emit("@connectionstatechange","connected");break;case"failed":o.emit("@connectionstatechange","failed");break;case"disconnected":o.emit("@connectionstatechange","disconnected");break;case"closed":o.emit("@connectionstatechange","closed")}})),o}return w(t,e),g(t,[{key:"close",value:function(){S.debug("close()");try{this._pc.close()}catch(e){}}},{key:"remoteClosed",value:function(){S.debug("remoteClosed()"),this._transportReady=!1,this._transportUpdated&&(this._transportUpdated=!1)}}]),t}(a.default),T=function(e){function t(e,r){var n;return y(this,t),(n=b(this,P(t).call(this,"send",e,r)))._transportReady=!1,n._trackIds=new Set,n._nextRid=1,n}return w(t,e),g(t,[{key:"addProducer",value:function(e){var t,r,o=this,a=e.track;return S.debug("addProducer() [id:%s, kind:%s, trackId:%s]",e.id,e.kind,a.id),this._trackIds.has(a.id)?Promise.reject(new Error("track already added")):(this._trackIds.add(a.id),Promise.resolve().then((function(){if(t=o._pc.getTransceivers().find((function(e){return e.receiver.track.kind===a.kind&&"inactive"===e.direction})))return S.debug("addProducer() | reusing an inactive transceiver"),t.direction="sendonly",t.sender.replaceTrack(a);t=o._pc.addTransceiver(a,{direction:"sendonly"})})).then((function(){var r=t.sender,n=[];e.simulcast&&(S.debug("addProducer() | enabling simulcast"),e.simulcast.high&&n.push({rid:"high".concat(o._nextRid),active:!0,priority:"low",maxBitrate:e.simulcast.high}),e.simulcast.medium&&n.push({rid:"medium".concat(o._nextRid),active:!0,priority:"medium",maxBitrate:e.simulcast.medium}),e.simulcast.low&&n.push({rid:"low".concat(o._nextRid),active:!0,priority:"high",maxBitrate:e.simulcast.low}),o._nextRid++);var a=r.getParameters();return r.setParameters(function(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?m(r,!0).forEach((function(t){h(e,t,r[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):m(r).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))}))}return e}({},a,{encodings:n}))})).then((function(){return o._pc.createOffer()})).then((function(e){return S.debug("addProducer() | calling pc.setLocalDescription() [offer:%o]",e),o._pc.setLocalDescription(e)})).then((function(){if(!o._transportReady)return o._setupTransport()})).then((function(){r=n.default.parse(o._pc.localDescription.sdp);var e={type:"answer",sdp:o._remoteSdp.createAnswerSdp(r)};return S.debug("addProducer() | calling pc.setRemoteDescription() [answer:%o]",e),o._pc.setRemoteDescription(e)})).then((function(){var n=i.clone(o._rtpParametersByKind[e.kind]);return u.fillRtpParametersForTrack(n,r,a,{mid:t.mid}),n})).catch((function(e){try{t.direction="inactive"}catch(e){}throw o._trackIds.delete(a.id),e})))}},{key:"removeProducer",value:function(e){var t=this,r=e.track;return this._trackIds.has(r.id)?(S.debug("removeProducer() [id:%s, kind:%s, trackId:%s]",e.id,e.kind,r.id),Promise.resolve().then((function(){var e=t._pc.getSenders().find((function(e){return e.track===r}));if(!e)throw new Error("local track not found");return t._pc.removeTrack(e),t._trackIds.delete(r.id),t._pc.createOffer()})).then((function(e){return S.debug("removeProducer() | calling pc.setLocalDescription() [offer:%o]",e),t._pc.setLocalDescription(e)})).then((function(){var e=n.default.parse(t._pc.localDescription.sdp),r={type:"answer",sdp:t._remoteSdp.createAnswerSdp(e)};return S.debug("removeProducer() | calling pc.setRemoteDescription() [answer:%o]",r),t._pc.setRemoteDescription(r)}))):Promise.reject(new Error("track not found"))}},{key:"replaceProducerTrack",value:function(e,t){var r=this;S.debug("replaceProducerTrack() [id:%s, kind:%s, trackId:%s]",e.id,e.kind,t.id);var n=e.track;return Promise.resolve().then((function(){var e=r._pc.getSenders().find((function(e){return e.track===n}));if(!e)throw new Error("local track not found");return e.replaceTrack(t)})).then((function(){r._trackIds.delete(n.id),r._trackIds.add(t.id)}))}},{key:"restartIce",value:function(e){var t=this;return S.debug("restartIce()"),this._remoteSdp.updateTransportRemoteIceParameters(e),Promise.resolve().then((function(){return t._pc.createOffer({iceRestart:!0})})).then((function(e){return S.debug("restartIce() | calling pc.setLocalDescription() [offer:%o]",e),t._pc.setLocalDescription(e)})).then((function(){var e=n.default.parse(t._pc.localDescription.sdp),r={type:"answer",sdp:t._remoteSdp.createAnswerSdp(e)};return S.debug("restartIce() | calling pc.setRemoteDescription() [answer:%o]",r),t._pc.setRemoteDescription(r)}))}},{key:"_setupTransport",value:function(){var e=this;return S.debug("_setupTransport()"),Promise.resolve().then((function(){var t={},r=e._pc.localDescription.sdp,o=n.default.parse(r),a=c.extractDtlsParameters(o);return a.role="server",t.dtlsParameters=a,e._remoteSdp.setTransportLocalParameters(t),e.safeEmitAsPromise("@needcreatetransport",t)})).then((function(t){e._remoteSdp.setTransportRemoteParameters(t),e._transportReady=!0}))}}]),t}(R),C=function(e){function t(e,r){var n;return y(this,t),(n=b(this,P(t).call(this,"recv",e,r)))._transportCreated=!1,n._transportUpdated=!1,n._consumerInfos=new Map,n}return w(t,e),g(t,[{key:"addConsumer",value:function(e){var t=this;if(S.debug("addConsumer() [id:%s, kind:%s]",e.id,e.kind),this._consumerInfos.has(e.id))return Promise.reject(new Error("Consumer already added"));var r=e.rtpParameters.encodings[0],n=e.rtpParameters.rtcp.cname,o={mid:"".concat(e.kind[0]).concat(e.id),kind:e.kind,closed:e.closed,streamId:"recv-stream-".concat(e.id),trackId:"consumer-".concat(e.kind,"-").concat(e.id),ssrc:r.ssrc,cname:n};return r.rtx&&r.rtx.ssrc&&(o.rtxSsrc=r.rtx.ssrc),this._consumerInfos.set(e.id,o),Promise.resolve().then((function(){if(!t._transportCreated)return t._setupTransport()})).then((function(){var e={type:"offer",sdp:t._remoteSdp.createOfferSdp(Array.from(t._consumerInfos.values()))};return S.debug("addConsumer() | calling pc.setRemoteDescription() [offer:%o]",e),t._pc.setRemoteDescription(e)})).then((function(){return t._pc.createAnswer()})).then((function(e){return S.debug("addConsumer() | calling pc.setLocalDescription() [answer:%o]",e),t._pc.setLocalDescription(e)})).then((function(){if(!t._transportUpdated)return t._updateTransport()})).then((function(){var e=t._pc.getTransceivers().find((function(e){return e.mid===o.mid}));if(!e)throw new Error("remote track not found");return e.receiver.track}))}},{key:"removeConsumer",value:function(e){var t=this;S.debug("removeConsumer() [id:%s, kind:%s]",e.id,e.kind);var r=this._consumerInfos.get(e.id);return r?(r.closed=!0,Promise.resolve().then((function(){var e={type:"offer",sdp:t._remoteSdp.createOfferSdp(Array.from(t._consumerInfos.values()))};return S.debug("removeConsumer() | calling pc.setRemoteDescription() [offer:%o]",e),t._pc.setRemoteDescription(e)})).then((function(){return t._pc.createAnswer()})).then((function(e){return S.debug("removeConsumer() | calling pc.setLocalDescription() [answer:%o]",e),t._pc.setLocalDescription(e)}))):Promise.reject(new Error("Consumer not found"))}},{key:"restartIce",value:function(e){var t=this;return S.debug("restartIce()"),this._remoteSdp.updateTransportRemoteIceParameters(e),Promise.resolve().then((function(){var e={type:"offer",sdp:t._remoteSdp.createOfferSdp(Array.from(t._consumerInfos.values()))};return S.debug("restartIce() | calling pc.setRemoteDescription() [offer:%o]",e),t._pc.setRemoteDescription(e)})).then((function(){return t._pc.createAnswer()})).then((function(e){return S.debug("restartIce() | calling pc.setLocalDescription() [answer:%o]",e),t._pc.setLocalDescription(e)}))}},{key:"_setupTransport",value:function(){var e=this;return S.debug("_setupTransport()"),Promise.resolve().then((function(){return e.safeEmitAsPromise("@needcreatetransport",null)})).then((function(t){e._remoteSdp.setTransportRemoteParameters(t),e._transportCreated=!0}))}},{key:"_updateTransport",value:function(){S.debug("_updateTransport()");var e=this._pc.localDescription.sdp,t=n.default.parse(e),r={dtlsParameters:c.extractDtlsParameters(t)};this.safeEmit("@needupdatetransport",r),this._transportUpdated=!0}}]),t}(R),O=function(){function e(t,r,n){var o;switch(y(this,e),S.debug("constructor() [direction:%s, extendedRtpCapabilities:%o]",t,r),t){case"send":return o={audio:s.getSendingRtpParameters("audio",r),video:s.getSendingRtpParameters("video",r)},new T(o,n);case"recv":return o={audio:s.getReceivingFullRtpParameters("audio",r),video:s.getReceivingFullRtpParameters("video",r)},new C(o,n)}}return g(e,null,[{key:"getNativeRtpCapabilities",value:function(){S.debug("getNativeRtpCapabilities()");var e=new RTCPeerConnection({iceServers:[],iceTransportPolicy:"all",bundlePolicy:"max-bundle",rtcpMuxPolicy:"require"}),t=document.createElement("canvas");t.getContext("2d");var r=t.captureStream(),o=r.getVideoTracks()[0];return e.addTrack(o,r).setParameters({encodings:[{rid:"RID1",maxBitrate:4e4},{rid:"RID2",maxBitrate:1e4}]}),e.createOffer({offerToReceiveAudio:!0,offerToReceiveVideo:!0}).then((function(r){try{t.remove()}catch(e){}try{o.stop()}catch(e){}try{e.close()}catch(e){}var a=n.default.parse(r.sdp);return c.extractRtpCapabilities(a)})).catch((function(r){try{t.remove()}catch(e){}try{o.stop()}catch(e){}try{e.close()}catch(e){}throw r}))}},{key:"tag",get:function(){return"Firefox65"}}]),e}();r.default=O},{"../EnhancedEventEmitter":4,"../Logger":5,"../ortc":32,"../utils":33,"./sdp/RemoteUnifiedPlanSdp":25,"./sdp/commonUtils":26,"./sdp/unifiedPlanUtils":29,"sdp-transform":42}],19:[function(e,t,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0}),r.default=void 0;var n=f(e("sdp-transform")),o=f(e("../Logger")),a=f(e("../EnhancedEventEmitter")),i=p(e("../utils")),s=p(e("../ortc")),c=p(e("./sdp/commonUtils")),u=p(e("./sdp/planBUtils")),d=f(e("./sdp/RemotePlanBSdp"));function l(){if("function"!=typeof WeakMap)return null;var e=new WeakMap;return l=function(){return e},e}function p(e){if(e&&e.__esModule)return e;var t=l();if(t&&t.has(e))return t.get(e);var r={};if(null!=e){var n=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var o in e)if(Object.prototype.hasOwnProperty.call(e,o)){var a=n?Object.getOwnPropertyDescriptor(e,o):null;a&&(a.get||a.set)?Object.defineProperty(r,o,a):r[o]=e[o]}}return r.default=e,t&&t.set(e,r),r}function f(e){return e&&e.__esModule?e:{default:e}}function m(e){return(m="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function h(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function v(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}function y(e,t,r){return t&&v(e.prototype,t),r&&v(e,r),e}function _(e,t){return!t||"object"!==m(t)&&"function"!=typeof t?function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e):t}function g(e){return(g=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function b(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&P(e,t)}function P(e,t){return(P=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}var w=new o.default("ReactNative"),k=function(e){function t(e,r,n){var o;return h(this,t),(o=_(this,g(t).call(this,w)))._pc=new RTCPeerConnection({iceServers:n.turnServers||[],iceTransportPolicy:n.iceTransportPolicy,bundlePolicy:"max-bundle",rtcpMuxPolicy:"require",rtcAudioJitterBufferMaxPackets:n.rtcAudioJitterBufferMaxPackets,rtcAudioJitterBufferMinDelayMs:n.rtcAudioJitterBufferMinDelayMs}),o._rtpParametersByKind=r,o._remoteSdp=new d.default(e,r),o._pc.addEventListener("iceconnectionstatechange",(function(){switch(o._pc.iceConnectionState){case"checking":o.emit("@connectionstatechange","connecting");break;case"connected":case"completed":o.emit("@connectionstatechange","connected");break;case"failed":o.emit("@connectionstatechange","failed");break;case"disconnected":o.emit("@connectionstatechange","disconnected");break;case"closed":o.emit("@connectionstatechange","closed")}})),o}return b(t,e),y(t,[{key:"close",value:function(){w.debug("close()");try{this._pc.close()}catch(e){}}},{key:"remoteClosed",value:function(){w.debug("remoteClosed()"),this._transportReady=!1,this._transportUpdated&&(this._transportUpdated=!1)}}]),t}(a.default),S=function(e){function t(e,r){var n;return h(this,t),(n=_(this,g(t).call(this,"send",e,r)))._transportReady=!1,n._tracks=new Set,n}return b(t,e),y(t,[{key:"addProducer",value:function(e){var t,r,o=this,a=e.track;return w.debug("addProducer() [id:%s, kind:%s, trackId:%s]",e.id,e.kind,a.id),this._tracks.has(a)?Promise.reject(new Error("track already added")):a.streamReactTag?Promise.resolve().then((function(){return o._tracks.add(a),(t=new MediaStream(a.streamReactTag)).addTrack(a),o._pc.addStream(t),o._pc.createOffer()})).then((function(t){if(e.simulcast){w.debug("addProducer() | enabling simulcast");var r=n.default.parse(t.sdp);u.addSimulcastForTrack(r,a),t={type:"offer",sdp:n.default.write(r)}}w.debug("addProducer() | calling pc.setLocalDescription() [offer:%o]",t);var i=new RTCSessionDescription(t);return o._pc.setLocalDescription(i)})).then((function(){if(!o._transportReady)return o._setupTransport()})).then((function(){r=n.default.parse(o._pc.localDescription.sdp);var e={type:"answer",sdp:o._remoteSdp.createAnswerSdp(r)};w.debug("addProducer() | calling pc.setRemoteDescription() [answer:%o]",e);var t=new RTCSessionDescription(e);return o._pc.setRemoteDescription(t)})).then((function(){var t=i.clone(o._rtpParametersByKind[e.kind]);return u.fillRtpParametersForTrack(t,r,a),t})).catch((function(e){throw o._tracks.delete(a),t.removeTrack(a),o._pc.removeStream(t),e})):Promise.reject(new Error("no track.streamReactTag property"))}},{key:"removeProducer",value:function(e){var t=this,r=e.track;return w.debug("removeProducer() [id:%s, kind:%s, trackId:%s]",e.id,e.kind,r.id),r.streamReactTag?Promise.resolve().then((function(){t._tracks.delete(r);var e=new MediaStream(r.streamReactTag);return e.addTrack(r),t._pc.removeStream(e),t._pc.createOffer()})).then((function(e){return w.debug("removeProducer() | calling pc.setLocalDescription() [offer:%o]",e),t._pc.setLocalDescription(e)})).catch((function(e){if(0!==t._tracks.size)throw e;w.warn("removeProducer() | ignoring expected error due no sending tracks: %s",e.toString())})).then((function(){if("stable"!==t._pc.signalingState){var e=n.default.parse(t._pc.localDescription.sdp),r={type:"answer",sdp:t._remoteSdp.createAnswerSdp(e)};w.debug("removeProducer() | calling pc.setRemoteDescription() [answer:%o]",r);var o=new RTCSessionDescription(r);return t._pc.setRemoteDescription(o)}})):Promise.reject(new Error("no track.streamReactTag property"))}},{key:"replaceProducerTrack",value:function(e,t){var r=this;if(w.debug("replaceProducerTrack() [id:%s, kind:%s, trackId:%s]",e.id,e.kind,t.id),!t.streamReactTag)return Promise.reject(new Error("no track.streamReactTag property"));var o,a,s=e.track;return Promise.resolve().then((function(){return r._tracks.add(t),r._tracks.delete(s),(o=new MediaStream(t.streamReactTag)).addTrack(t),o.removeTrack(s),r._pc.addStream(o),r._pc.createOffer()})).then((function(o){if(e.simulcast){w.debug("addProducer() | enabling simulcast");var a=n.default.parse(o.sdp);u.addSimulcastForTrack(a,t),o={type:"offer",sdp:n.default.write(a)}}w.debug("replaceProducerTrack() | calling pc.setLocalDescription() [offer:%o]",o);var i=new RTCSessionDescription(o);return r._pc.setLocalDescription(i)})).then((function(){a=n.default.parse(r._pc.localDescription.sdp);var e={type:"answer",sdp:r._remoteSdp.createAnswerSdp(a)};w.debug("replaceProducerTrack() | calling pc.setRemoteDescription() [answer:%o]",e);var t=new RTCSessionDescription(e);return r._pc.setRemoteDescription(t)})).then((function(){var n=i.clone(r._rtpParametersByKind[e.kind]);u.fillRtpParametersForTrack(n,a,t),r.safeEmit("@needupdateproducer",e,n)})).catch((function(e){throw r._tracks.delete(t),o.removeTrack(t),r._pc.addStream(o),e}))}},{key:"restartIce",value:function(e){var t=this;return w.debug("restartIce()"),this._remoteSdp.updateTransportRemoteIceParameters(e),Promise.resolve().then((function(){return t._pc.createOffer({iceRestart:!0})})).then((function(e){return w.debug("restartIce() | calling pc.setLocalDescription() [offer:%o]",e),t._pc.setLocalDescription(e)})).then((function(){var e=n.default.parse(t._pc.localDescription.sdp),r={type:"answer",sdp:t._remoteSdp.createAnswerSdp(e)};w.debug("restartIce() | calling pc.setRemoteDescription() [answer:%o]",r);var o=new RTCSessionDescription(r);return t._pc.setRemoteDescription(o)}))}},{key:"_setupTransport",value:function(){var e=this;return w.debug("_setupTransport()"),Promise.resolve().then((function(){var t={},r=e._pc.localDescription.sdp,o=n.default.parse(r),a=c.extractDtlsParameters(o);return a.role="server",t.dtlsParameters=a,e._remoteSdp.setTransportLocalParameters(t),e.safeEmitAsPromise("@needcreatetransport",t)})).then((function(t){e._remoteSdp.setTransportRemoteParameters(t),e._transportReady=!0}))}}]),t}(k),R=function(e){function t(e,r){var n;return h(this,t),(n=_(this,g(t).call(this,"recv",e,r)))._transportCreated=!1,n._transportUpdated=!1,n._kinds=new Set,n._consumerInfos=new Map,n}return b(t,e),y(t,[{key:"addConsumer",value:function(e){var t=this;if(w.debug("addConsumer() [id:%s, kind:%s]",e.id,e.kind),this._consumerInfos.has(e.id))return Promise.reject(new Error("Consumer already added"));var r=e.rtpParameters.encodings[0],n=e.rtpParameters.rtcp.cname,o={kind:e.kind,streamId:"recv-stream-".concat(e.id),trackId:"consumer-".concat(e.kind,"-").concat(e.id),ssrc:r.ssrc,cname:n};return r.rtx&&r.rtx.ssrc&&(o.rtxSsrc=r.rtx.ssrc),this._consumerInfos.set(e.id,o),this._kinds.add(e.kind),Promise.resolve().then((function(){if(!t._transportCreated)return t._setupTransport()})).then((function(){var e={type:"offer",sdp:t._remoteSdp.createOfferSdp(Array.from(t._kinds),Array.from(t._consumerInfos.values()))};w.debug("addConsumer() | calling pc.setRemoteDescription() [offer:%o]",e);var r=new RTCSessionDescription(e);return t._pc.setRemoteDescription(r)})).then((function(){return t._pc.createAnswer()})).then((function(e){return w.debug("addConsumer() | calling pc.setLocalDescription() [answer:%o]",e),t._pc.setLocalDescription(e)})).then((function(){if(!t._transportUpdated)return t._updateTransport()})).then((function(){var e=t._pc.getRemoteStreams().find((function(e){return e.id===o.streamId})),r=e.getTrackById(o.trackId);if(r.streamReactTag=e.reactTag,!r)throw new Error("remote track not found");return r}))}},{key:"removeConsumer",value:function(e){var t=this;return w.debug("removeConsumer() [id:%s, kind:%s]",e.id,e.kind),this._consumerInfos.has(e.id)?(this._consumerInfos.delete(e.id),Promise.resolve().then((function(){var e={type:"offer",sdp:t._remoteSdp.createOfferSdp(Array.from(t._kinds),Array.from(t._consumerInfos.values()))};w.debug("removeConsumer() | calling pc.setRemoteDescription() [offer:%o]",e);var r=new RTCSessionDescription(e);return t._pc.setRemoteDescription(r)})).then((function(){return t._pc.createAnswer()})).then((function(e){return w.debug("removeConsumer() | calling pc.setLocalDescription() [answer:%o]",e),t._pc.setLocalDescription(e)}))):Promise.reject(new Error("Consumer not found"))}},{key:"restartIce",value:function(e){var t=this;return w.debug("restartIce()"),this._remoteSdp.updateTransportRemoteIceParameters(e),Promise.resolve().then((function(){var e={type:"offer",sdp:t._remoteSdp.createOfferSdp(Array.from(t._kinds),Array.from(t._consumerInfos.values()))};w.debug("restartIce() | calling pc.setRemoteDescription() [offer:%o]",e);var r=new RTCSessionDescription(e);return t._pc.setRemoteDescription(r)})).then((function(){return t._pc.createAnswer()})).then((function(e){return w.debug("restartIce() | calling pc.setLocalDescription() [answer:%o]",e),t._pc.setLocalDescription(e)}))}},{key:"_setupTransport",value:function(){var e=this;return w.debug("_setupTransport()"),Promise.resolve().then((function(){return e.safeEmitAsPromise("@needcreatetransport",null)})).then((function(t){e._remoteSdp.setTransportRemoteParameters(t),e._transportCreated=!0}))}},{key:"_updateTransport",value:function(){w.debug("_updateTransport()");var e=this._pc.localDescription.sdp,t=n.default.parse(e),r={dtlsParameters:c.extractDtlsParameters(t)};this.safeEmit("@needupdatetransport",r),this._transportUpdated=!0}}]),t}(k),T=function(){function e(t,r,n){var o;switch(h(this,e),w.debug("constructor() [direction:%s, extendedRtpCapabilities:%o]",t,r),t){case"send":return o={audio:s.getSendingRtpParameters("audio",r),video:s.getSendingRtpParameters("video",r)},new S(o,n);case"recv":return o={audio:s.getReceivingFullRtpParameters("audio",r),video:s.getReceivingFullRtpParameters("video",r)},new R(o,n)}}return y(e,null,[{key:"getNativeRtpCapabilities",value:function(){w.debug("getNativeRtpCapabilities()");var e=new RTCPeerConnection({iceServers:[],iceTransportPolicy:"all",bundlePolicy:"max-bundle",rtcpMuxPolicy:"require"});return e.createOffer({offerToReceiveAudio:!0,offerToReceiveVideo:!0}).then((function(t){try{e.close()}catch(e){}var r=n.default.parse(t.sdp);return c.extractRtpCapabilities(r)})).catch((function(t){try{e.close()}catch(e){}throw t}))}},{key:"tag",get:function(){return"ReactNative"}}]),e}();r.default=T},{"../EnhancedEventEmitter":4,"../Logger":5,"../ortc":32,"../utils":33,"./sdp/RemotePlanBSdp":24,"./sdp/commonUtils":26,"./sdp/planBUtils":28,"sdp-transform":42}],20:[function(e,t,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0}),r.default=void 0;var n=f(e("sdp-transform")),o=f(e("../Logger")),a=f(e("../EnhancedEventEmitter")),i=p(e("../utils")),s=p(e("../ortc")),c=p(e("./sdp/commonUtils")),u=p(e("./sdp/planBUtils")),d=f(e("./sdp/RemotePlanBSdp"));function l(){if("function"!=typeof WeakMap)return null;var e=new WeakMap;return l=function(){return e},e}function p(e){if(e&&e.__esModule)return e;var t=l();if(t&&t.has(e))return t.get(e);var r={};if(null!=e){var n=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var o in e)if(Object.prototype.hasOwnProperty.call(e,o)){var a=n?Object.getOwnPropertyDescriptor(e,o):null;a&&(a.get||a.set)?Object.defineProperty(r,o,a):r[o]=e[o]}}return r.default=e,t&&t.set(e,r),r}function f(e){return e&&e.__esModule?e:{default:e}}function m(e){return(m="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function h(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function v(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}function y(e,t,r){return t&&v(e.prototype,t),r&&v(e,r),e}function _(e,t){return!t||"object"!==m(t)&&"function"!=typeof t?function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e):t}function g(e){return(g=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function b(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&P(e,t)}function P(e,t){return(P=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}var w=new o.default("Safari11"),k=function(e){function t(e,r,n){var o;return h(this,t),(o=_(this,g(t).call(this,w)))._pc=new RTCPeerConnection({iceServers:n.turnServers||[],iceTransportPolicy:n.iceTransportPolicy,bundlePolicy:"max-bundle",rtcpMuxPolicy:"require"}),o._rtpParametersByKind=r,o._remoteSdp=new d.default(e,r),o._pc.addEventListener("iceconnectionstatechange",(function(){switch(o._pc.iceConnectionState){case"checking":o.emit("@connectionstatechange","connecting");break;case"connected":case"completed":o.emit("@connectionstatechange","connected");break;case"failed":o.emit("@connectionstatechange","failed");break;case"disconnected":o.emit("@connectionstatechange","disconnected");break;case"closed":o.emit("@connectionstatechange","closed")}})),o}return b(t,e),y(t,[{key:"close",value:function(){w.debug("close()");try{this._pc.close()}catch(e){}}},{key:"remoteClosed",value:function(){w.debug("remoteClosed()"),this._transportReady=!1,this._transportUpdated&&(this._transportUpdated=!1)}}]),t}(a.default),S=function(e){function t(e,r){var n;return h(this,t),(n=_(this,g(t).call(this,"send",e,r)))._transportReady=!1,n._stream=new MediaStream,n}return b(t,e),y(t,[{key:"addProducer",value:function(e){var t,r,o=this,a=e.track;return w.debug("addProducer() [id:%s, kind:%s, trackId:%s]",e.id,e.kind,a.id),this._stream.getTrackById(a.id)?Promise.reject(new Error("track already added")):Promise.resolve().then((function(){return o._stream.addTrack(a),t=o._pc.addTrack(a,o._stream),o._pc.createOffer()})).then((function(e){return w.debug("addProducer() | calling pc.setLocalDescription() [offer:%o]",e),o._pc.setLocalDescription(e)})).then((function(){if(!o._transportReady)return o._setupTransport()})).then((function(){r=n.default.parse(o._pc.localDescription.sdp);var e={type:"answer",sdp:o._remoteSdp.createAnswerSdp(r)};return w.debug("addProducer() | calling pc.setRemoteDescription() [answer:%o]",e),o._pc.setRemoteDescription(e)})).then((function(){var t=i.clone(o._rtpParametersByKind[e.kind]);return u.fillRtpParametersForTrack(t,r,a),t})).catch((function(e){try{o._pc.removeTrack(t)}catch(e){}throw o._stream.removeTrack(a),e}))}},{key:"removeProducer",value:function(e){var t=this,r=e.track;return w.debug("removeProducer() [id:%s, kind:%s, trackId:%s]",e.id,e.kind,r.id),Promise.resolve().then((function(){var e=t._pc.getSenders().find((function(e){return e.track===r}));if(!e)throw new Error("RTCRtpSender not found");return t._pc.removeTrack(e),t._stream.removeTrack(r),t._pc.createOffer()})).then((function(e){return w.debug("removeProducer() | calling pc.setLocalDescription() [offer:%o]",e),t._pc.setLocalDescription(e)})).catch((function(e){if(0!==t._stream.getTracks().length)throw e;w.warn("removeProducer() | ignoring expected error due no sending tracks: %s",e.toString())})).then((function(){if("stable"!==t._pc.signalingState){var e=n.default.parse(t._pc.localDescription.sdp),r={type:"answer",sdp:t._remoteSdp.createAnswerSdp(e)};return w.debug("removeProducer() | calling pc.setRemoteDescription() [answer:%o]",r),t._pc.setRemoteDescription(r)}}))}},{key:"replaceProducerTrack",value:function(e,t){var r=this;w.debug("replaceProducerTrack() [id:%s, kind:%s, trackId:%s]",e.id,e.kind,t.id);var n=e.track;return Promise.resolve().then((function(){var e=r._pc.getSenders().find((function(e){return e.track===n}));if(!e)throw new Error("local track not found");return e.replaceTrack(t)})).then((function(){r._stream.removeTrack(n),r._stream.addTrack(t)}))}},{key:"restartIce",value:function(e){var t=this;return w.debug("restartIce()"),this._remoteSdp.updateTransportRemoteIceParameters(e),Promise.resolve().then((function(){return t._pc.createOffer({iceRestart:!0})})).then((function(e){return w.debug("restartIce() | calling pc.setLocalDescription() [offer:%o]",e),t._pc.setLocalDescription(e)})).then((function(){var e=n.default.parse(t._pc.localDescription.sdp),r={type:"answer",sdp:t._remoteSdp.createAnswerSdp(e)};return w.debug("restartIce() | calling pc.setRemoteDescription() [answer:%o]",r),t._pc.setRemoteDescription(r)}))}},{key:"_setupTransport",value:function(){var e=this;return w.debug("_setupTransport()"),Promise.resolve().then((function(){var t={},r=e._pc.localDescription.sdp,o=n.default.parse(r),a=c.extractDtlsParameters(o);return a.role="server",t.dtlsParameters=a,e._remoteSdp.setTransportLocalParameters(t),e.safeEmitAsPromise("@needcreatetransport",t)})).then((function(t){e._remoteSdp.setTransportRemoteParameters(t),e._transportReady=!0}))}}]),t}(k),R=function(e){function t(e,r){var n;return h(this,t),(n=_(this,g(t).call(this,"recv",e,r)))._transportCreated=!1,n._transportUpdated=!1,n._kinds=new Set,n._consumerInfos=new Map,n}return b(t,e),y(t,[{key:"addConsumer",value:function(e){var t=this;if(w.debug("addConsumer() [id:%s, kind:%s]",e.id,e.kind),this._consumerInfos.has(e.id))return Promise.reject(new Error("Consumer already added"));var r=e.rtpParameters.encodings[0],n=e.rtpParameters.rtcp.cname,o={kind:e.kind,streamId:"recv-stream-".concat(e.id),trackId:"consumer-".concat(e.kind,"-").concat(e.id),ssrc:r.ssrc,cname:n};return r.rtx&&r.rtx.ssrc&&(o.rtxSsrc=r.rtx.ssrc),this._consumerInfos.set(e.id,o),this._kinds.add(e.kind),Promise.resolve().then((function(){if(!t._transportCreated)return t._setupTransport()})).then((function(){var e={type:"offer",sdp:t._remoteSdp.createOfferSdp(Array.from(t._kinds),Array.from(t._consumerInfos.values()))};return w.debug("addConsumer() | calling pc.setRemoteDescription() [offer:%o]",e),t._pc.setRemoteDescription(e)})).then((function(){return t._pc.createAnswer()})).then((function(e){return w.debug("addConsumer() | calling pc.setLocalDescription() [answer:%o]",e),t._pc.setLocalDescription(e)})).then((function(){if(!t._transportUpdated)return t._updateTransport()})).then((function(){var e=t._pc.getReceivers().find((function(e){var t=e.track;return!!t&&t.id===o.trackId}));if(!e)throw new Error("remote track not found");return e.track}))}},{key:"removeConsumer",value:function(e){var t=this;return w.debug("removeConsumer() [id:%s, kind:%s]",e.id,e.kind),this._consumerInfos.has(e.id)?(this._consumerInfos.delete(e.id),Promise.resolve().then((function(){var e={type:"offer",sdp:t._remoteSdp.createOfferSdp(Array.from(t._kinds),Array.from(t._consumerInfos.values()))};return w.debug("removeConsumer() | calling pc.setRemoteDescription() [offer:%o]",e),t._pc.setRemoteDescription(e)})).then((function(){return t._pc.createAnswer()})).then((function(e){return w.debug("removeConsumer() | calling pc.setLocalDescription() [answer:%o]",e),t._pc.setLocalDescription(e)}))):Promise.reject(new Error("Consumer not found"))}},{key:"restartIce",value:function(e){var t=this;return w.debug("restartIce()"),this._remoteSdp.updateTransportRemoteIceParameters(e),Promise.resolve().then((function(){var e={type:"offer",sdp:t._remoteSdp.createOfferSdp(Array.from(t._kinds),Array.from(t._consumerInfos.values()))};return w.debug("restartIce() | calling pc.setRemoteDescription() [offer:%o]",e),t._pc.setRemoteDescription(e)})).then((function(){return t._pc.createAnswer()})).then((function(e){return w.debug("restartIce() | calling pc.setLocalDescription() [answer:%o]",e),t._pc.setLocalDescription(e)}))}},{key:"_setupTransport",value:function(){var e=this;return w.debug("_setupTransport()"),Promise.resolve().then((function(){return e.safeEmitAsPromise("@needcreatetransport",null)})).then((function(t){e._remoteSdp.setTransportRemoteParameters(t),e._transportCreated=!0}))}},{key:"_updateTransport",value:function(){w.debug("_updateTransport()");var e=this._pc.localDescription.sdp,t=n.default.parse(e),r={dtlsParameters:c.extractDtlsParameters(t)};this.safeEmit("@needupdatetransport",r),this._transportUpdated=!0}}]),t}(k),T=function(){function e(t,r,n){var o;switch(h(this,e),w.debug("constructor() [direction:%s, extendedRtpCapabilities:%o]",t,r),t){case"send":return o={audio:s.getSendingRtpParameters("audio",r),video:s.getSendingRtpParameters("video",r)},new S(o,n);case"recv":return o={audio:s.getReceivingFullRtpParameters("audio",r),video:s.getReceivingFullRtpParameters("video",r)},new R(o,n)}}return y(e,null,[{key:"getNativeRtpCapabilities",value:function(){w.debug("getNativeRtpCapabilities()");var e=new RTCPeerConnection({iceServers:[],iceTransportPolicy:"all",bundlePolicy:"max-bundle",rtcpMuxPolicy:"require"});return e.addTransceiver("audio"),e.addTransceiver("video"),e.createOffer().then((function(t){try{e.close()}catch(e){}var r=n.default.parse(t.sdp);return c.extractRtpCapabilities(r)})).catch((function(t){try{e.close()}catch(e){}throw t}))}},{key:"tag",get:function(){return"Safari11"}}]),e}();r.default=T},{"../EnhancedEventEmitter":4,"../Logger":5,"../ortc":32,"../utils":33,"./sdp/RemotePlanBSdp":24,"./sdp/commonUtils":26,"./sdp/planBUtils":28,"sdp-transform":42}],21:[function(e,t,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0}),r.default=void 0;var n=f(e("sdp-transform")),o=f(e("../Logger")),a=f(e("../EnhancedEventEmitter")),i=p(e("../utils")),s=p(e("../ortc")),c=p(e("./sdp/commonUtils")),u=p(e("./sdp/unifiedPlanUtils")),d=f(e("./sdp/RemoteUnifiedPlanSdp"));function l(){if("function"!=typeof WeakMap)return null;var e=new WeakMap;return l=function(){return e},e}function p(e){if(e&&e.__esModule)return e;var t=l();if(t&&t.has(e))return t.get(e);var r={};if(null!=e){var n=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var o in e)if(Object.prototype.hasOwnProperty.call(e,o)){var a=n?Object.getOwnPropertyDescriptor(e,o):null;a&&(a.get||a.set)?Object.defineProperty(r,o,a):r[o]=e[o]}}return r.default=e,t&&t.set(e,r),r}function f(e){return e&&e.__esModule?e:{default:e}}function m(e){return(m="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function h(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function v(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}function y(e,t,r){return t&&v(e.prototype,t),r&&v(e,r),e}function _(e,t){return!t||"object"!==m(t)&&"function"!=typeof t?function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e):t}function g(e){return(g=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function b(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&P(e,t)}function P(e,t){return(P=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}var w=new o.default("Safari12"),k=function(e){function t(e,r,n){var o;return h(this,t),(o=_(this,g(t).call(this,w)))._pc=new RTCPeerConnection({iceServers:n.turnServers||[],iceTransportPolicy:n.iceTransportPolicy,bundlePolicy:"max-bundle",rtcpMuxPolicy:"require",rtcAudioJitterBufferMaxPackets:n.rtcAudioJitterBufferMaxPackets,rtcAudioJitterBufferMinDelayMs:n.rtcAudioJitterBufferMinDelayMs}),o._rtpParametersByKind=r,o._remoteSdp=new d.default(e,r),o._pc.addEventListener("iceconnectionstatechange",(function(){switch(o._pc.iceConnectionState){case"checking":o.emit("@connectionstatechange","connecting");break;case"connected":case"completed":o.emit("@connectionstatechange","connected");break;case"failed":o.emit("@connectionstatechange","failed");break;case"disconnected":o.emit("@connectionstatechange","disconnected");break;case"closed":o.emit("@connectionstatechange","closed")}})),o}return b(t,e),y(t,[{key:"close",value:function(){w.debug("close()");try{this._pc.close()}catch(e){}}},{key:"remoteClosed",value:function(){w.debug("remoteClosed()"),this._transportReady=!1,this._transportUpdated&&(this._transportUpdated=!1)}}]),t}(a.default),S=function(e){function t(e,r){var n;return h(this,t),(n=_(this,g(t).call(this,"send",e,r)))._transportReady=!1,n._trackIds=new Set,n}return b(t,e),y(t,[{key:"addProducer",value:function(e){var t,r,o=this,a=e.track;return w.debug("addProducer() [id:%s, kind:%s, trackId:%s]",e.id,e.kind,a.id),this._trackIds.has(a.id)?Promise.reject(new Error("track already added")):(this._trackIds.add(a.id),Promise.resolve().then((function(){if(t=o._pc.getTransceivers().find((function(e){return e.receiver.track.kind===a.kind&&"inactive"===e.direction})))return w.debug("addProducer() | reusing an inactive transceiver"),t.direction="sendonly",t.sender.replaceTrack(a);t=o._pc.addTransceiver(a,{direction:"sendonly"})})).then((function(){return o._pc.createOffer()})).then((function(r){if(e.simulcast){w.debug("addProducer() | enabling simulcast");var i=n.default.parse(r.sdp);u.addPlanBSimulcast(i,a,{mid:t.mid}),r={type:"offer",sdp:n.default.write(i)}}return w.debug("addProducer() | calling pc.setLocalDescription() [offer:%o]",r),o._pc.setLocalDescription(r)})).then((function(){if(!o._transportReady)return o._setupTransport()})).then((function(){r=n.default.parse(o._pc.localDescription.sdp);var e={type:"answer",sdp:o._remoteSdp.createAnswerSdp(r)};return w.debug("addProducer() | calling pc.setRemoteDescription() [answer:%o]",e),o._pc.setRemoteDescription(e)})).then((function(){var n=i.clone(o._rtpParametersByKind[e.kind]);return u.fillRtpParametersForTrack(n,r,a,{mid:t.mid,planBSimulcast:!0}),n})).catch((function(e){try{t.direction="inactive"}catch(e){}throw o._trackIds.delete(a.id),e})))}},{key:"removeProducer",value:function(e){var t=this,r=e.track;return this._trackIds.has(r.id)?(w.debug("removeProducer() [id:%s, kind:%s, trackId:%s]",e.id,e.kind,r.id),Promise.resolve().then((function(){var e=t._pc.getSenders().find((function(e){return e.track===r}));if(!e)throw new Error("local track not found");return t._pc.removeTrack(e),t._trackIds.delete(r.id),t._pc.createOffer()})).then((function(e){return w.debug("removeProducer() | calling pc.setLocalDescription() [offer:%o]",e),t._pc.setLocalDescription(e)})).then((function(){var e=n.default.parse(t._pc.localDescription.sdp),r={type:"answer",sdp:t._remoteSdp.createAnswerSdp(e)};return w.debug("removeProducer() | calling pc.setRemoteDescription() [answer:%o]",r),t._pc.setRemoteDescription(r)}))):Promise.reject(new Error("track not found"))}},{key:"replaceProducerTrack",value:function(e,t){var r=this;w.debug("replaceProducerTrack() [id:%s, kind:%s, trackId:%s]",e.id,e.kind,t.id);var n=e.track;return Promise.resolve().then((function(){var e=r._pc.getSenders().find((function(e){return e.track===n}));if(!e)throw new Error("local track not found");return e.replaceTrack(t)})).then((function(){r._trackIds.delete(n.id),r._trackIds.add(t.id)}))}},{key:"restartIce",value:function(e){var t=this;return w.debug("restartIce()"),this._remoteSdp.updateTransportRemoteIceParameters(e),Promise.resolve().then((function(){return t._pc.createOffer({iceRestart:!0})})).then((function(e){return w.debug("restartIce() | calling pc.setLocalDescription() [offer:%o]",e),t._pc.setLocalDescription(e)})).then((function(){var e=n.default.parse(t._pc.localDescription.sdp),r={type:"answer",sdp:t._remoteSdp.createAnswerSdp(e)};return w.debug("restartIce() | calling pc.setRemoteDescription() [answer:%o]",r),t._pc.setRemoteDescription(r)}))}},{key:"_setupTransport",value:function(){var e=this;return w.debug("_setupTransport()"),Promise.resolve().then((function(){var t={},r=e._pc.localDescription.sdp,o=n.default.parse(r),a=c.extractDtlsParameters(o);return a.role="server",t.dtlsParameters=a,e._remoteSdp.setTransportLocalParameters(t),e.safeEmitAsPromise("@needcreatetransport",t)})).then((function(t){e._remoteSdp.setTransportRemoteParameters(t),e._transportReady=!0}))}}]),t}(k),R=function(e){function t(e,r){var n;return h(this,t),(n=_(this,g(t).call(this,"recv",e,r)))._transportCreated=!1,n._transportUpdated=!1,n._consumerInfos=new Map,n}return b(t,e),y(t,[{key:"addConsumer",value:function(e){var t=this;if(w.debug("addConsumer() [id:%s, kind:%s]",e.id,e.kind),this._consumerInfos.has(e.id))return Promise.reject(new Error("Consumer already added"));var r=e.rtpParameters.encodings[0],n=e.rtpParameters.rtcp.cname,o={mid:"".concat(e.kind[0]).concat(e.id),kind:e.kind,closed:e.closed,streamId:"recv-stream-".concat(e.id),trackId:"consumer-".concat(e.kind,"-").concat(e.id),ssrc:r.ssrc,cname:n};return r.rtx&&r.rtx.ssrc&&(o.rtxSsrc=r.rtx.ssrc),this._consumerInfos.set(e.id,o),Promise.resolve().then((function(){if(!t._transportCreated)return t._setupTransport()})).then((function(){var e={type:"offer",sdp:t._remoteSdp.createOfferSdp(Array.from(t._consumerInfos.values()))};return w.debug("addConsumer() | calling pc.setRemoteDescription() [offer:%o]",e),t._pc.setRemoteDescription(e)})).then((function(){return t._pc.createAnswer()})).then((function(e){return w.debug("addConsumer() | calling pc.setLocalDescription() [answer:%o]",e),t._pc.setLocalDescription(e)})).then((function(){if(!t._transportUpdated)return t._updateTransport()})).then((function(){var e=t._pc.getTransceivers().find((function(e){return e.mid===o.mid}));if(!e)throw new Error("remote track not found");return e.receiver.track}))}},{key:"removeConsumer",value:function(e){var t=this;w.debug("removeConsumer() [id:%s, kind:%s]",e.id,e.kind);var r=this._consumerInfos.get(e.id);return r?(r.closed=!0,Promise.resolve().then((function(){var e={type:"offer",sdp:t._remoteSdp.createOfferSdp(Array.from(t._consumerInfos.values()))};return w.debug("removeConsumer() | calling pc.setRemoteDescription() [offer:%o]",e),t._pc.setRemoteDescription(e)})).then((function(){return t._pc.createAnswer()})).then((function(e){return w.debug("removeConsumer() | calling pc.setLocalDescription() [answer:%o]",e),t._pc.setLocalDescription(e)}))):Promise.reject(new Error("Consumer not found"))}},{key:"restartIce",value:function(e){var t=this;return w.debug("restartIce()"),this._remoteSdp.updateTransportRemoteIceParameters(e),Promise.resolve().then((function(){var e={type:"offer",sdp:t._remoteSdp.createOfferSdp(Array.from(t._consumerInfos.values()))};return w.debug("restartIce() | calling pc.setRemoteDescription() [offer:%o]",e),t._pc.setRemoteDescription(e)})).then((function(){return t._pc.createAnswer()})).then((function(e){return w.debug("restartIce() | calling pc.setLocalDescription() [answer:%o]",e),t._pc.setLocalDescription(e)}))}},{key:"_setupTransport",value:function(){var e=this;return w.debug("_setupTransport()"),Promise.resolve().then((function(){return e.safeEmitAsPromise("@needcreatetransport",null)})).then((function(t){e._remoteSdp.setTransportRemoteParameters(t),e._transportCreated=!0}))}},{key:"_updateTransport",value:function(){w.debug("_updateTransport()");var e=this._pc.localDescription.sdp,t=n.default.parse(e),r={dtlsParameters:c.extractDtlsParameters(t)};this.safeEmit("@needupdatetransport",r),this._transportUpdated=!0}}]),t}(k),T=function(){function e(t,r,n){var o;switch(h(this,e),w.debug("constructor() [direction:%s, extendedRtpCapabilities:%o]",t,r),t){case"send":return o={audio:s.getSendingRtpParameters("audio",r),video:s.getSendingRtpParameters("video",r)},new S(o,n);case"recv":return o={audio:s.getReceivingFullRtpParameters("audio",r),video:s.getReceivingFullRtpParameters("video",r)},new R(o,n)}}return y(e,null,[{key:"getNativeRtpCapabilities",value:function(){w.debug("getNativeRtpCapabilities()");var e=new RTCPeerConnection({iceServers:[],iceTransportPolicy:"all",bundlePolicy:"max-bundle",rtcpMuxPolicy:"require"});return e.addTransceiver("audio"),e.addTransceiver("video"),e.createOffer().then((function(t){try{e.close()}catch(e){}var r=n.default.parse(t.sdp);return c.extractRtpCapabilities(r)})).catch((function(t){try{e.close()}catch(e){}throw t}))}},{key:"tag",get:function(){return"Safari12"}}]),e}();r.default=T},{"../EnhancedEventEmitter":4,"../Logger":5,"../ortc":32,"../utils":33,"./sdp/RemoteUnifiedPlanSdp":25,"./sdp/commonUtils":26,"./sdp/unifiedPlanUtils":29,"sdp-transform":42}],22:[function(e,t,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0}),r.getCapabilities=function(){var e=RTCRtpReceiver.getCapabilities(),t=n.clone(e),r=!0,o=!1,a=void 0;try{for(var i,s=t.codecs[Symbol.iterator]();!(r=(i=s.next()).done);r=!0){var c=i.value;if(c.channels=c.numChannels,delete c.numChannels,"audio"!==c.kind?delete c.channels:c.channels||(c.channels=1),c.mimeType="".concat(c.kind,"/").concat(c.name),c.parameters){var u=c.parameters;u.apt&&(u.apt=Number(u.apt)),u["packetization-mode"]&&(u["packetization-mode"]=Number(u["packetization-mode"]))}var d=!0,l=!1,p=void 0;try{for(var f,m=(c.rtcpFeedback||[])[Symbol.iterator]();!(d=(f=m.next()).done);d=!0){var h=f.value;h.parameter||delete h.parameter}}catch(e){l=!0,p=e}finally{try{d||null==m.return||m.return()}finally{if(l)throw p}}}}catch(e){o=!0,a=e}finally{try{r||null==s.return||s.return()}finally{if(o)throw a}}return t},r.mangleRtpParameters=function(e){var t=n.clone(e),r=!0,o=!1,a=void 0;try{for(var i,s=t.codecs[Symbol.iterator]();!(r=(i=s.next()).done);r=!0){var c=i.value;c.channels&&(c.numChannels=c.channels,delete c.channels),delete c.mimeType}}catch(e){o=!0,a=e}finally{try{r||null==s.return||s.return()}finally{if(o)throw a}}return t};var n=function(e){if(e&&e.__esModule)return e;var t=o();if(t&&t.has(e))return t.get(e);var r={};if(null!=e){var n=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var a in e)if(Object.prototype.hasOwnProperty.call(e,a)){var i=n?Object.getOwnPropertyDescriptor(e,a):null;i&&(i.get||i.set)?Object.defineProperty(r,a,i):r[a]=e[a]}}r.default=e,t&&t.set(e,r);return r}(e("../../utils"));function o(){if("function"!=typeof WeakMap)return null;var e=new WeakMap;return o=function(){return e},e}},{"../../utils":33}],23:[function(e,t,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0}),r.default=void 0;var n=s(e("sdp-transform")),o=s(e("../../Logger")),a=function(e){if(e&&e.__esModule)return e;var t=i();if(t&&t.has(e))return t.get(e);var r={};if(null!=e){var n=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var o in e)if(Object.prototype.hasOwnProperty.call(e,o)){var a=n?Object.getOwnPropertyDescriptor(e,o):null;a&&(a.get||a.set)?Object.defineProperty(r,o,a):r[o]=e[o]}}r.default=e,t&&t.set(e,r);return r}(e("../../utils"));function i(){if("function"!=typeof WeakMap)return null;var e=new WeakMap;return i=function(){return e},e}function s(e){return e&&e.__esModule?e:{default:e}}function c(e){return(c="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function u(e,t){return!t||"object"!==c(t)&&"function"!=typeof t?function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e):t}function d(e){return(d=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function l(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&p(e,t)}function p(e,t){return(p=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function f(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function m(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}function h(e,t,r){return t&&m(e.prototype,t),r&&m(e,r),e}var v=new o.default("RemotePlainRtpSdp"),y=function(){function e(t){f(this,e),this._rtpParametersByKind=t,this._transportLocalParameters=null,this._transportRemoteParameters=null,this._sdpGlobalFields={id:a.randomNumber(),version:0}}return h(e,[{key:"setTransportLocalParameters",value:function(e){v.debug("setTransportLocalParameters() [transportLocalParameters:%o]",e),this._transportLocalParameters=e}},{key:"setTransportRemoteParameters",value:function(e){v.debug("setTransportRemoteParameters() [transportRemoteParameters:%o]",e),this._transportRemoteParameters=e}}]),e}(),_=function(e){function t(e){return f(this,t),u(this,d(t).call(this,e))}return l(t,e),h(t,[{key:"createAnswerSdp",value:function(e){if(v.debug("createAnswerSdp()"),!this._transportLocalParameters)throw new Error("no transport local parameters");if(!this._transportRemoteParameters)throw new Error("no transport remote parameters");var t=this._transportRemoteParameters.plainRtpParameters,r={},o=(e.media||[]).filter((function(e){return e.hasOwnProperty("mid")})).map((function(e){return String(e.mid)}));this._sdpGlobalFields.version++,r.version=0,r.origin={address:t.ip,ipVer:t.version,netType:"IN",sessionId:this._sdpGlobalFields.id,sessionVersion:this._sdpGlobalFields.version,username:"mediasoup-client"},r.name="-",r.timing={start:0,stop:0},r.msidSemantic={semantic:"WMS",token:"*"},o.length>0&&(r.groups=[{type:"BUNDLE",mids:o.join(" ")}]),r.media=[];var a=!0,i=!1,s=void 0;try{for(var c,u=(e.media||[])[Symbol.iterator]();!(a=(c=u.next()).done);a=!0){var d=c.value,l="inactive"===d.direction,p=d.type,f=this._rtpParametersByKind[p].codecs,m=this._rtpParametersByKind[p].headerExtensions,h={};switch(h.type=d.type,h.port=t.port,h.protocol="RTP/AVP",h.connection={ip:t.ip,version:t.version},h.mid=d.mid,d.direction){case"sendrecv":case"sendonly":h.direction="recvonly";break;case"recvonly":case"inactive":h.direction="inactive"}h.rtp=[],h.rtcpFb=[],h.fmtp=[];var y=!0,_=!1,g=void 0;try{for(var b,P=f[Symbol.iterator]();!(y=(b=P.next()).done);y=!0){var w=b.value,k={payload:w.payloadType,codec:w.name,rate:w.clockRate};if(w.channels>1&&(k.encoding=w.channels),h.rtp.push(k),w.parameters){for(var S={payload:w.payloadType,config:""},R=0,T=Object.keys(w.parameters);R<T.length;R++){var C=T[R];S.config&&(S.config+=";"),S.config+="".concat(C,"=").concat(w.parameters[C])}S.config&&h.fmtp.push(S)}if(w.rtcpFeedback){var O=!0,E=!1,x=void 0;try{for(var D,j=w.rtcpFeedback[Symbol.iterator]();!(O=(D=j.next()).done);O=!0){var I=D.value;h.rtcpFb.push({payload:w.payloadType,type:I.type,subtype:I.parameter||""})}}catch(e){E=!0,x=e}finally{try{O||null==j.return||j.return()}finally{if(E)throw x}}}}}catch(e){_=!0,g=e}finally{try{y||null==P.return||P.return()}finally{if(_)throw g}}if(h.payloads=f.map((function(e){return e.payloadType})).join(" "),!l){h.ext=[];var L=!0,M=!1,A=void 0;try{for(var F,B=function(){var e=F.value;if(!(d.ext||[]).find((function(t){return t.uri===e.uri})))return"continue";h.ext.push({uri:e.uri,value:e.id})},U=m[Symbol.iterator]();!(L=(F=U.next()).done);L=!0)B()}catch(e){M=!0,A=e}finally{try{L||null==U.return||U.return()}finally{if(M)throw A}}}if(d.simulcast_03){h.simulcast_03={value:d.simulcast_03.value.replace(/send/g,"recv")},h.rids=[];var N=!0,G=!1,W=void 0;try{for(var z,q=(d.rids||[])[Symbol.iterator]();!(N=(z=q.next()).done);N=!0){var K=z.value;"send"===K.direction&&h.rids.push({id:K.id,direction:"recv"})}}catch(e){G=!0,W=e}finally{try{N||null==q.return||q.return()}finally{if(G)throw W}}}h.rtcpMux="rtcp-mux",h.rtcpRsize="rtcp-rsize",r.media.push(h)}}catch(e){i=!0,s=e}finally{try{a||null==u.return||u.return()}finally{if(i)throw s}}return n.default.write(r)}}]),t}(y),g=function(e){function t(e){return f(this,t),u(this,d(t).call(this,e))}return l(t,e),h(t,[{key:"createOfferSdp",value:function(e){if(v.debug("createOfferSdp()"),!this._transportRemoteParameters)throw new Error("no transport remote parameters");var t=this._transportRemoteParameters.plainRtpParameters,r={},o=e.map((function(e){return String(e.mid)}));this._sdpGlobalFields.version++,r.version=0,r.origin={address:t.ip,ipVer:t.version,netType:"IN",sessionId:this._sdpGlobalFields.id,sessionVersion:this._sdpGlobalFields.version,username:"mediasoup-client"},r.name="-",r.timing={start:0,stop:0},r.msidSemantic={semantic:"WMS",token:"*"},o.length>0&&(r.groups=[{type:"BUNDLE",mids:o.join(" ")}]),r.media=[];var a=!0,i=!1,s=void 0;try{for(var c,u=e[Symbol.iterator]();!(a=(c=u.next()).done);a=!0){var d=c.value,l=d.closed,p=d.kind,f=this._rtpParametersByKind[p].codecs,m=this._rtpParametersByKind[p].headerExtensions,h={};h.type=p,h.mid=d.mid,h.msid="".concat(d.streamId," ").concat(d.trackId),h.port=t.port,h.protocol="RTP/AVP",h.connection={ip:t.ip,version:t.version},h.direction=l?"inactive":"sendonly",h.rtp=[],h.rtcpFb=[],h.fmtp=[];var y=!0,_=!1,g=void 0;try{for(var b,P=f[Symbol.iterator]();!(y=(b=P.next()).done);y=!0){var w=b.value,k={payload:w.payloadType,codec:w.name,rate:w.clockRate};if(w.channels>1&&(k.encoding=w.channels),h.rtp.push(k),w.parameters){for(var S={payload:w.payloadType,config:""},R=0,T=Object.keys(w.parameters);R<T.length;R++){var C=T[R];S.config&&(S.config+=";"),S.config+="".concat(C,"=").concat(w.parameters[C])}S.config&&h.fmtp.push(S)}if(w.rtcpFeedback){var O=!0,E=!1,x=void 0;try{for(var D,j=w.rtcpFeedback[Symbol.iterator]();!(O=(D=j.next()).done);O=!0){var I=D.value;h.rtcpFb.push({payload:w.payloadType,type:I.type,subtype:I.parameter||""})}}catch(e){E=!0,x=e}finally{try{O||null==j.return||j.return()}finally{if(E)throw x}}}}}catch(e){_=!0,g=e}finally{try{y||null==P.return||P.return()}finally{if(_)throw g}}if(h.payloads=f.map((function(e){return e.payloadType})).join(" "),!l){h.ext=[];var L=!0,M=!1,A=void 0;try{for(var F,B=m[Symbol.iterator]();!(L=(F=B.next()).done);L=!0){var U=F.value;"urn:ietf:params:rtp-hdrext:sdes:mid"!==U.uri&&h.ext.push({uri:U.uri,value:U.id})}}catch(e){M=!0,A=e}finally{try{L||null==B.return||B.return()}finally{if(M)throw A}}}h.rtcpMux="rtcp-mux",h.rtcpRsize="rtcp-rsize",l||(h.ssrcs=[],h.ssrcGroups=[],h.ssrcs.push({id:d.ssrc,attribute:"cname",value:d.cname}),d.rtxSsrc&&(h.ssrcs.push({id:d.rtxSsrc,attribute:"cname",value:d.cname}),h.ssrcGroups.push({semantics:"FID",ssrcs:"".concat(d.ssrc," ").concat(d.rtxSsrc)}))),r.media.push(h)}}catch(e){i=!0,s=e}finally{try{a||null==u.return||u.return()}finally{if(i)throw s}}return n.default.write(r)}}]),t}(y);r.default=function e(t,r){switch(f(this,e),v.debug("constructor() [direction:%s, rtpParametersByKind:%o]",t,r),t){case"send":return new _(r);case"recv":return new g(r)}}},{"../../Logger":5,"../../utils":33,"sdp-transform":42}],24:[function(e,t,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0}),r.default=void 0;var n=s(e("sdp-transform")),o=s(e("../../Logger")),a=function(e){if(e&&e.__esModule)return e;var t=i();if(t&&t.has(e))return t.get(e);var r={};if(null!=e){var n=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var o in e)if(Object.prototype.hasOwnProperty.call(e,o)){var a=n?Object.getOwnPropertyDescriptor(e,o):null;a&&(a.get||a.set)?Object.defineProperty(r,o,a):r[o]=e[o]}}r.default=e,t&&t.set(e,r);return r}(e("../../utils"));function i(){if("function"!=typeof WeakMap)return null;var e=new WeakMap;return i=function(){return e},e}function s(e){return e&&e.__esModule?e:{default:e}}function c(e){return(c="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function u(e,t){return!t||"object"!==c(t)&&"function"!=typeof t?function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e):t}function d(e){return(d=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function l(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&p(e,t)}function p(e,t){return(p=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function f(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function m(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}function h(e,t,r){return t&&m(e.prototype,t),r&&m(e,r),e}var v=new o.default("RemotePlanBSdp"),y=function(){function e(t){f(this,e),this._rtpParametersByKind=t,this._transportLocalParameters=null,this._transportRemoteParameters=null,this._sdpGlobalFields={id:a.randomNumber(),version:0}}return h(e,[{key:"setTransportLocalParameters",value:function(e){v.debug("setTransportLocalParameters() [transportLocalParameters:%o]",e),this._transportLocalParameters=e}},{key:"setTransportRemoteParameters",value:function(e){v.debug("setTransportRemoteParameters() [transportRemoteParameters:%o]",e),this._transportRemoteParameters=e}},{key:"updateTransportRemoteIceParameters",value:function(e){v.debug("updateTransportRemoteIceParameters() [remoteIceParameters:%o]",e),this._transportRemoteParameters.iceParameters=e}}]),e}(),_=function(e){function t(e){return f(this,t),u(this,d(t).call(this,e))}return l(t,e),h(t,[{key:"createAnswerSdp",value:function(e){if(v.debug("createAnswerSdp()"),!this._transportLocalParameters)throw new Error("no transport local parameters");if(!this._transportRemoteParameters)throw new Error("no transport remote parameters");var t=this._transportRemoteParameters.iceParameters,r=this._transportRemoteParameters.iceCandidates,o=this._transportRemoteParameters.dtlsParameters,a={},i=(e.media||[]).map((function(e){return String(e.mid)}));this._sdpGlobalFields.version++,a.version=0,a.origin={address:"0.0.0.0",ipVer:4,netType:"IN",sessionId:this._sdpGlobalFields.id,sessionVersion:this._sdpGlobalFields.version,username:"mediasoup-client"},a.name="-",a.timing={start:0,stop:0},a.icelite=t.iceLite?"ice-lite":null,a.msidSemantic={semantic:"WMS",token:"*"},a.groups=[{type:"BUNDLE",mids:i.join(" ")}],a.media=[];var s=o.fingerprints.length;a.fingerprint={type:o.fingerprints[s-1].algorithm,hash:o.fingerprints[s-1].value};var c=!0,u=!1,d=void 0;try{for(var l,p=(e.media||[])[Symbol.iterator]();!(c=(l=p.next()).done);c=!0){var f=l.value,m=f.type,h=this._rtpParametersByKind[m].codecs,y=this._rtpParametersByKind[m].headerExtensions,_={};_.type=f.type,_.port=7,_.protocol="RTP/SAVPF",_.connection={ip:"127.0.0.1",version:4},_.mid=f.mid,_.iceUfrag=t.usernameFragment,_.icePwd=t.password,_.candidates=[];var g=!0,b=!1,P=void 0;try{for(var w,k=r[Symbol.iterator]();!(g=(w=k.next()).done);g=!0){var S=w.value,R={component:1};R.foundation=S.foundation,R.ip=S.ip,R.port=S.port,R.priority=S.priority,R.transport=S.protocol,R.type=S.type,S.tcpType&&(R.tcptype=S.tcpType),_.candidates.push(R)}}catch(e){b=!0,P=e}finally{try{g||null==k.return||k.return()}finally{if(b)throw P}}switch(_.endOfCandidates="end-of-candidates",_.iceOptions="renomination",o.role){case"client":_.setup="active";break;case"server":_.setup="passive"}switch(f.direction){case"sendrecv":case"sendonly":_.direction="recvonly";break;case"recvonly":case"inactive":_.direction="inactive"}"video"===m&&(_.xGoogleFlag="conference"),_.rtp=[],_.rtcpFb=[],_.fmtp=[];var T=!0,C=!1,O=void 0;try{for(var E,x=h[Symbol.iterator]();!(T=(E=x.next()).done);T=!0){var D=E.value,j={payload:D.payloadType,codec:D.name,rate:D.clockRate};if(D.channels>1&&(j.encoding=D.channels),_.rtp.push(j),D.parameters){for(var I={payload:D.payloadType,config:""},L=0,M=Object.keys(D.parameters);L<M.length;L++){var A=M[L];I.config&&(I.config+=";"),I.config+="".concat(A,"=").concat(D.parameters[A])}I.config&&_.fmtp.push(I)}if(D.rtcpFeedback){var F=!0,B=!1,U=void 0;try{for(var N,G=D.rtcpFeedback[Symbol.iterator]();!(F=(N=G.next()).done);F=!0){var W=N.value;_.rtcpFb.push({payload:D.payloadType,type:W.type,subtype:W.parameter||""})}}catch(e){B=!0,U=e}finally{try{F||null==G.return||G.return()}finally{if(B)throw U}}}}}catch(e){C=!0,O=e}finally{try{T||null==x.return||x.return()}finally{if(C)throw O}}_.payloads=h.map((function(e){return e.payloadType})).join(" "),_.ext=[];var z=!0,q=!1,K=void 0;try{for(var V,J=function(){var e=V.value;if(!(f.ext||[]).find((function(t){return t.uri===e.uri})))return"continue";_.ext.push({uri:e.uri,value:e.id})},Q=y[Symbol.iterator]();!(z=(V=Q.next()).done);z=!0)J()}catch(e){q=!0,K=e}finally{try{z||null==Q.return||Q.return()}finally{if(q)throw K}}_.rtcpMux="rtcp-mux",_.rtcpRsize="rtcp-rsize",a.media.push(_)}}catch(e){u=!0,d=e}finally{try{c||null==p.return||p.return()}finally{if(u)throw d}}return n.default.write(a)}}]),t}(y),g=function(e){function t(e){return f(this,t),u(this,d(t).call(this,e))}return l(t,e),h(t,[{key:"createOfferSdp",value:function(e,t){var r=this;if(v.debug("createOfferSdp()"),!this._transportRemoteParameters)throw new Error("no transport remote parameters");var o=this._transportRemoteParameters.iceParameters,a=this._transportRemoteParameters.iceCandidates,i=this._transportRemoteParameters.dtlsParameters,s={},c=e;this._sdpGlobalFields.version++,s.version=0,s.origin={address:"0.0.0.0",ipVer:4,netType:"IN",sessionId:this._sdpGlobalFields.id,sessionVersion:this._sdpGlobalFields.version,username:"mediasoup-client"},s.name="-",s.timing={start:0,stop:0},s.icelite=o.iceLite?"ice-lite":null,s.msidSemantic={semantic:"WMS",token:"*"},s.groups=[{type:"BUNDLE",mids:c.join(" ")}],s.media=[];var u=i.fingerprints.length;s.fingerprint={type:i.fingerprints[u-1].algorithm,hash:i.fingerprints[u-1].value};var d=!0,l=!1,p=void 0;try{for(var f,m=function(){var e=f.value,n=r._rtpParametersByKind[e].codecs,i=r._rtpParametersByKind[e].headerExtensions,c={};c.type=e,c.port=7,c.protocol="RTP/SAVPF",c.connection={ip:"127.0.0.1",version:4},c.mid=e,c.iceUfrag=o.usernameFragment,c.icePwd=o.password,c.candidates=[];var u=!0,d=!1,l=void 0;try{for(var p,m=a[Symbol.iterator]();!(u=(p=m.next()).done);u=!0){var h=p.value,v={component:1};v.foundation=h.foundation,v.ip=h.ip,v.port=h.port,v.priority=h.priority,v.transport=h.protocol,v.type=h.type,h.tcpType&&(v.tcptype=h.tcpType),c.candidates.push(v)}}catch(e){d=!0,l=e}finally{try{u||null==m.return||m.return()}finally{if(d)throw l}}c.endOfCandidates="end-of-candidates",c.iceOptions="renomination",c.setup="actpass",t.some((function(t){return t.kind===e}))?c.direction="sendonly":c.direction="inactive",c.rtp=[],c.rtcpFb=[],c.fmtp=[];var y=!0,_=!1,g=void 0;try{for(var b,P=n[Symbol.iterator]();!(y=(b=P.next()).done);y=!0){var w=b.value,k={payload:w.payloadType,codec:w.name,rate:w.clockRate};if(w.channels>1&&(k.encoding=w.channels),c.rtp.push(k),w.parameters){for(var S={payload:w.payloadType,config:""},R=0,T=Object.keys(w.parameters);R<T.length;R++){var C=T[R];S.config&&(S.config+=";"),S.config+="".concat(C,"=").concat(w.parameters[C])}S.config&&c.fmtp.push(S)}if(w.rtcpFeedback){var O=!0,E=!1,x=void 0;try{for(var D,j=w.rtcpFeedback[Symbol.iterator]();!(O=(D=j.next()).done);O=!0){var I=D.value;c.rtcpFb.push({payload:w.payloadType,type:I.type,subtype:I.parameter||""})}}catch(e){E=!0,x=e}finally{try{O||null==j.return||j.return()}finally{if(E)throw x}}}}}catch(e){_=!0,g=e}finally{try{y||null==P.return||P.return()}finally{if(_)throw g}}c.payloads=n.map((function(e){return e.payloadType})).join(" "),c.ext=[];var L=!0,M=!1,A=void 0;try{for(var F,B=i[Symbol.iterator]();!(L=(F=B.next()).done);L=!0){var U=F.value;"urn:ietf:params:rtp-hdrext:sdes:mid"!==U.uri&&c.ext.push({uri:U.uri,value:U.id})}}catch(e){M=!0,A=e}finally{try{L||null==B.return||B.return()}finally{if(M)throw A}}c.rtcpMux="rtcp-mux",c.rtcpRsize="rtcp-rsize",c.ssrcs=[],c.ssrcGroups=[];var N=!0,G=!1,W=void 0;try{for(var z,q=t[Symbol.iterator]();!(N=(z=q.next()).done);N=!0){var K=z.value;K.kind===e&&(c.ssrcs.push({id:K.ssrc,attribute:"msid",value:"".concat(K.streamId," ").concat(K.trackId)}),c.ssrcs.push({id:K.ssrc,attribute:"mslabel",value:K.streamId}),c.ssrcs.push({id:K.ssrc,attribute:"label",value:K.trackId}),c.ssrcs.push({id:K.ssrc,attribute:"cname",value:K.cname}),K.rtxSsrc&&(c.ssrcs.push({id:K.rtxSsrc,attribute:"msid",value:"".concat(K.streamId," ").concat(K.trackId)}),c.ssrcs.push({id:K.rtxSsrc,attribute:"mslabel",value:K.streamId}),c.ssrcs.push({id:K.rtxSsrc,attribute:"label",value:K.trackId}),c.ssrcs.push({id:K.rtxSsrc,attribute:"cname",value:K.cname}),c.ssrcGroups.push({semantics:"FID",ssrcs:"".concat(K.ssrc," ").concat(K.rtxSsrc)})))}}catch(e){G=!0,W=e}finally{try{N||null==q.return||q.return()}finally{if(G)throw W}}s.media.push(c)},h=e[Symbol.iterator]();!(d=(f=h.next()).done);d=!0)m()}catch(e){l=!0,p=e}finally{try{d||null==h.return||h.return()}finally{if(l)throw p}}return n.default.write(s)}}]),t}(y);r.default=function e(t,r){switch(f(this,e),v.debug("constructor() [direction:%s, rtpParametersByKind:%o]",t,r),t){case"send":return new _(r);case"recv":return new g(r)}}},{"../../Logger":5,"../../utils":33,"sdp-transform":42}],25:[function(e,t,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0}),r.default=void 0;var n=s(e("sdp-transform")),o=s(e("../../Logger")),a=function(e){if(e&&e.__esModule)return e;var t=i();if(t&&t.has(e))return t.get(e);var r={};if(null!=e){var n=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var o in e)if(Object.prototype.hasOwnProperty.call(e,o)){var a=n?Object.getOwnPropertyDescriptor(e,o):null;a&&(a.get||a.set)?Object.defineProperty(r,o,a):r[o]=e[o]}}r.default=e,t&&t.set(e,r);return r}(e("../../utils"));function i(){if("function"!=typeof WeakMap)return null;var e=new WeakMap;return i=function(){return e},e}function s(e){return e&&e.__esModule?e:{default:e}}function c(e){return(c="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function u(e,t){return!t||"object"!==c(t)&&"function"!=typeof t?function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e):t}function d(e){return(d=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function l(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&p(e,t)}function p(e,t){return(p=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function f(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function m(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}function h(e,t,r){return t&&m(e.prototype,t),r&&m(e,r),e}var v=new o.default("RemoteUnifiedPlanSdp"),y=function(){function e(t){f(this,e),this._rtpParametersByKind=t,this._transportLocalParameters=null,this._transportRemoteParameters=null,this._sdpGlobalFields={id:a.randomNumber(),version:0}}return h(e,[{key:"setTransportLocalParameters",value:function(e){v.debug("setTransportLocalParameters() [transportLocalParameters:%o]",e),this._transportLocalParameters=e}},{key:"setTransportRemoteParameters",value:function(e){v.debug("setTransportRemoteParameters() [transportRemoteParameters:%o]",e),this._transportRemoteParameters=e}},{key:"updateTransportRemoteIceParameters",value:function(e){v.debug("updateTransportRemoteIceParameters() [remoteIceParameters:%o]",e),this._transportRemoteParameters.iceParameters=e}}]),e}(),_=function(e){function t(e){return f(this,t),u(this,d(t).call(this,e))}return l(t,e),h(t,[{key:"createAnswerSdp",value:function(e){if(v.debug("createAnswerSdp()"),!this._transportLocalParameters)throw new Error("no transport local parameters");if(!this._transportRemoteParameters)throw new Error("no transport remote parameters");var t=this._transportRemoteParameters.iceParameters,r=this._transportRemoteParameters.iceCandidates,o=this._transportRemoteParameters.dtlsParameters,a={},i=(e.media||[]).filter((function(e){return e.hasOwnProperty("mid")})).map((function(e){return String(e.mid)}));this._sdpGlobalFields.version++,a.version=0,a.origin={address:"0.0.0.0",ipVer:4,netType:"IN",sessionId:this._sdpGlobalFields.id,sessionVersion:this._sdpGlobalFields.version,username:"mediasoup-client"},a.name="-",a.timing={start:0,stop:0},a.icelite=t.iceLite?"ice-lite":null,a.msidSemantic={semantic:"WMS",token:"*"},i.length>0&&(a.groups=[{type:"BUNDLE",mids:i.join(" ")}]),a.media=[];var s=o.fingerprints.length;a.fingerprint={type:o.fingerprints[s-1].algorithm,hash:o.fingerprints[s-1].value};var c=!0,u=!1,d=void 0;try{for(var l,p=(e.media||[])[Symbol.iterator]();!(c=(l=p.next()).done);c=!0){var f=l.value,m="inactive"===f.direction,h=f.type,y=this._rtpParametersByKind[h].codecs,_=this._rtpParametersByKind[h].headerExtensions,g={};g.type=f.type,g.port=7,g.protocol="RTP/SAVPF",g.connection={ip:"127.0.0.1",version:4},g.mid=f.mid,g.iceUfrag=t.usernameFragment,g.icePwd=t.password,g.candidates=[];var b=!0,P=!1,w=void 0;try{for(var k,S=r[Symbol.iterator]();!(b=(k=S.next()).done);b=!0){var R=k.value,T={component:1};T.foundation=R.foundation,T.ip=R.ip,T.port=R.port,T.priority=R.priority,T.transport=R.protocol,T.type=R.type,R.tcpType&&(T.tcptype=R.tcpType),g.candidates.push(T)}}catch(e){P=!0,w=e}finally{try{b||null==S.return||S.return()}finally{if(P)throw w}}switch(g.endOfCandidates="end-of-candidates",g.iceOptions="renomination",o.role){case"client":g.setup="active";break;case"server":g.setup="passive"}switch(f.direction){case"sendrecv":case"sendonly":g.direction="recvonly";break;case"recvonly":case"inactive":g.direction="inactive"}g.rtp=[],g.rtcpFb=[],g.fmtp=[];var C=!0,O=!1,E=void 0;try{for(var x,D=y[Symbol.iterator]();!(C=(x=D.next()).done);C=!0){var j=x.value,I={payload:j.payloadType,codec:j.name,rate:j.clockRate};if(j.channels>1&&(I.encoding=j.channels),g.rtp.push(I),j.parameters){for(var L={payload:j.payloadType,config:""},M=0,A=Object.keys(j.parameters);M<A.length;M++){var F=A[M];L.config&&(L.config+=";"),L.config+="".concat(F,"=").concat(j.parameters[F])}L.config&&g.fmtp.push(L)}if(j.rtcpFeedback){var B=!0,U=!1,N=void 0;try{for(var G,W=j.rtcpFeedback[Symbol.iterator]();!(B=(G=W.next()).done);B=!0){var z=G.value;g.rtcpFb.push({payload:j.payloadType,type:z.type,subtype:z.parameter||""})}}catch(e){U=!0,N=e}finally{try{B||null==W.return||W.return()}finally{if(U)throw N}}}}}catch(e){O=!0,E=e}finally{try{C||null==D.return||D.return()}finally{if(O)throw E}}if(g.payloads=y.map((function(e){return e.payloadType})).join(" "),!m){g.ext=[];var q=!0,K=!1,V=void 0;try{for(var J,Q=function(){var e=J.value;if(!(f.ext||[]).find((function(t){return t.uri===e.uri})))return"continue";g.ext.push({uri:e.uri,value:e.id})},$=_[Symbol.iterator]();!(q=(J=$.next()).done);q=!0)Q()}catch(e){K=!0,V=e}finally{try{q||null==$.return||$.return()}finally{if(K)throw V}}}if(f.simulcast){g.simulcast={dir1:"recv",list1:f.simulcast.list1},g.rids=[];var H=!0,Z=!1,X=void 0;try{for(var Y,ee=(f.rids||[])[Symbol.iterator]();!(H=(Y=ee.next()).done);H=!0){var te=Y.value;"send"===te.direction&&g.rids.push({id:te.id,direction:"recv"})}}catch(e){Z=!0,X=e}finally{try{H||null==ee.return||ee.return()}finally{if(Z)throw X}}}else if(f.simulcast_03){g.simulcast_03={value:f.simulcast_03.value.replace(/send/g,"recv")},g.rids=[];var re=!0,ne=!1,oe=void 0;try{for(var ae,ie=(f.rids||[])[Symbol.iterator]();!(re=(ae=ie.next()).done);re=!0){var se=ae.value;"send"===se.direction&&g.rids.push({id:se.id,direction:"recv"})}}catch(e){ne=!0,oe=e}finally{try{re||null==ie.return||ie.return()}finally{if(ne)throw oe}}}g.rtcpMux="rtcp-mux",g.rtcpRsize="rtcp-rsize",a.media.push(g)}}catch(e){u=!0,d=e}finally{try{c||null==p.return||p.return()}finally{if(u)throw d}}return n.default.write(a)}}]),t}(y),g=function(e){function t(e){return f(this,t),u(this,d(t).call(this,e))}return l(t,e),h(t,[{key:"createOfferSdp",value:function(e){if(v.debug("createOfferSdp()"),!this._transportRemoteParameters)throw new Error("no transport remote parameters");var t=this._transportRemoteParameters.iceParameters,r=this._transportRemoteParameters.iceCandidates,o=this._transportRemoteParameters.dtlsParameters,a={},i=e.map((function(e){return String(e.mid)}));this._sdpGlobalFields.version++,a.version=0,a.origin={address:"0.0.0.0",ipVer:4,netType:"IN",sessionId:this._sdpGlobalFields.id,sessionVersion:this._sdpGlobalFields.version,username:"mediasoup-client"},a.name="-",a.timing={start:0,stop:0},a.icelite=t.iceLite?"ice-lite":null,a.msidSemantic={semantic:"WMS",token:"*"},i.length>0&&(a.groups=[{type:"BUNDLE",mids:i.join(" ")}]),a.media=[];var s=o.fingerprints.length;a.fingerprint={type:o.fingerprints[s-1].algorithm,hash:o.fingerprints[s-1].value};var c=!0,u=!1,d=void 0;try{for(var l,p=e[Symbol.iterator]();!(c=(l=p.next()).done);c=!0){var f=l.value,m=f.closed,h=f.kind,y=void 0,_=void 0;"application"!==f.kind&&(y=this._rtpParametersByKind[h].codecs,_=this._rtpParametersByKind[h].headerExtensions);var g={};"application"!==f.kind?(g.type=h,g.port=7,g.protocol="RTP/SAVPF",g.connection={ip:"127.0.0.1",version:4},g.mid=f.mid,g.msid="".concat(f.streamId," ").concat(f.trackId)):(g.type=h,g.port=9,g.protocol="DTLS/SCTP",g.connection={ip:"127.0.0.1",version:4},g.mid=f.mid),g.iceUfrag=t.usernameFragment,g.icePwd=t.password,g.candidates=[];var b=!0,P=!1,w=void 0;try{for(var k,S=r[Symbol.iterator]();!(b=(k=S.next()).done);b=!0){var R=k.value,T={component:1};T.foundation=R.foundation,T.ip=R.ip,T.port=R.port,T.priority=R.priority,T.transport=R.protocol,T.type=R.type,R.tcpType&&(T.tcptype=R.tcpType),g.candidates.push(T)}}catch(e){P=!0,w=e}finally{try{b||null==S.return||S.return()}finally{if(P)throw w}}if(g.endOfCandidates="end-of-candidates",g.iceOptions="renomination",g.setup="actpass","application"!==f.kind){g.direction=m?"inactive":"sendonly",g.rtp=[],g.rtcpFb=[],g.fmtp=[];var C=!0,O=!1,E=void 0;try{for(var x,D=y[Symbol.iterator]();!(C=(x=D.next()).done);C=!0){var j=x.value,I={payload:j.payloadType,codec:j.name,rate:j.clockRate};if(j.channels>1&&(I.encoding=j.channels),g.rtp.push(I),j.parameters){for(var L={payload:j.payloadType,config:""},M=0,A=Object.keys(j.parameters);M<A.length;M++){var F=A[M];L.config&&(L.config+=";"),L.config+="".concat(F,"=").concat(j.parameters[F])}L.config&&g.fmtp.push(L)}if(j.rtcpFeedback){var B=!0,U=!1,N=void 0;try{for(var G,W=j.rtcpFeedback[Symbol.iterator]();!(B=(G=W.next()).done);B=!0){var z=G.value;g.rtcpFb.push({payload:j.payloadType,type:z.type,subtype:z.parameter||""})}}catch(e){U=!0,N=e}finally{try{B||null==W.return||W.return()}finally{if(U)throw N}}}}}catch(e){O=!0,E=e}finally{try{C||null==D.return||D.return()}finally{if(O)throw E}}if(g.payloads=y.map((function(e){return e.payloadType})).join(" "),!m){g.ext=[];var q=!0,K=!1,V=void 0;try{for(var J,Q=_[Symbol.iterator]();!(q=(J=Q.next()).done);q=!0){var $=J.value;"urn:ietf:params:rtp-hdrext:sdes:mid"!==$.uri&&g.ext.push({uri:$.uri,value:$.id})}}catch(e){K=!0,V=e}finally{try{q||null==Q.return||Q.return()}finally{if(K)throw V}}}g.rtcpMux="rtcp-mux",g.rtcpRsize="rtcp-rsize",m||(g.ssrcs=[],g.ssrcGroups=[],g.ssrcs.push({id:f.ssrc,attribute:"cname",value:f.cname}),f.rtxSsrc&&(g.ssrcs.push({id:f.rtxSsrc,attribute:"cname",value:f.cname}),g.ssrcGroups.push({semantics:"FID",ssrcs:"".concat(f.ssrc," ").concat(f.rtxSsrc)})))}else g.payloads=5e3,g.sctpmap={app:"webrtc-datachannel",maxMessageSize:256,sctpmapNumber:5e3};a.media.push(g)}}catch(e){u=!0,d=e}finally{try{c||null==p.return||p.return()}finally{if(u)throw d}}return n.default.write(a)}}]),t}(y);r.default=function e(t,r){switch(f(this,e),v.debug("constructor() [direction:%s, rtpParametersByKind:%o]",t,r),t){case"send":return new _(r);case"recv":return new g(r)}}},{"../../Logger":5,"../../utils":33,"sdp-transform":42}],26:[function(e,t,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0}),r.extractRtpCapabilities=function(e){var t=new Map,r=[],n=!1,a=!1,i=!0,s=!1,c=void 0;try{for(var u,d=e.media[Symbol.iterator]();!(i=(u=d.next()).done);i=!0){var l=u.value,p=l.type;switch(p){case"audio":if(n)continue;n=!0;break;case"video":if(a)continue;a=!0;break;default:continue}var f=!0,m=!1,h=void 0;try{for(var v,y=l.rtp[Symbol.iterator]();!(f=(v=y.next()).done);f=!0){var _=v.value,g={name:_.codec,mimeType:"".concat(p,"/").concat(_.codec),kind:p,clockRate:_.rate,preferredPayloadType:_.payload,channels:_.encoding,rtcpFeedback:[],parameters:{}};"audio"!==g.kind?delete g.channels:g.channels||(g.channels=1),t.set(g.preferredPayloadType,g)}}catch(e){m=!0,h=e}finally{try{f||null==y.return||y.return()}finally{if(m)throw h}}var b=!0,P=!1,w=void 0;try{for(var k,S=(l.fmtp||[])[Symbol.iterator]();!(b=(k=S.next()).done);b=!0){var R=k.value,T=o.default.parseFmtpConfig(R.config),C=t.get(R.payload);C&&(C.parameters=T)}}catch(e){P=!0,w=e}finally{try{b||null==S.return||S.return()}finally{if(P)throw w}}var O=!0,E=!1,x=void 0;try{for(var D,j=(l.rtcpFb||[])[Symbol.iterator]();!(O=(D=j.next()).done);O=!0){var I=D.value,L=t.get(I.payload);if(L){var M={type:I.type,parameter:I.subtype};M.parameter||delete M.parameter,L.rtcpFeedback.push(M)}}}catch(e){E=!0,x=e}finally{try{O||null==j.return||j.return()}finally{if(E)throw x}}var A=!0,F=!1,B=void 0;try{for(var U,N=(l.ext||[])[Symbol.iterator]();!(A=(U=N.next()).done);A=!0){var G=U.value,W={kind:p,uri:G.uri,preferredId:G.value};r.push(W)}}catch(e){F=!0,B=e}finally{try{A||null==N.return||N.return()}finally{if(F)throw B}}}}catch(e){s=!0,c=e}finally{try{i||null==d.return||d.return()}finally{if(s)throw c}}return{codecs:Array.from(t.values()),headerExtensions:r,fecMechanisms:[]}},r.extractDtlsParameters=function(e){var t,r=function(e){return(e.media||[]).find((function(e){return e.iceUfrag&&0!==e.port}))}(e),n=r.fingerprint||e.fingerprint;switch(r.setup){case"active":t="client";break;case"passive":t="server";break;case"actpass":t="auto"}return{role:t,fingerprints:[{algorithm:n.type,value:n.hash}]}};var n,o=(n=e("sdp-transform"))&&n.__esModule?n:{default:n}},{"sdp-transform":42}],27:[function(e,t,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0}),r.extractPlainRtpParametersByKind=function(e,t){var r=(e.media||[]).find((function(e){return e.type===t}));if(!r)throw new Error("m=".concat(t," section not found"));return{ip:e.connection.ip,port:r.port}},r.fillRtpParametersForKind=function(e,t,r){var n={cname:null,reducedSize:!0,mux:!0},o=(t.media||[]).find((function(e){return e.type===r}));if(!o)throw new Error("m=".concat(r," section not found"));var a,i=(o.ssrcs||[]).find((function(e){return"cname"===e.attribute}));i&&(a=i.id,n.cname=i.value);e.rtcp=n,e.encodings=[];var s={ssrc:a};e.encodings.push(s)}},{}],28:[function(e,t,r){"use strict";function n(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){if(!(Symbol.iterator in Object(e)||"[object Arguments]"===Object.prototype.toString.call(e)))return;var r=[],n=!0,o=!1,a=void 0;try{for(var i,s=e[Symbol.iterator]();!(n=(i=s.next()).done)&&(r.push(i.value),!t||r.length!==t);n=!0);}catch(e){o=!0,a=e}finally{try{n||null==s.return||s.return()}finally{if(o)throw a}}return r}(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance")}()}Object.defineProperty(r,"__esModule",{value:!0}),r.fillRtpParametersForTrack=function(e,t,r){var o,a=r.kind,i={cname:null,reducedSize:!0,mux:!0},s=(t.media||[]).find((function(e){return e.type===a}));if(!s)throw new Error("m=".concat(a," section not found"));var c=new Set,u=!0,d=!1,l=void 0;try{for(var p,f=(s.ssrcs||[])[Symbol.iterator]();!(u=(p=f.next()).done);u=!0){var m=p.value;if("msid"===m.attribute)if(m.value.split(" ")[1]===r.id){var h=m.id;c.add(h),o||(o=h)}}}catch(e){d=!0,l=e}finally{try{u||null==f.return||f.return()}finally{if(d)throw l}}if(0===c.size)throw new Error("a=ssrc line not found for local track [track.id:".concat(r.id,"]"));var v=new Map,y=!0,_=!1,g=void 0;try{for(var b,P=(s.ssrcGroups||[])[Symbol.iterator]();!(y=(b=P.next()).done);y=!0){var w=b.value;if("FID"===w.semantics){var k=n(w.ssrcs.split(/\s+/),2),S=k[0],R=k[1];S=Number(S),R=Number(R),c.has(S)&&(c.delete(S),c.delete(R),v.set(S,R))}}}catch(e){_=!0,g=e}finally{try{y||null==P.return||P.return()}finally{if(_)throw g}}var T=!0,C=!1,O=void 0;try{for(var E,x=c[Symbol.iterator]();!(T=(E=x.next()).done);T=!0){var D=E.value;v.set(D,null)}}catch(e){C=!0,O=e}finally{try{T||null==x.return||x.return()}finally{if(C)throw O}}var j=s.ssrcs.find((function(e){return"cname"===e.attribute&&e.id===o}));j&&(i.cname=j.value);e.rtcp=i,e.encodings=[];var I=v.size>1,L=["low","medium","high"],M=!0,A=!1,F=void 0;try{for(var B,U=v[Symbol.iterator]();!(M=(B=U.next()).done);M=!0){var N=n(B.value,2),G=N[0],W=N[1],z={ssrc:G};W&&(z.rtx={ssrc:W}),I&&(z.profile=L.shift()),e.encodings.push(z)}}catch(e){A=!0,F=e}finally{try{M||null==U.return||U.return()}finally{if(A)throw F}}},r.addSimulcastForTrack=function(e,t){var r,n,o,a=t.kind,i=(e.media||[]).find((function(e){return e.type===a}));if(!i)throw new Error("m=".concat(a," section not found"));if(!(i.ssrcs||[]).find((function(e){return"msid"===e.attribute&&(e.value.split(" ")[1]===t.id?(r=e.id,o=e.value.split(" ")[0],!0):void 0)})))throw new Error("a=ssrc line not found for local track [track.id:".concat(t.id,"]"));(i.ssrcGroups||[]).some((function(e){if("FID"===e.semantics){var t=e.ssrcs.split(/\s+/);return Number(t[0])===r?(n=Number(t[1]),!0):void 0}}));var s=i.ssrcs.find((function(e){return"cname"===e.attribute&&e.id===r}));if(!s)throw new Error("CNAME line not found for local track [track.id:".concat(t.id,"]"));var c=s.value,u=r+1,d=r+2;if(i.ssrcGroups=i.ssrcGroups||[],i.ssrcGroups.push({semantics:"SIM",ssrcs:"".concat(r," ").concat(u," ").concat(d)}),i.ssrcs.push({id:u,attribute:"cname",value:c}),i.ssrcs.push({id:u,attribute:"msid",value:"".concat(o," ").concat(t.id)}),i.ssrcs.push({id:d,attribute:"cname",value:c}),i.ssrcs.push({id:d,attribute:"msid",value:"".concat(o," ").concat(t.id)}),n){var l=n+1,p=n+2;i.ssrcGroups.push({semantics:"FID",ssrcs:"".concat(u," ").concat(l)}),i.ssrcs.push({id:l,attribute:"cname",value:c}),i.ssrcs.push({id:l,attribute:"msid",value:"".concat(o," ").concat(t.id)}),i.ssrcGroups.push({semantics:"FID",ssrcs:"".concat(d," ").concat(p)}),i.ssrcs.push({id:p,attribute:"cname",value:c}),i.ssrcs.push({id:p,attribute:"msid",value:"".concat(o," ").concat(t.id)})}}},{}],29:[function(e,t,r){"use strict";function n(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){if(!(Symbol.iterator in Object(e)||"[object Arguments]"===Object.prototype.toString.call(e)))return;var r=[],n=!0,o=!1,a=void 0;try{for(var i,s=e[Symbol.iterator]();!(n=(i=s.next()).done)&&(r.push(i.value),!t||r.length!==t);n=!0);}catch(e){o=!0,a=e}finally{try{n||null==s.return||s.return()}finally{if(o)throw a}}return r}(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance")}()}function o(e,t,r){var n;if(null!=r){if(r=String(r),!(n=(e.media||[]).find((function(e){return String(e.mid)===r}))))throw new Error("SDP section with mid=".concat(r," not found"))}else if(!(n=(e.media||[]).find((function(e){return e.type===t.kind&&e.msid&&e.msid.split(" ")[1]===t.id}))))throw new Error("SDP section with a=msid containing track.id=".concat(t.id," not found"));return n}Object.defineProperty(r,"__esModule",{value:!0}),r.fillRtpParametersForTrack=function(e,t,r){var a=arguments.length>3&&void 0!==arguments[3]?arguments[3]:{},i=a.mid,s=void 0===i?null:i,c=a.planBSimulcast,u=void 0!==c&&c,d=o(t,r,s);null!=s&&(e.muxId=String(s));e.rtcp={cname:null,reducedSize:!0,mux:!0};var l=(d.ssrcs||[]).find((function(e){return"cname"===e.attribute}));if(!l)throw new Error("CNAME value not found");if(e.rtcp.cname=l.value,u){var p,f=new Set,m=!0,h=!1,v=void 0;try{for(var y,_=(d.ssrcs||[])[Symbol.iterator]();!(m=(y=_.next()).done);m=!0){var g=y.value;if("msid"===g.attribute){var b=g.id;f.add(b),p||(p=b)}}}catch(e){h=!0,v=e}finally{try{m||null==_.return||_.return()}finally{if(h)throw v}}if(0===f.size)throw new Error("no a=ssrc lines found");var P=new Map,w=!0,k=!1,S=void 0;try{for(var R,T=(d.ssrcGroups||[])[Symbol.iterator]();!(w=(R=T.next()).done);w=!0){var C=R.value;if("FID"===C.semantics){var O=n(C.ssrcs.split(/\s+/),2),E=O[0],x=O[1];E=Number(E),x=Number(x),f.has(E)&&(f.delete(E),f.delete(x),P.set(E,x))}}}catch(e){k=!0,S=e}finally{try{w||null==T.return||T.return()}finally{if(k)throw S}}var D=!0,j=!1,I=void 0;try{for(var L,M=f[Symbol.iterator]();!(D=(L=M.next()).done);D=!0){var A=L.value;P.set(A,null)}}catch(e){j=!0,I=e}finally{try{D||null==M.return||M.return()}finally{if(j)throw I}}e.encodings=[];var F=P.size>1,B=["low","medium","high"],U=!0,N=!1,G=void 0;try{for(var W,z=P[Symbol.iterator]();!(U=(W=z.next()).done);U=!0){var q=n(W.value,2),K=q[0],V=q[1],J={ssrc:K};V&&(J.rtx={ssrc:V}),F&&(J.profile=B.shift()),e.encodings.push(J)}}catch(e){N=!0,G=e}finally{try{U||null==z.return||z.return()}finally{if(N)throw G}}}else{var Q=l.id,$=[],H=!0,Z=!1,X=void 0;try{for(var Y,ee=(d.rids||[])[Symbol.iterator]();!(H=(Y=ee.next()).done);H=!0){var te=Y.value;"send"===te.direction&&(/^low/.test(te.id)?$.push({rid:te.id,profile:"low"}):/^medium/.test(te.id)&&$.push({rid:te.id,profile:"medium"}),/^high/.test(te.id)&&$.push({rid:te.id,profile:"high"}))}}catch(e){Z=!0,X=e}finally{try{H||null==ee.return||ee.return()}finally{if(Z)throw X}}if(e.encodings=[],0===$.length){var re={ssrc:Q};e.encodings.push(re)}else{var ne=!0,oe=!1,ae=void 0;try{for(var ie,se=$[Symbol.iterator]();!(ne=(ie=se.next()).done);ne=!0){var ce=ie.value,ue={encodingId:ce.rid,profile:ce.profile};e.encodings.push(ue)}}catch(e){oe=!0,ae=e}finally{try{ne||null==se.return||se.return()}finally{if(oe)throw ae}}}}},r.addPlanBSimulcast=function(e,t){var r=(arguments.length>2&&void 0!==arguments[2]?arguments[2]:{}).mid,n=o(e,t,void 0===r?null:r),a=(n.ssrcs||[]).find((function(e){return"msid"===e.attribute}));if(!a)throw new Error("a=ssrc line with msid information not found");var i,s=a.id,c=a.value.split(" ")[0];(n.ssrcGroups||[]).some((function(e){if("FID"===e.semantics){var t=e.ssrcs.split(/\s+/);return Number(t[0])===s?(i=Number(t[1]),!0):void 0}}));var u=n.ssrcs.find((function(e){return"cname"===e.attribute&&e.id===s}));if(!u)throw new Error("CNAME line not found");var d=u.value,l=s+1,p=s+2;if(n.ssrcGroups=[],n.ssrcs=[],n.ssrcGroups.push({semantics:"SIM",ssrcs:"".concat(s," ").concat(l," ").concat(p)}),n.ssrcs.push({id:s,attribute:"cname",value:d}),n.ssrcs.push({id:s,attribute:"msid",value:"".concat(c," ").concat(t.id)}),n.ssrcs.push({id:l,attribute:"cname",value:d}),n.ssrcs.push({id:l,attribute:"msid",value:"".concat(c," ").concat(t.id)}),n.ssrcs.push({id:p,attribute:"cname",value:d}),n.ssrcs.push({id:p,attribute:"msid",value:"".concat(c," ").concat(t.id)}),i){var f=i+1,m=i+2;n.ssrcGroups.push({semantics:"FID",ssrcs:"".concat(s," ").concat(i)}),n.ssrcs.push({id:i,attribute:"cname",value:d}),n.ssrcs.push({id:i,attribute:"msid",value:"".concat(c," ").concat(t.id)}),n.ssrcGroups.push({semantics:"FID",ssrcs:"".concat(l," ").concat(f)}),n.ssrcs.push({id:f,attribute:"cname",value:d}),n.ssrcs.push({id:f,attribute:"msid",value:"".concat(c," ").concat(t.id)}),n.ssrcGroups.push({semantics:"FID",ssrcs:"".concat(p," ").concat(m)}),n.ssrcs.push({id:m,attribute:"cname",value:d}),n.ssrcs.push({id:m,attribute:"msid",value:"".concat(c," ").concat(t.id)})}}},{}],30:[function(e,t,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0}),r.setDeviceHandler=function(e,t){o.default.setHandler(e,t)},r.isDeviceSupported=function(){return o.default.isSupported()},r.getDeviceInfo=function(){return{flag:o.default.getFlag(),name:o.default.getName(),version:o.default.getVersion(),bowser:o.default.getBowser()}},r.checkCapabilitiesForRoom=function(e){return o.default.isSupported()?o.default.Handler.getNativeRtpCapabilities().then((function(t){var r=n.getExtendedRtpCapabilities(t,e);return{audio:n.canSend("audio",r),video:n.canSend("video",r)}})):Promise.reject(new Error("current browser/device not supported"))},Object.defineProperty(r,"Room",{enumerable:!0,get:function(){return a.default}}),r.internals=void 0;var n=u(e("./ortc")),o=s(e("./Device")),a=s(e("./Room")),i=u(e("./internals"));function s(e){return e&&e.__esModule?e:{default:e}}function c(){if("function"!=typeof WeakMap)return null;var e=new WeakMap;return c=function(){return e},e}function u(e){if(e&&e.__esModule)return e;var t=c();if(t&&t.has(e))return t.get(e);var r={};if(null!=e){var n=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var o in e)if(Object.prototype.hasOwnProperty.call(e,o)){var a=n?Object.getOwnPropertyDescriptor(e,o):null;a&&(a.get||a.set)?Object.defineProperty(r,o,a):r[o]=e[o]}}return r.default=e,t&&t.set(e,r),r}r.internals=i},{"./Device":3,"./Room":8,"./internals":31,"./ortc":32}],31:[function(e,t,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0}),Object.defineProperty(r,"Logger",{enumerable:!0,get:function(){return n.default}}),Object.defineProperty(r,"EnhancedEventEmitter",{enumerable:!0,get:function(){return o.default}}),Object.defineProperty(r,"RemoteUnifiedPlanSdp",{enumerable:!0,get:function(){return l.default}}),Object.defineProperty(r,"RemotePlanBSdp",{enumerable:!0,get:function(){return p.default}}),Object.defineProperty(r,"RemotePlainRtpSdp",{enumerable:!0,get:function(){return f.default}}),r.sdpPlainRtpUtils=r.sdpPlanBUtils=r.sdpUnifiedPlanUtils=r.sdpCommonUtils=r.ortc=r.utils=void 0;var n=v(e("./Logger")),o=v(e("./EnhancedEventEmitter")),a=h(e("./utils"));r.utils=a;var i=h(e("./ortc"));r.ortc=i;var s=h(e("./handlers/sdp/commonUtils"));r.sdpCommonUtils=s;var c=h(e("./handlers/sdp/unifiedPlanUtils"));r.sdpUnifiedPlanUtils=c;var u=h(e("./handlers/sdp/planBUtils"));r.sdpPlanBUtils=u;var d=h(e("./handlers/sdp/plainRtpUtils"));r.sdpPlainRtpUtils=d;var l=v(e("./handlers/sdp/RemoteUnifiedPlanSdp")),p=v(e("./handlers/sdp/RemotePlanBSdp")),f=v(e("./handlers/sdp/RemotePlainRtpSdp"));function m(){if("function"!=typeof WeakMap)return null;var e=new WeakMap;return m=function(){return e},e}function h(e){if(e&&e.__esModule)return e;var t=m();if(t&&t.has(e))return t.get(e);var r={};if(null!=e){var n=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var o in e)if(Object.prototype.hasOwnProperty.call(e,o)){var a=n?Object.getOwnPropertyDescriptor(e,o):null;a&&(a.get||a.set)?Object.defineProperty(r,o,a):r[o]=e[o]}}return r.default=e,t&&t.set(e,r),r}function v(e){return e&&e.__esModule?e:{default:e}}},{"./EnhancedEventEmitter":4,"./Logger":5,"./handlers/sdp/RemotePlainRtpSdp":23,"./handlers/sdp/RemotePlanBSdp":24,"./handlers/sdp/RemoteUnifiedPlanSdp":25,"./handlers/sdp/commonUtils":26,"./handlers/sdp/plainRtpUtils":27,"./handlers/sdp/planBUtils":28,"./handlers/sdp/unifiedPlanUtils":29,"./ortc":32,"./utils":33}],32:[function(e,t,r){"use strict";function n(e,t){var r=[],n=!0,o=!1,a=void 0;try{for(var i,s=function(){var e=i.value,n=(t.rtcpFeedback||[]).find((function(t){return t.type===e.type&&t.parameter===e.parameter}));n&&r.push(n)},c=(e.rtcpFeedback||[])[Symbol.iterator]();!(n=(i=c.next()).done);n=!0)s()}catch(e){o=!0,a=e}finally{try{n||null==c.return||c.return()}finally{if(o)throw a}}return r}Object.defineProperty(r,"__esModule",{value:!0}),r.getExtendedRtpCapabilities=function(e,t){var r={codecs:[],headerExtensions:[],fecMechanisms:[]},o=!0,a=!1,i=void 0;try{for(var s,c=function(){var t=s.value;if("rtx"===t.name)return"continue";var o=(e.codecs||[]).find((function(e){return function(e,t){var r=e.mimeType.toLowerCase(),n=t.mimeType.toLowerCase();if(r!==n)return!1;if(e.clockRate!==t.clockRate)return!1;if(e.channels!==t.channels)return!1;if("video/h264"===r){var o=(e.parameters||{})["packetization-mode"]||0,a=(t.parameters||{})["packetization-mode"]||0;if(o!==a)return!1}return!0}(e,t)}));if(o){var a={name:t.name,mimeType:t.mimeType,kind:t.kind,clockRate:t.clockRate,sendPayloadType:o.preferredPayloadType,sendRtxPayloadType:null,recvPayloadType:t.preferredPayloadType,recvRtxPayloadType:null,channels:t.channels,rtcpFeedback:n(o,t),parameters:t.parameters};a.channels||delete a.channels,r.codecs.push(a)}},u=(t.codecs||[])[Symbol.iterator]();!(o=(s=u.next()).done);o=!0)c()}catch(e){a=!0,i=e}finally{try{o||null==u.return||u.return()}finally{if(a)throw i}}var d=!0,l=!1,p=void 0;try{for(var f,m=function(){var r=f.value,n=(e.codecs||[]).find((function(e){return"rtx"===e.name&&e.parameters.apt===r.sendPayloadType})),o=(t.codecs||[]).find((function(e){return"rtx"===e.name&&e.parameters.apt===r.recvPayloadType}));n&&o&&(r.sendRtxPayloadType=n.preferredPayloadType,r.recvRtxPayloadType=o.preferredPayloadType)},h=(r.codecs||[])[Symbol.iterator]();!(d=(f=h.next()).done);d=!0)m()}catch(e){l=!0,p=e}finally{try{d||null==h.return||h.return()}finally{if(l)throw p}}var v=!0,y=!1,_=void 0;try{for(var g,b=function(){var t=g.value,n=(e.headerExtensions||[]).find((function(e){return n=t,!((r=e).kind&&n.kind&&r.kind!==n.kind||r.uri!==n.uri);var r,n}));if(n){var o={kind:t.kind,uri:t.uri,sendId:n.preferredId,recvId:t.preferredId};r.headerExtensions.push(o)}},P=(t.headerExtensions||[])[Symbol.iterator]();!(v=(g=P.next()).done);v=!0)b()}catch(e){y=!0,_=e}finally{try{v||null==P.return||P.return()}finally{if(y)throw _}}return r},r.getRtpCapabilities=function(e){var t={codecs:[],headerExtensions:[],fecMechanisms:[]},r=!0,n=!1,o=void 0;try{for(var a,i=e.codecs[Symbol.iterator]();!(r=(a=i.next()).done);r=!0){var s=a.value,c={name:s.name,mimeType:s.mimeType,kind:s.kind,clockRate:s.clockRate,preferredPayloadType:s.recvPayloadType,channels:s.channels,rtcpFeedback:s.rtcpFeedback,parameters:s.parameters};if(c.channels||delete c.channels,t.codecs.push(c),s.recvRtxPayloadType){var u={name:"rtx",mimeType:"".concat(s.kind,"/rtx"),kind:s.kind,clockRate:s.clockRate,preferredPayloadType:s.recvRtxPayloadType,parameters:{apt:s.recvPayloadType}};t.codecs.push(u)}}}catch(e){n=!0,o=e}finally{try{r||null==i.return||i.return()}finally{if(n)throw o}}var d=!0,l=!1,p=void 0;try{for(var f,m=e.headerExtensions[Symbol.iterator]();!(d=(f=m.next()).done);d=!0){var h=f.value,v={kind:h.kind,uri:h.uri,preferredId:h.recvId};t.headerExtensions.push(v)}}catch(e){l=!0,p=e}finally{try{d||null==m.return||m.return()}finally{if(l)throw p}}return t.fecMechanisms=e.fecMechanisms,t},r.getUnsupportedCodecs=function(e,t,r){if(!Array.isArray(t))return[];var n=[],o=e.codecs,a=r.codecs,i=!0,s=!1,c=void 0;try{for(var u,d=function(){var e=u.value;if(!a.some((function(t){return t.recvPayloadType===e}))){var t=o.find((function(t){return t.preferredPayloadType===e}));if(!t)throw new Error("mandatory codec PT ".concat(e," not found in remote codecs"));n.push(t)}},l=t[Symbol.iterator]();!(i=(u=l.next()).done);i=!0)d()}catch(e){s=!0,c=e}finally{try{i||null==l.return||l.return()}finally{if(s)throw c}}return n},r.canSend=function(e,t){return t.codecs.some((function(t){return t.kind===e}))},r.canReceive=function(e,t){if(0===e.codecs.length)return!1;var r=e.codecs[0];return t.codecs.some((function(e){return e.recvPayloadType===r.payloadType}))},r.getSendingRtpParameters=function(e,t){var r={muxId:null,codecs:[],headerExtensions:[],encodings:[],rtcp:{}},n=!0,o=!1,a=void 0;try{for(var i,s=t.codecs[Symbol.iterator]();!(n=(i=s.next()).done);n=!0){var c=i.value;if(c.kind===e){var u={name:c.name,mimeType:c.mimeType,clockRate:c.clockRate,payloadType:c.sendPayloadType,channels:c.channels,rtcpFeedback:c.rtcpFeedback,parameters:c.parameters};if(u.channels||delete u.channels,r.codecs.push(u),c.sendRtxPayloadType){var d={name:"rtx",mimeType:"".concat(c.kind,"/rtx"),clockRate:c.clockRate,payloadType:c.sendRtxPayloadType,parameters:{apt:c.sendPayloadType}};r.codecs.push(d)}break}}}catch(e){o=!0,a=e}finally{try{n||null==s.return||s.return()}finally{if(o)throw a}}var l=!0,p=!1,f=void 0;try{for(var m,h=t.headerExtensions[Symbol.iterator]();!(l=(m=h.next()).done);l=!0){var v=m.value;if(!v.kind||v.kind===e){var y={uri:v.uri,id:v.sendId};r.headerExtensions.push(y)}}}catch(e){p=!0,f=e}finally{try{l||null==h.return||h.return()}finally{if(p)throw f}}return r},r.getReceivingFullRtpParameters=function(e,t){var r={muxId:null,codecs:[],headerExtensions:[],encodings:[],rtcp:{}},n=!0,o=!1,a=void 0;try{for(var i,s=t.codecs[Symbol.iterator]();!(n=(i=s.next()).done);n=!0){var c=i.value;if(c.kind===e){var u={name:c.name,mimeType:c.mimeType,clockRate:c.clockRate,payloadType:c.recvPayloadType,channels:c.channels,rtcpFeedback:c.rtcpFeedback,parameters:c.parameters};if(u.channels||delete u.channels,r.codecs.push(u),c.recvRtxPayloadType){var d={name:"rtx",mimeType:"".concat(c.kind,"/rtx"),clockRate:c.clockRate,payloadType:c.recvRtxPayloadType,parameters:{apt:c.recvPayloadType}};r.codecs.push(d)}}}}catch(e){o=!0,a=e}finally{try{n||null==s.return||s.return()}finally{if(o)throw a}}var l=!0,p=!1,f=void 0;try{for(var m,h=t.headerExtensions[Symbol.iterator]();!(l=(m=h.next()).done);l=!0){var v=m.value;if(!v.kind||v.kind===e){var y={uri:v.uri,id:v.recvId};r.headerExtensions.push(y)}}}catch(e){p=!0,f=e}finally{try{l||null==h.return||h.return()}finally{if(p)throw f}}return r}},{}],33:[function(e,t,r){"use strict";var n;Object.defineProperty(r,"__esModule",{value:!0}),r.randomNumber=function(){return o()},r.clone=function(e){return JSON.parse(JSON.stringify(e))};var o=((n=e("random-number"))&&n.__esModule?n:{default:n}).default.generator({min:1e7,max:99999999,integer:!0})},{"random-number":40}],34:[function(e,t,r){var n,o;n=this,o=function(){var e=!0;function t(t){function r(e){var r=t.match(e);return r&&r.length>1&&r[1]||""}function n(e){var r=t.match(e);return r&&r.length>1&&r[2]||""}var o,i=r(/(ipod|iphone|ipad)/i).toLowerCase(),s=!/like android/i.test(t)&&/android/i.test(t),c=/nexus\s*[0-6]\s*/i.test(t),u=!c&&/nexus\s*[0-9]+/i.test(t),d=/CrOS/.test(t),l=/silk/i.test(t),p=/sailfish/i.test(t),f=/tizen/i.test(t),m=/(web|hpw)(o|0)s/i.test(t),h=/windows phone/i.test(t),v=(/SamsungBrowser/i.test(t),!h&&/windows/i.test(t)),y=!i&&!l&&/macintosh/i.test(t),_=!s&&!p&&!f&&!m&&/linux/i.test(t),g=n(/edg([ea]|ios)\/(\d+(\.\d+)?)/i),b=r(/version\/(\d+(\.\d+)?)/i),P=/tablet/i.test(t)&&!/tablet pc/i.test(t),w=!P&&/[^-]mobi/i.test(t),k=/xbox/i.test(t);/opera/i.test(t)?o={name:"Opera",opera:e,version:b||r(/(?:opera|opr|opios)[\s\/](\d+(\.\d+)?)/i)}:/opr\/|opios/i.test(t)?o={name:"Opera",opera:e,version:r(/(?:opr|opios)[\s\/](\d+(\.\d+)?)/i)||b}:/SamsungBrowser/i.test(t)?o={name:"Samsung Internet for Android",samsungBrowser:e,version:b||r(/(?:SamsungBrowser)[\s\/](\d+(\.\d+)?)/i)}:/Whale/i.test(t)?o={name:"NAVER Whale browser",whale:e,version:r(/(?:whale)[\s\/](\d+(?:\.\d+)+)/i)}:/MZBrowser/i.test(t)?o={name:"MZ Browser",mzbrowser:e,version:r(/(?:MZBrowser)[\s\/](\d+(?:\.\d+)+)/i)}:/coast/i.test(t)?o={name:"Opera Coast",coast:e,version:b||r(/(?:coast)[\s\/](\d+(\.\d+)?)/i)}:/focus/i.test(t)?o={name:"Focus",focus:e,version:r(/(?:focus)[\s\/](\d+(?:\.\d+)+)/i)}:/yabrowser/i.test(t)?o={name:"Yandex Browser",yandexbrowser:e,version:b||r(/(?:yabrowser)[\s\/](\d+(\.\d+)?)/i)}:/ucbrowser/i.test(t)?o={name:"UC Browser",ucbrowser:e,version:r(/(?:ucbrowser)[\s\/](\d+(?:\.\d+)+)/i)}:/mxios/i.test(t)?o={name:"Maxthon",maxthon:e,version:r(/(?:mxios)[\s\/](\d+(?:\.\d+)+)/i)}:/epiphany/i.test(t)?o={name:"Epiphany",epiphany:e,version:r(/(?:epiphany)[\s\/](\d+(?:\.\d+)+)/i)}:/puffin/i.test(t)?o={name:"Puffin",puffin:e,version:r(/(?:puffin)[\s\/](\d+(?:\.\d+)?)/i)}:/sleipnir/i.test(t)?o={name:"Sleipnir",sleipnir:e,version:r(/(?:sleipnir)[\s\/](\d+(?:\.\d+)+)/i)}:/k-meleon/i.test(t)?o={name:"K-Meleon",kMeleon:e,version:r(/(?:k-meleon)[\s\/](\d+(?:\.\d+)+)/i)}:h?(o={name:"Windows Phone",osname:"Windows Phone",windowsphone:e},g?(o.msedge=e,o.version=g):(o.msie=e,o.version=r(/iemobile\/(\d+(\.\d+)?)/i))):/msie|trident/i.test(t)?o={name:"Internet Explorer",msie:e,version:r(/(?:msie |rv:)(\d+(\.\d+)?)/i)}:d?o={name:"Chrome",osname:"Chrome OS",chromeos:e,chromeBook:e,chrome:e,version:r(/(?:chrome|crios|crmo)\/(\d+(\.\d+)?)/i)}:/edg([ea]|ios)/i.test(t)?o={name:"Microsoft Edge",msedge:e,version:g}:/vivaldi/i.test(t)?o={name:"Vivaldi",vivaldi:e,version:r(/vivaldi\/(\d+(\.\d+)?)/i)||b}:p?o={name:"Sailfish",osname:"Sailfish OS",sailfish:e,version:r(/sailfish\s?browser\/(\d+(\.\d+)?)/i)}:/seamonkey\//i.test(t)?o={name:"SeaMonkey",seamonkey:e,version:r(/seamonkey\/(\d+(\.\d+)?)/i)}:/firefox|iceweasel|fxios/i.test(t)?(o={name:"Firefox",firefox:e,version:r(/(?:firefox|iceweasel|fxios)[ \/](\d+(\.\d+)?)/i)},/\((mobile|tablet);[^\)]*rv:[\d\.]+\)/i.test(t)&&(o.firefoxos=e,o.osname="Firefox OS")):l?o={name:"Amazon Silk",silk:e,version:r(/silk\/(\d+(\.\d+)?)/i)}:/phantom/i.test(t)?o={name:"PhantomJS",phantom:e,version:r(/phantomjs\/(\d+(\.\d+)?)/i)}:/slimerjs/i.test(t)?o={name:"SlimerJS",slimer:e,version:r(/slimerjs\/(\d+(\.\d+)?)/i)}:/blackberry|\bbb\d+/i.test(t)||/rim\stablet/i.test(t)?o={name:"BlackBerry",osname:"BlackBerry OS",blackberry:e,version:b||r(/blackberry[\d]+\/(\d+(\.\d+)?)/i)}:m?(o={name:"WebOS",osname:"WebOS",webos:e,version:b||r(/w(?:eb)?osbrowser\/(\d+(\.\d+)?)/i)},/touchpad\//i.test(t)&&(o.touchpad=e)):/bada/i.test(t)?o={name:"Bada",osname:"Bada",bada:e,version:r(/dolfin\/(\d+(\.\d+)?)/i)}:f?o={name:"Tizen",osname:"Tizen",tizen:e,version:r(/(?:tizen\s?)?browser\/(\d+(\.\d+)?)/i)||b}:/qupzilla/i.test(t)?o={name:"QupZilla",qupzilla:e,version:r(/(?:qupzilla)[\s\/](\d+(?:\.\d+)+)/i)||b}:/chromium/i.test(t)?o={name:"Chromium",chromium:e,version:r(/(?:chromium)[\s\/](\d+(?:\.\d+)?)/i)||b}:/chrome|crios|crmo/i.test(t)?o={name:"Chrome",chrome:e,version:r(/(?:chrome|crios|crmo)\/(\d+(\.\d+)?)/i)}:s?o={name:"Android",version:b}:/safari|applewebkit/i.test(t)?(o={name:"Safari",safari:e},b&&(o.version=b)):i?(o={name:"iphone"==i?"iPhone":"ipad"==i?"iPad":"iPod"},b&&(o.version=b)):o=/googlebot/i.test(t)?{name:"Googlebot",googlebot:e,version:r(/googlebot\/(\d+(\.\d+))/i)||b}:{name:r(/^(.*)\/(.*) /),version:n(/^(.*)\/(.*) /)},!o.msedge&&/(apple)?webkit/i.test(t)?(/(apple)?webkit\/537\.36/i.test(t)?(o.name=o.name||"Blink",o.blink=e):(o.name=o.name||"Webkit",o.webkit=e),!o.version&&b&&(o.version=b)):!o.opera&&/gecko\//i.test(t)&&(o.name=o.name||"Gecko",o.gecko=e,o.version=o.version||r(/gecko\/(\d+(\.\d+)?)/i)),o.windowsphone||!s&&!o.silk?!o.windowsphone&&i?(o[i]=e,o.ios=e,o.osname="iOS"):y?(o.mac=e,o.osname="macOS"):k?(o.xbox=e,o.osname="Xbox"):v?(o.windows=e,o.osname="Windows"):_&&(o.linux=e,o.osname="Linux"):(o.android=e,o.osname="Android");var S="";o.windows?S=function(e){switch(e){case"NT":return"NT";case"XP":return"XP";case"NT 5.0":return"2000";case"NT 5.1":return"XP";case"NT 5.2":return"2003";case"NT 6.0":return"Vista";case"NT 6.1":return"7";case"NT 6.2":return"8";case"NT 6.3":return"8.1";case"NT 10.0":return"10";default:return}}(r(/Windows ((NT|XP)( \d\d?.\d)?)/i)):o.windowsphone?S=r(/windows phone (?:os)?\s?(\d+(\.\d+)*)/i):o.mac?S=(S=r(/Mac OS X (\d+([_\.\s]\d+)*)/i)).replace(/[_\s]/g,"."):i?S=(S=r(/os (\d+([_\s]\d+)*) like mac os x/i)).replace(/[_\s]/g,"."):s?S=r(/android[ \/-](\d+(\.\d+)*)/i):o.webos?S=r(/(?:web|hpw)os\/(\d+(\.\d+)*)/i):o.blackberry?S=r(/rim\stablet\sos\s(\d+(\.\d+)*)/i):o.bada?S=r(/bada\/(\d+(\.\d+)*)/i):o.tizen&&(S=r(/tizen[\/\s](\d+(\.\d+)*)/i)),S&&(o.osversion=S);var R=!o.windows&&S.split(".")[0];return P||u||"ipad"==i||s&&(3==R||R>=4&&!w)||o.silk?o.tablet=e:(w||"iphone"==i||"ipod"==i||s||c||o.blackberry||o.webos||o.bada)&&(o.mobile=e),o.msedge||o.msie&&o.version>=10||o.yandexbrowser&&o.version>=15||o.vivaldi&&o.version>=1||o.chrome&&o.version>=20||o.samsungBrowser&&o.version>=4||o.whale&&1===a([o.version,"1.0"])||o.mzbrowser&&1===a([o.version,"6.0"])||o.focus&&1===a([o.version,"1.0"])||o.firefox&&o.version>=20||o.safari&&o.version>=6||o.opera&&o.version>=10||o.ios&&o.osversion&&o.osversion.split(".")[0]>=6||o.blackberry&&o.version>=10.1||o.chromium&&o.version>=20?o.a=e:o.msie&&o.version<10||o.chrome&&o.version<20||o.firefox&&o.version<20||o.safari&&o.version<6||o.opera&&o.version<10||o.ios&&o.osversion&&o.osversion.split(".")[0]<6||o.chromium&&o.version<20?o.c=e:o.x=e,o}var r=t("undefined"!=typeof navigator&&navigator.userAgent||"");function n(e){return e.split(".").length}function o(e,t){var r,n=[];if(Array.prototype.map)return Array.prototype.map.call(e,t);for(r=0;r<e.length;r++)n.push(t(e[r]));return n}function a(e){for(var t=Math.max(n(e[0]),n(e[1])),r=o(e,(function(e){var r=t-n(e);return o((e+=new Array(r+1).join(".0")).split("."),(function(e){return new Array(20-e.length).join("0")+e})).reverse()}));--t>=0;){if(r[0][t]>r[1][t])return 1;if(r[0][t]!==r[1][t])return-1;if(0===t)return 0}}function i(e,n,o){var i=r;"string"==typeof n&&(o=n,n=void 0),void 0===n&&(n=!1),o&&(i=t(o));var s=""+i.version;for(var c in e)if(e.hasOwnProperty(c)&&i[c]){if("string"!=typeof e[c])throw new Error("Browser version in the minVersion map should be a string: "+c+": "+String(e));return a([s,e[c]])<0}return n}return r.test=function(e){for(var t=0;t<e.length;++t){var n=e[t];if("string"==typeof n&&n in r)return!0}return!1},r.isUnsupportedBrowser=i,r.compareVersions=a,r.check=function(e,t,r){return!i(e,t,r)},r._detect=t,r.detect=t,r},void 0!==t&&t.exports?t.exports=o():n.bowser=o()},{}],35:[function(e,t,r){var n=Object.create||function(e){var t=function(){};return t.prototype=e,new t},o=Object.keys||function(e){var t=[];for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&t.push(r);return r},a=Function.prototype.bind||function(e){var t=this;return function(){return t.apply(e,arguments)}};function i(){this._events&&Object.prototype.hasOwnProperty.call(this,"_events")||(this._events=n(null),this._eventsCount=0),this._maxListeners=this._maxListeners||void 0}t.exports=i,i.EventEmitter=i,i.prototype._events=void 0,i.prototype._maxListeners=void 0;var s,c=10;try{var u={};Object.defineProperty&&Object.defineProperty(u,"x",{value:0}),s=0===u.x}catch(e){s=!1}function d(e){return void 0===e._maxListeners?i.defaultMaxListeners:e._maxListeners}function l(e,t,r){if(t)e.call(r);else for(var n=e.length,o=P(e,n),a=0;a<n;++a)o[a].call(r)}function p(e,t,r,n){if(t)e.call(r,n);else for(var o=e.length,a=P(e,o),i=0;i<o;++i)a[i].call(r,n)}function f(e,t,r,n,o){if(t)e.call(r,n,o);else for(var a=e.length,i=P(e,a),s=0;s<a;++s)i[s].call(r,n,o)}function m(e,t,r,n,o,a){if(t)e.call(r,n,o,a);else for(var i=e.length,s=P(e,i),c=0;c<i;++c)s[c].call(r,n,o,a)}function h(e,t,r,n){if(t)e.apply(r,n);else for(var o=e.length,a=P(e,o),i=0;i<o;++i)a[i].apply(r,n)}function v(e,t,r,o){var a,i,s;if("function"!=typeof r)throw new TypeError('"listener" argument must be a function');if((i=e._events)?(i.newListener&&(e.emit("newListener",t,r.listener?r.listener:r),i=e._events),s=i[t]):(i=e._events=n(null),e._eventsCount=0),s){if("function"==typeof s?s=i[t]=o?[r,s]:[s,r]:o?s.unshift(r):s.push(r),!s.warned&&(a=d(e))&&a>0&&s.length>a){s.warned=!0;var c=new Error("Possible EventEmitter memory leak detected. "+s.length+' "'+String(t)+'" listeners added. Use emitter.setMaxListeners() to increase limit.');c.name="MaxListenersExceededWarning",c.emitter=e,c.type=t,c.count=s.length,"object"==typeof console&&console.warn&&console.warn("%s: %s",c.name,c.message)}}else s=i[t]=r,++e._eventsCount;return e}function y(){if(!this.fired)switch(this.target.removeListener(this.type,this.wrapFn),this.fired=!0,arguments.length){case 0:return this.listener.call(this.target);case 1:return this.listener.call(this.target,arguments[0]);case 2:return this.listener.call(this.target,arguments[0],arguments[1]);case 3:return this.listener.call(this.target,arguments[0],arguments[1],arguments[2]);default:for(var e=new Array(arguments.length),t=0;t<e.length;++t)e[t]=arguments[t];this.listener.apply(this.target,e)}}function _(e,t,r){var n={fired:!1,wrapFn:void 0,target:e,type:t,listener:r},o=a.call(y,n);return o.listener=r,n.wrapFn=o,o}function g(e,t,r){var n=e._events;if(!n)return[];var o=n[t];return o?"function"==typeof o?r?[o.listener||o]:[o]:r?function(e){for(var t=new Array(e.length),r=0;r<t.length;++r)t[r]=e[r].listener||e[r];return t}(o):P(o,o.length):[]}function b(e){var t=this._events;if(t){var r=t[e];if("function"==typeof r)return 1;if(r)return r.length}return 0}function P(e,t){for(var r=new Array(t),n=0;n<t;++n)r[n]=e[n];return r}s?Object.defineProperty(i,"defaultMaxListeners",{enumerable:!0,get:function(){return c},set:function(e){if("number"!=typeof e||e<0||e!=e)throw new TypeError('"defaultMaxListeners" must be a positive number');c=e}}):i.defaultMaxListeners=c,i.prototype.setMaxListeners=function(e){if("number"!=typeof e||e<0||isNaN(e))throw new TypeError('"n" argument must be a positive number');return this._maxListeners=e,this},i.prototype.getMaxListeners=function(){return d(this)},i.prototype.emit=function(e){var t,r,n,o,a,i,s="error"===e;if(i=this._events)s=s&&null==i.error;else if(!s)return!1;if(s){if(arguments.length>1&&(t=arguments[1]),t instanceof Error)throw t;var c=new Error('Unhandled "error" event. ('+t+")");throw c.context=t,c}if(!(r=i[e]))return!1;var u="function"==typeof r;switch(n=arguments.length){case 1:l(r,u,this);break;case 2:p(r,u,this,arguments[1]);break;case 3:f(r,u,this,arguments[1],arguments[2]);break;case 4:m(r,u,this,arguments[1],arguments[2],arguments[3]);break;default:for(o=new Array(n-1),a=1;a<n;a++)o[a-1]=arguments[a];h(r,u,this,o)}return!0},i.prototype.addListener=function(e,t){return v(this,e,t,!1)},i.prototype.on=i.prototype.addListener,i.prototype.prependListener=function(e,t){return v(this,e,t,!0)},i.prototype.once=function(e,t){if("function"!=typeof t)throw new TypeError('"listener" argument must be a function');return this.on(e,_(this,e,t)),this},i.prototype.prependOnceListener=function(e,t){if("function"!=typeof t)throw new TypeError('"listener" argument must be a function');return this.prependListener(e,_(this,e,t)),this},i.prototype.removeListener=function(e,t){var r,o,a,i,s;if("function"!=typeof t)throw new TypeError('"listener" argument must be a function');if(!(o=this._events))return this;if(!(r=o[e]))return this;if(r===t||r.listener===t)0==--this._eventsCount?this._events=n(null):(delete o[e],o.removeListener&&this.emit("removeListener",e,r.listener||t));else if("function"!=typeof r){for(a=-1,i=r.length-1;i>=0;i--)if(r[i]===t||r[i].listener===t){s=r[i].listener,a=i;break}if(a<0)return this;0===a?r.shift():function(e,t){for(var r=t,n=r+1,o=e.length;n<o;r+=1,n+=1)e[r]=e[n];e.pop()}(r,a),1===r.length&&(o[e]=r[0]),o.removeListener&&this.emit("removeListener",e,s||t)}return this},i.prototype.removeAllListeners=function(e){var t,r,a;if(!(r=this._events))return this;if(!r.removeListener)return 0===arguments.length?(this._events=n(null),this._eventsCount=0):r[e]&&(0==--this._eventsCount?this._events=n(null):delete r[e]),this;if(0===arguments.length){var i,s=o(r);for(a=0;a<s.length;++a)"removeListener"!==(i=s[a])&&this.removeAllListeners(i);return this.removeAllListeners("removeListener"),this._events=n(null),this._eventsCount=0,this}if("function"==typeof(t=r[e]))this.removeListener(e,t);else if(t)for(a=t.length-1;a>=0;a--)this.removeListener(e,t[a]);return this},i.prototype.listeners=function(e){return g(this,e,!0)},i.prototype.rawListeners=function(e){return g(this,e,!1)},i.listenerCount=function(e,t){return"function"==typeof e.listenerCount?e.listenerCount(t):b.call(e,t)},i.prototype.listenerCount=b,i.prototype.eventNames=function(){return this._eventsCount>0?Reflect.ownKeys(this._events):[]}},{}],36:[function(e,t,r){(function(n){r.log=function(...e){return"object"==typeof console&&console.log&&console.log(...e)},r.formatArgs=function(e){if(e[0]=(this.useColors?"%c":"")+this.namespace+(this.useColors?" %c":" ")+e[0]+(this.useColors?"%c ":" ")+"+"+t.exports.humanize(this.diff),!this.useColors)return;const r="color: "+this.color;e.splice(1,0,r,"color: inherit");let n=0,o=0;e[0].replace(/%[a-zA-Z%]/g,e=>{"%%"!==e&&(n++,"%c"===e&&(o=n))}),e.splice(o,0,r)},r.save=function(e){try{e?r.storage.setItem("debug",e):r.storage.removeItem("debug")}catch(e){}},r.load=function(){let e;try{e=r.storage.getItem("debug")}catch(e){}!e&&void 0!==n&&"env"in n&&(e=n.env.DEBUG);return e},r.useColors=function(){if("undefined"!=typeof window&&window.process&&("renderer"===window.process.type||window.process.__nwjs))return!0;if("undefined"!=typeof navigator&&navigator.userAgent&&navigator.userAgent.toLowerCase().match(/(edge|trident)\/(\d+)/))return!1;return"undefined"!=typeof document&&document.documentElement&&document.documentElement.style&&document.documentElement.style.WebkitAppearance||"undefined"!=typeof window&&window.console&&(window.console.firebug||window.console.exception&&window.console.table)||"undefined"!=typeof navigator&&navigator.userAgent&&navigator.userAgent.toLowerCase().match(/firefox\/(\d+)/)&&parseInt(RegExp.$1,10)>=31||"undefined"!=typeof navigator&&navigator.userAgent&&navigator.userAgent.toLowerCase().match(/applewebkit\/(\d+)/)},r.storage=function(){try{return localStorage}catch(e){}}(),r.colors=["#0000CC","#0000FF","#0033CC","#0033FF","#0066CC","#0066FF","#0099CC","#0099FF","#00CC00","#00CC33","#00CC66","#00CC99","#00CCCC","#00CCFF","#3300CC","#3300FF","#3333CC","#3333FF","#3366CC","#3366FF","#3399CC","#3399FF","#33CC00","#33CC33","#33CC66","#33CC99","#33CCCC","#33CCFF","#6600CC","#6600FF","#6633CC","#6633FF","#66CC00","#66CC33","#9900CC","#9900FF","#9933CC","#9933FF","#99CC00","#99CC33","#CC0000","#CC0033","#CC0066","#CC0099","#CC00CC","#CC00FF","#CC3300","#CC3333","#CC3366","#CC3399","#CC33CC","#CC33FF","#CC6600","#CC6633","#CC9900","#CC9933","#CCCC00","#CCCC33","#FF0000","#FF0033","#FF0066","#FF0099","#FF00CC","#FF00FF","#FF3300","#FF3333","#FF3366","#FF3399","#FF33CC","#FF33FF","#FF6600","#FF6633","#FF9900","#FF9933","#FFCC00","#FFCC33"],t.exports=e("./common")(r);const{formatters:o}=t.exports;o.j=function(e){try{return JSON.stringify(e)}catch(e){return"[UnexpectedJSONParseError]: "+e.message}}}).call(this,e("_process"))},{"./common":37,_process:39}],37:[function(e,t,r){t.exports=function(t){function r(e){let t=0;for(let r=0;r<e.length;r++)t=(t<<5)-t+e.charCodeAt(r),t|=0;return n.colors[Math.abs(t)%n.colors.length]}function n(e){let t;function i(...e){if(!i.enabled)return;const r=i,o=Number(new Date),a=o-(t||o);r.diff=a,r.prev=t,r.curr=o,t=o,e[0]=n.coerce(e[0]),"string"!=typeof e[0]&&e.unshift("%O");let s=0;e[0]=e[0].replace(/%([a-zA-Z%])/g,(t,o)=>{if("%%"===t)return t;s++;const a=n.formatters[o];if("function"==typeof a){const n=e[s];t=a.call(r,n),e.splice(s,1),s--}return t}),n.formatArgs.call(r,e),(r.log||n.log).apply(r,e)}return i.namespace=e,i.enabled=n.enabled(e),i.useColors=n.useColors(),i.color=r(e),i.destroy=o,i.extend=a,"function"==typeof n.init&&n.init(i),n.instances.push(i),i}function o(){const e=n.instances.indexOf(this);return-1!==e&&(n.instances.splice(e,1),!0)}function a(e,t){const r=n(this.namespace+(void 0===t?":":t)+e);return r.log=this.log,r}function i(e){return e.toString().substring(2,e.toString().length-2).replace(/\.\*\?$/,"*")}return n.debug=n,n.default=n,n.coerce=function(e){if(e instanceof Error)return e.stack||e.message;return e},n.disable=function(){const e=[...n.names.map(i),...n.skips.map(i).map(e=>"-"+e)].join(",");return n.enable(""),e},n.enable=function(e){let t;n.save(e),n.names=[],n.skips=[];const r=("string"==typeof e?e:"").split(/[\s,]+/),o=r.length;for(t=0;t<o;t++)r[t]&&("-"===(e=r[t].replace(/\*/g,".*?"))[0]?n.skips.push(new RegExp("^"+e.substr(1)+"$")):n.names.push(new RegExp("^"+e+"$")));for(t=0;t<n.instances.length;t++){const e=n.instances[t];e.enabled=n.enabled(e.namespace)}},n.enabled=function(e){if("*"===e[e.length-1])return!0;let t,r;for(t=0,r=n.skips.length;t<r;t++)if(n.skips[t].test(e))return!1;for(t=0,r=n.names.length;t<r;t++)if(n.names[t].test(e))return!0;return!1},n.humanize=e("ms"),Object.keys(t).forEach(e=>{n[e]=t[e]}),n.instances=[],n.names=[],n.skips=[],n.formatters={},n.selectColor=r,n.enable(n.load()),n}},{ms:38}],38:[function(e,t,r){var n=1e3,o=60*n,a=60*o,i=24*a,s=7*i,c=365.25*i;function u(e,t,r,n){var o=t>=1.5*r;return Math.round(e/r)+" "+n+(o?"s":"")}t.exports=function(e,t){t=t||{};var r=typeof e;if("string"===r&&e.length>0)return function(e){if((e=String(e)).length>100)return;var t=/^(-?(?:\d+)?\.?\d+) *(milliseconds?|msecs?|ms|seconds?|secs?|s|minutes?|mins?|m|hours?|hrs?|h|days?|d|weeks?|w|years?|yrs?|y)?$/i.exec(e);if(!t)return;var r=parseFloat(t[1]);switch((t[2]||"ms").toLowerCase()){case"years":case"year":case"yrs":case"yr":case"y":return r*c;case"weeks":case"week":case"w":return r*s;case"days":case"day":case"d":return r*i;case"hours":case"hour":case"hrs":case"hr":case"h":return r*a;case"minutes":case"minute":case"mins":case"min":case"m":return r*o;case"seconds":case"second":case"secs":case"sec":case"s":return r*n;case"milliseconds":case"millisecond":case"msecs":case"msec":case"ms":return r;default:return}}(e);if("number"===r&&isFinite(e))return t.long?function(e){var t=Math.abs(e);if(t>=i)return u(e,t,i,"day");if(t>=a)return u(e,t,a,"hour");if(t>=o)return u(e,t,o,"minute");if(t>=n)return u(e,t,n,"second");return e+" ms"}(e):function(e){var t=Math.abs(e);if(t>=i)return Math.round(e/i)+"d";if(t>=a)return Math.round(e/a)+"h";if(t>=o)return Math.round(e/o)+"m";if(t>=n)return Math.round(e/n)+"s";return e+"ms"}(e);throw new Error("val is not a non-empty string or a valid number. val="+JSON.stringify(e))}},{}],39:[function(e,t,r){var n,o,a=t.exports={};function i(){throw new Error("setTimeout has not been defined")}function s(){throw new Error("clearTimeout has not been defined")}function c(e){if(n===setTimeout)return setTimeout(e,0);if((n===i||!n)&&setTimeout)return n=setTimeout,setTimeout(e,0);try{return n(e,0)}catch(t){try{return n.call(null,e,0)}catch(t){return n.call(this,e,0)}}}!function(){try{n="function"==typeof setTimeout?setTimeout:i}catch(e){n=i}try{o="function"==typeof clearTimeout?clearTimeout:s}catch(e){o=s}}();var u,d=[],l=!1,p=-1;function f(){l&&u&&(l=!1,u.length?d=u.concat(d):p=-1,d.length&&m())}function m(){if(!l){var e=c(f);l=!0;for(var t=d.length;t;){for(u=d,d=[];++p<t;)u&&u[p].run();p=-1,t=d.length}u=null,l=!1,function(e){if(o===clearTimeout)return clearTimeout(e);if((o===s||!o)&&clearTimeout)return o=clearTimeout,clearTimeout(e);try{o(e)}catch(t){try{return o.call(null,e)}catch(t){return o.call(this,e)}}}(e)}}function h(e,t){this.fun=e,this.array=t}function v(){}a.nextTick=function(e){var t=new Array(arguments.length-1);if(arguments.length>1)for(var r=1;r<arguments.length;r++)t[r-1]=arguments[r];d.push(new h(e,t)),1!==d.length||l||c(m)},h.prototype.run=function(){this.fun.apply(null,this.array)},a.title="browser",a.browser=!0,a.env={},a.argv=[],a.version="",a.versions={},a.on=v,a.addListener=v,a.once=v,a.off=v,a.removeListener=v,a.removeAllListeners=v,a.emit=v,a.prependListener=v,a.prependOnceListener=v,a.listeners=function(e){return[]},a.binding=function(e){throw new Error("process.binding is not supported")},a.cwd=function(){return"/"},a.chdir=function(e){throw new Error("process.chdir is not supported")},a.umask=function(){return 0}},{}],40:[function(e,t,r){!function(e){function r(e){var t=(e=e||{}).min,r=e.max,n=e.integer||!1;if(null==t&&null==r?(t=0,r=1):null==t?t=r-1:null==r&&(r=t+1),r<t)throw new Error("invalid options, max must be >= min");return{min:t,max:r,integer:n}}function n(e){if((e=r(e)).max===e.min)return e.min;var t=Math.random()*(e.max-e.min+Number(!!e.integer))+e.min;return e.integer?Math.floor(t):t}t.exports=n,t.exports.generator=function(e){return e=r(e),function(t,r,o){return e.min=null!=t?t:e.min,e.max=null!=r?r:e.max,e.integer=null!=o?o:e.integer,n(e)}},t.exports.defaults=r}()},{}],41:[function(e,t,r){var n=t.exports={v:[{name:"version",reg:/^(\d*)$/}],o:[{name:"origin",reg:/^(\S*) (\d*) (\d*) (\S*) IP(\d) (\S*)/,names:["username","sessionId","sessionVersion","netType","ipVer","address"],format:"%s %s %d %s IP%d %s"}],s:[{name:"name"}],i:[{name:"description"}],u:[{name:"uri"}],e:[{name:"email"}],p:[{name:"phone"}],z:[{name:"timezones"}],r:[{name:"repeats"}],t:[{name:"timing",reg:/^(\d*) (\d*)/,names:["start","stop"],format:"%d %d"}],c:[{name:"connection",reg:/^IN IP(\d) (\S*)/,names:["version","ip"],format:"IN IP%d %s"}],b:[{push:"bandwidth",reg:/^(TIAS|AS|CT|RR|RS):(\d*)/,names:["type","limit"],format:"%s:%s"}],m:[{reg:/^(\w*) (\d*) ([\w/]*)(?: (.*))?/,names:["type","port","protocol","payloads"],format:"%s %d %s %s"}],a:[{push:"rtp",reg:/^rtpmap:(\d*) ([\w\-.]*)(?:\s*\/(\d*)(?:\s*\/(\S*))?)?/,names:["payload","codec","rate","encoding"],format:function(e){return e.encoding?"rtpmap:%d %s/%s/%s":e.rate?"rtpmap:%d %s/%s":"rtpmap:%d %s"}},{push:"fmtp",reg:/^fmtp:(\d*) ([\S| ]*)/,names:["payload","config"],format:"fmtp:%d %s"},{name:"control",reg:/^control:(.*)/,format:"control:%s"},{name:"rtcp",reg:/^rtcp:(\d*)(?: (\S*) IP(\d) (\S*))?/,names:["port","netType","ipVer","address"],format:function(e){return null!=e.address?"rtcp:%d %s IP%d %s":"rtcp:%d"}},{push:"rtcpFbTrrInt",reg:/^rtcp-fb:(\*|\d*) trr-int (\d*)/,names:["payload","value"],format:"rtcp-fb:%d trr-int %d"},{push:"rtcpFb",reg:/^rtcp-fb:(\*|\d*) ([\w-_]*)(?: ([\w-_]*))?/,names:["payload","type","subtype"],format:function(e){return null!=e.subtype?"rtcp-fb:%s %s %s":"rtcp-fb:%s %s"}},{push:"ext",reg:/^extmap:(\d+)(?:\/(\w+))?(?: (urn:ietf:params:rtp-hdrext:encrypt))? (\S*)(?: (\S*))?/,names:["value","direction","encrypt-uri","uri","config"],format:function(e){return"extmap:%d"+(e.direction?"/%s":"%v")+(e["encrypt-uri"]?" %s":"%v")+" %s"+(e.config?" %s":"")}},{name:"extmapAllowMixed",reg:/^(extmap-allow-mixed)/},{push:"crypto",reg:/^crypto:(\d*) ([\w_]*) (\S*)(?: (\S*))?/,names:["id","suite","config","sessionConfig"],format:function(e){return null!=e.sessionConfig?"crypto:%d %s %s %s":"crypto:%d %s %s"}},{name:"setup",reg:/^setup:(\w*)/,format:"setup:%s"},{name:"connectionType",reg:/^connection:(new|existing)/,format:"connection:%s"},{name:"mid",reg:/^mid:([^\s]*)/,format:"mid:%s"},{name:"msid",reg:/^msid:(.*)/,format:"msid:%s"},{name:"ptime",reg:/^ptime:(\d*)/,format:"ptime:%d"},{name:"maxptime",reg:/^maxptime:(\d*)/,format:"maxptime:%d"},{name:"direction",reg:/^(sendrecv|recvonly|sendonly|inactive)/},{name:"icelite",reg:/^(ice-lite)/},{name:"iceUfrag",reg:/^ice-ufrag:(\S*)/,format:"ice-ufrag:%s"},{name:"icePwd",reg:/^ice-pwd:(\S*)/,format:"ice-pwd:%s"},{name:"fingerprint",reg:/^fingerprint:(\S*) (\S*)/,names:["type","hash"],format:"fingerprint:%s %s"},{push:"candidates",reg:/^candidate:(\S*) (\d*) (\S*) (\d*) (\S*) (\d*) typ (\S*)(?: raddr (\S*) rport (\d*))?(?: tcptype (\S*))?(?: generation (\d*))?(?: network-id (\d*))?(?: network-cost (\d*))?/,names:["foundation","component","transport","priority","ip","port","type","raddr","rport","tcptype","generation","network-id","network-cost"],format:function(e){var t="candidate:%s %d %s %d %s %d typ %s";return t+=null!=e.raddr?" raddr %s rport %d":"%v%v",t+=null!=e.tcptype?" tcptype %s":"%v",null!=e.generation&&(t+=" generation %d"),t+=null!=e["network-id"]?" network-id %d":"%v",t+=null!=e["network-cost"]?" network-cost %d":"%v"}},{name:"endOfCandidates",reg:/^(end-of-candidates)/},{name:"remoteCandidates",reg:/^remote-candidates:(.*)/,format:"remote-candidates:%s"},{name:"iceOptions",reg:/^ice-options:(\S*)/,format:"ice-options:%s"},{push:"ssrcs",reg:/^ssrc:(\d*) ([\w_-]*)(?::(.*))?/,names:["id","attribute","value"],format:function(e){var t="ssrc:%d";return null!=e.attribute&&(t+=" %s",null!=e.value&&(t+=":%s")),t}},{push:"ssrcGroups",reg:/^ssrc-group:([\x21\x23\x24\x25\x26\x27\x2A\x2B\x2D\x2E\w]*) (.*)/,names:["semantics","ssrcs"],format:"ssrc-group:%s %s"},{name:"msidSemantic",reg:/^msid-semantic:\s?(\w*) (\S*)/,names:["semantic","token"],format:"msid-semantic: %s %s"},{push:"groups",reg:/^group:(\w*) (.*)/,names:["type","mids"],format:"group:%s %s"},{name:"rtcpMux",reg:/^(rtcp-mux)/},{name:"rtcpRsize",reg:/^(rtcp-rsize)/},{name:"sctpmap",reg:/^sctpmap:([\w_/]*) (\S*)(?: (\S*))?/,names:["sctpmapNumber","app","maxMessageSize"],format:function(e){return null!=e.maxMessageSize?"sctpmap:%s %s %s":"sctpmap:%s %s"}},{name:"xGoogleFlag",reg:/^x-google-flag:([^\s]*)/,format:"x-google-flag:%s"},{push:"rids",reg:/^rid:([\d\w]+) (\w+)(?: ([\S| ]*))?/,names:["id","direction","params"],format:function(e){return e.params?"rid:%s %s %s":"rid:%s %s"}},{push:"imageattrs",reg:new RegExp("^imageattr:(\\d+|\\*)[\\s\\t]+(send|recv)[\\s\\t]+(\\*|\\[\\S+\\](?:[\\s\\t]+\\[\\S+\\])*)(?:[\\s\\t]+(recv|send)[\\s\\t]+(\\*|\\[\\S+\\](?:[\\s\\t]+\\[\\S+\\])*))?"),names:["pt","dir1","attrs1","dir2","attrs2"],format:function(e){return"imageattr:%s %s %s"+(e.dir2?" %s %s":"")}},{name:"simulcast",reg:new RegExp("^simulcast:(send|recv) ([a-zA-Z0-9\\-_~;,]+)(?:\\s?(send|recv) ([a-zA-Z0-9\\-_~;,]+))?$"),names:["dir1","list1","dir2","list2"],format:function(e){return"simulcast:%s %s"+(e.dir2?" %s %s":"")}},{name:"simulcast_03",reg:/^simulcast:[\s\t]+([\S+\s\t]+)$/,names:["value"],format:"simulcast: %s"},{name:"framerate",reg:/^framerate:(\d+(?:$|\.\d+))/,format:"framerate:%s"},{name:"sourceFilter",reg:/^source-filter: *(excl|incl) (\S*) (IP4|IP6|\*) (\S*) (.*)/,names:["filterMode","netType","addressTypes","destAddress","srcList"],format:"source-filter: %s %s %s %s %s"},{name:"bundleOnly",reg:/^(bundle-only)/},{name:"label",reg:/^label:(.+)/,format:"label:%s"},{name:"sctpPort",reg:/^sctp-port:(\d+)$/,format:"sctp-port:%s"},{name:"maxMessageSize",reg:/^max-message-size:(\d+)$/,format:"max-message-size:%s"},{push:"tsRefClocks",reg:/^ts-refclk:([^\s=]*)(?:=(\S*))?/,names:["clksrc","clksrcExt"],format:function(e){return"ts-refclk:%s"+(null!=e.clksrcExt?"=%s":"")}},{name:"mediaClk",reg:/^mediaclk:(?:id=(\S*))? *([^\s=]*)(?:=(\S*))?(?: *rate=(\d+)\/(\d+))?/,names:["id","mediaClockName","mediaClockValue","rateNumerator","rateDenominator"],format:function(e){var t="mediaclk:";return t+=null!=e.id?"id=%s %s":"%v%s",t+=null!=e.mediaClockValue?"=%s":"",t+=null!=e.rateNumerator?" rate=%s":"",t+=null!=e.rateDenominator?"/%s":""}},{name:"keywords",reg:/^keywds:(.+)$/,format:"keywds:%s"},{name:"content",reg:/^content:(.+)/,format:"content:%s"},{name:"bfcpFloorCtrl",reg:/^floorctrl:(c-only|s-only|c-s)/,format:"floorctrl:%s"},{name:"bfcpConfId",reg:/^confid:(\d+)/,format:"confid:%s"},{name:"bfcpUserId",reg:/^userid:(\d+)/,format:"userid:%s"},{name:"bfcpFloorId",reg:/^floorid:(.+) (?:m-stream|mstrm):(.+)/,names:["id","mStream"],format:"floorid:%s mstrm:%s"},{push:"invalid",names:["value"]}]};Object.keys(n).forEach((function(e){n[e].forEach((function(e){e.reg||(e.reg=/(.*)/),e.format||(e.format="%s")}))}))},{}],42:[function(e,t,r){var n=e("./parser"),o=e("./writer");r.write=o,r.parse=n.parse,r.parseFmtpConfig=n.parseFmtpConfig,r.parseParams=n.parseParams,r.parsePayloads=n.parsePayloads,r.parseRemoteCandidates=n.parseRemoteCandidates,r.parseImageAttributes=n.parseImageAttributes,r.parseSimulcastStreamList=n.parseSimulcastStreamList},{"./parser":43,"./writer":44}],43:[function(e,t,r){var n=function(e){return String(Number(e))===e?Number(e):e},o=function(e,t,r){var o=e.name&&e.names;e.push&&!t[e.push]?t[e.push]=[]:o&&!t[e.name]&&(t[e.name]={});var a=e.push?{}:o?t[e.name]:t;!function(e,t,r,o){if(o&&!r)t[o]=n(e[1]);else for(var a=0;a<r.length;a+=1)null!=e[a+1]&&(t[r[a]]=n(e[a+1]))}(r.match(e.reg),a,e.names,e.name),e.push&&t[e.push].push(a)},a=e("./grammar"),i=RegExp.prototype.test.bind(/^([a-z])=(.*)/);r.parse=function(e){var t={},r=[],n=t;return e.split(/(\r\n|\r|\n)/).filter(i).forEach((function(e){var t=e[0],i=e.slice(2);"m"===t&&(r.push({rtp:[],fmtp:[]}),n=r[r.length-1]);for(var s=0;s<(a[t]||[]).length;s+=1){var c=a[t][s];if(c.reg.test(i))return o(c,n,i)}})),t.media=r,t};var s=function(e,t){var r=t.split(/=(.+)/,2);return 2===r.length?e[r[0]]=n(r[1]):1===r.length&&t.length>1&&(e[r[0]]=void 0),e};r.parseParams=function(e){return e.split(/;\s?/).reduce(s,{})},r.parseFmtpConfig=r.parseParams,r.parsePayloads=function(e){return e.toString().split(" ").map(Number)},r.parseRemoteCandidates=function(e){for(var t=[],r=e.split(" ").map(n),o=0;o<r.length;o+=3)t.push({component:r[o],ip:r[o+1],port:r[o+2]});return t},r.parseImageAttributes=function(e){return e.split(" ").map((function(e){return e.substring(1,e.length-1).split(",").reduce(s,{})}))},r.parseSimulcastStreamList=function(e){return e.split(";").map((function(e){return e.split(",").map((function(e){var t,r=!1;return"~"!==e[0]?t=n(e):(t=n(e.substring(1,e.length)),r=!0),{scid:t,paused:r}}))}))}},{"./grammar":41}],44:[function(e,t,r){var n=e("./grammar"),o=/%[sdv%]/g,a=function(e){var t=1,r=arguments,n=r.length;return e.replace(o,(function(e){if(t>=n)return e;var o=r[t];switch(t+=1,e){case"%%":return"%";case"%s":return String(o);case"%d":return Number(o);case"%v":return""}}))},i=function(e,t,r){var n=[e+"="+(t.format instanceof Function?t.format(t.push?r:r[t.name]):t.format)];if(t.names)for(var o=0;o<t.names.length;o+=1){var i=t.names[o];t.name?n.push(r[t.name][i]):n.push(r[t.names[o]])}else n.push(r[t.name]);return a.apply(null,n)},s=["v","o","s","i","u","e","p","c","b","t","r","z","a"],c=["i","c","b","a"];t.exports=function(e,t){t=t||{},null==e.version&&(e.version=0),null==e.name&&(e.name=" "),e.media.forEach((function(e){null==e.payloads&&(e.payloads="")}));var r=t.outerOrder||s,o=t.innerOrder||c,a=[];return r.forEach((function(t){n[t].forEach((function(r){r.name in e&&null!=e[r.name]?a.push(i(t,r,e)):r.push in e&&null!=e[r.push]&&e[r.push].forEach((function(e){a.push(i(t,r,e))}))}))})),e.media.forEach((function(e){a.push(i("m",n.m[0],e)),o.forEach((function(t){n[t].forEach((function(r){r.name in e&&null!=e[r.name]?a.push(i(t,r,e)):r.push in e&&null!=e[r.push]&&e[r.push].forEach((function(e){a.push(i(t,r,e))}))}))}))})),a.join("\r\n")+"\r\n"}},{"./grammar":41}]},{},[30])(30)}));